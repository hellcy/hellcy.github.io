<!DOCTYPE html>
<html lang=en>
<head>
  <meta charset="utf-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Cache-Control" content="no-transform" />
  <meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="format-detection" content="telephone=no,email=no,adress=no">
  <!-- Color theme for statusbar -->
  <meta name="theme-color" content="#000000" />
  <!-- 强制页面在当前窗口以独立页面显示,防止别人在框架里调用页面 -->
  <meta http-equiv="window-target" content="_top" />
  
  
  <title>AWS DVA review | Hellcy&#39;s Blog</title>
  <meta name="description" content="I PASSED!  View My Certificate  ELB + ASG  Why use a load balancer  spread load across multiple downstream instances expose a single point of access (DNS) to your application seamlessly handle faliur">
<meta property="og:type" content="article">
<meta property="og:title" content="AWS DVA review">
<meta property="og:url" content="http://hellcy.github.io/2021/09/12/AWS-DVA-review/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="I PASSED!  View My Certificate  ELB + ASG  Why use a load balancer  spread load across multiple downstream instances expose a single point of access (DNS) to your application seamlessly handle faliur">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="http://hellcy.github.io/images/AWS-DVA-Review/AWSCertifiedDeveloperAssociatecertificate.png">
<meta property="article:published_time" content="2021-09-11T16:06:00.000Z">
<meta property="article:modified_time" content="2022-02-10T14:39:24.299Z">
<meta property="article:author" content="Yuan Cheng">
<meta property="article:tag" content="AWS">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://hellcy.github.io/images/AWS-DVA-Review/AWSCertifiedDeveloperAssociatecertificate.png">
  <!-- Canonical links -->
  <link rel="canonical" href="http://hellcy.github.io/2021/09/12/AWS-DVA-review/index.html">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png" type="image/x-icon">
  
  
<link rel="stylesheet" href="/css/style.css">

  
  
  
    <link href="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.3.5/dist/jquery.fancybox.min.css" rel="stylesheet">
  
  
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1.4.0/dist/gitalk.min.css">
  
<meta name="generator" content="Hexo 5.3.0"></head>


<body class="main-center theme-black" itemscope itemtype="http://schema.org/WebPage">
  <header class="header" itemscope itemtype="http://schema.org/WPHeader">
  <div class="slimContent">
    <div class="navbar-header">
      
      
      <div class="profile-block text-center">
        <a id="avatar" href="https://github.com/hellcy" target="_blank">
          <img class="img-circle img-rotate" src="/images/avatar.jpg" width="200" height="200">
        </a>
        <h2 id="name" class="hidden-xs hidden-sm">Yuan Cheng</h2>
        <h3 id="title" class="hidden-xs hidden-sm hidden-md">Software Engineer</h3>
        <small id="location" class="text-muted hidden-xs hidden-sm"><i class="icon icon-map-marker"></i> Sydney, Australia</small>
      </div>
      
      <div class="search" id="search-form-wrap">

    <form class="search-form sidebar-form">
        <div class="input-group">
            <input type="text" class="search-form-input form-control" placeholder="Search" />
            <span class="input-group-btn">
                <button type="submit" class="search-form-submit btn btn-flat" onclick="return false;"><i class="icon icon-search"></i></button>
            </span>
        </div>
    </form>
    <div class="ins-search">
  <div class="ins-search-mask"></div>
  <div class="ins-search-container">
    <div class="ins-input-wrapper">
      <input type="text" class="ins-search-input" placeholder="Type something..." x-webkit-speech />
      <button type="button" class="close ins-close ins-selectable" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
    </div>
    <div class="ins-section-wrapper">
      <div class="ins-section-container"></div>
    </div>
  </div>
</div>


</div>
      <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target="#main-navbar" aria-controls="main-navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <nav id="main-navbar" class="collapse navbar-collapse" itemscope itemtype="http://schema.org/SiteNavigationElement" role="navigation">
      <ul class="nav navbar-nav main-nav menu-highlight">
        
        
        <li class="menu-item menu-item-home">
          <a href="/.">
            
            <i class="icon icon-home-fill"></i>
            
            <span class="menu-title">Home</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            
            <i class="icon icon-archives-fill"></i>
            
            <span class="menu-title">Archives</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-categories">
          <a href="/categories">
            
            <i class="icon icon-folder"></i>
            
            <span class="menu-title">Categories</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-tags">
          <a href="/tags">
            
            <i class="icon icon-tags"></i>
            
            <span class="menu-title">Tags</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-repository">
          <a href="/repository">
            
            <i class="icon icon-project"></i>
            
            <span class="menu-title">Repository</span>
          </a>
        </li>
        
        
        <li class="menu-item menu-item-about">
          <a href="/about">
            
            <i class="icon icon-cup-fill"></i>
            
            <span class="menu-title">About</span>
          </a>
        </li>
        
      </ul>
      
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/hellcy" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="/atom.xml" target="_blank" title="Rss" data-toggle=tooltip data-placement=top><i class="icon icon-rss"></i></a></li>
        
    </ul>

    </nav>
  </div>
</header>

  
    <aside class="sidebar" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    
      <div class="widget">
    <h3 class="widget-title">Board</h3>
    <div class="widget-body">
        <div id="board">
            <div class="content">
                <p>Welcome to my blog!</p>
            </div>
        </div>
    </div>
</div>

    
      

    
      
  <div class="widget">
    <h3 class="widget-title">Tags</h3>
    <div class="widget-body">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/NET/" rel="tag">.NET</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/API/" rel="tag">API</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ASP-NET-Core/" rel="tag">ASP.NET Core</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/AWS/" rel="tag">AWS</a><span class="tag-list-count">8</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android-Studio/" rel="tag">Android Studio</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Azure/" rel="tag">Azure</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/C/" rel="tag">C#</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Data/" rel="tag">Data</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Data-Structures/" rel="tag">Data Structures</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Data-Virtualization/" rel="tag">Data Virtualization</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Database/" rel="tag">Database</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Dependency-Injection/" rel="tag">Dependency Injection</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Design-Patterns/" rel="tag">Design Patterns</a><span class="tag-list-count">10</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Dynamic-Programming/" rel="tag">Dynamic Programming</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Elastic-Search/" rel="tag">Elastic Search</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Entity-Framework/" rel="tag">Entity Framework</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Factory/" rel="tag">Factory</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Frontend/" rel="tag">Frontend</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Functional-Tests/" rel="tag">Functional Tests</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/GraphQL/" rel="tag">GraphQL</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/IIS/" rel="tag">IIS</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JDBC/" rel="tag">JDBC</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Java/" rel="tag">Java</a><span class="tag-list-count">11</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/" rel="tag">JavaScript</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Kotlin/" rel="tag">Kotlin</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LINQ/" rel="tag">LINQ</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Lambda/" rel="tag">Lambda</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Load-Testing/" rel="tag">Load Testing</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Maven/" rel="tag">Maven</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Mifare/" rel="tag">Mifare</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MyBatis/" rel="tag">MyBatis</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MySQL/" rel="tag">MySQL</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/" rel="tag">Python</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/React/" rel="tag">React</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SQL/" rel="tag">SQL</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SSO/" rel="tag">SSO</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Scrum/" rel="tag">Scrum</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Selenium/" rel="tag">Selenium</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spring/" rel="tag">Spring</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Stream/" rel="tag">Stream</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Swift/" rel="tag">Swift</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TCP-IP/" rel="tag">TCP/IP</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Unit-Tests/" rel="tag">Unit Tests</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Web-Development/" rel="tag">Web Development</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Wishlist/" rel="tag">Wishlist</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/XML/" rel="tag">XML</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/" rel="tag">git</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/iOS/" rel="tag">iOS</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget-body tagcloud">
      <a href="/tags/NET/" style="font-size: 13.2px;">.NET</a> <a href="/tags/API/" style="font-size: 13.4px;">API</a> <a href="/tags/ASP-NET-Core/" style="font-size: 13.2px;">ASP.NET Core</a> <a href="/tags/AWS/" style="font-size: 13.6px;">AWS</a> <a href="/tags/Android-Studio/" style="font-size: 13px;">Android Studio</a> <a href="/tags/Azure/" style="font-size: 13px;">Azure</a> <a href="/tags/C/" style="font-size: 13.2px;">C#</a> <a href="/tags/Data/" style="font-size: 13.2px;">Data</a> <a href="/tags/Data-Structures/" style="font-size: 13.2px;">Data Structures</a> <a href="/tags/Data-Virtualization/" style="font-size: 13.2px;">Data Virtualization</a> <a href="/tags/Database/" style="font-size: 13.2px;">Database</a> <a href="/tags/Dependency-Injection/" style="font-size: 13px;">Dependency Injection</a> <a href="/tags/Design-Patterns/" style="font-size: 13.8px;">Design Patterns</a> <a href="/tags/Dynamic-Programming/" style="font-size: 13px;">Dynamic Programming</a> <a href="/tags/Elastic-Search/" style="font-size: 13px;">Elastic Search</a> <a href="/tags/Entity-Framework/" style="font-size: 13px;">Entity Framework</a> <a href="/tags/Factory/" style="font-size: 13px;">Factory</a> <a href="/tags/Frontend/" style="font-size: 13px;">Frontend</a> <a href="/tags/Functional-Tests/" style="font-size: 13px;">Functional Tests</a> <a href="/tags/GraphQL/" style="font-size: 13.2px;">GraphQL</a> <a href="/tags/IIS/" style="font-size: 13px;">IIS</a> <a href="/tags/JDBC/" style="font-size: 13px;">JDBC</a> <a href="/tags/Java/" style="font-size: 14px;">Java</a> <a href="/tags/JavaScript/" style="font-size: 13px;">JavaScript</a> <a href="/tags/Kotlin/" style="font-size: 13px;">Kotlin</a> <a href="/tags/LINQ/" style="font-size: 13px;">LINQ</a> <a href="/tags/Lambda/" style="font-size: 13px;">Lambda</a> <a href="/tags/Load-Testing/" style="font-size: 13px;">Load Testing</a> <a href="/tags/Maven/" style="font-size: 13px;">Maven</a> <a href="/tags/Mifare/" style="font-size: 13px;">Mifare</a> <a href="/tags/MyBatis/" style="font-size: 13px;">MyBatis</a> <a href="/tags/MySQL/" style="font-size: 13.2px;">MySQL</a> <a href="/tags/Python/" style="font-size: 13px;">Python</a> <a href="/tags/React/" style="font-size: 13.4px;">React</a> <a href="/tags/SQL/" style="font-size: 13px;">SQL</a> <a href="/tags/SSO/" style="font-size: 13px;">SSO</a> <a href="/tags/Scrum/" style="font-size: 13px;">Scrum</a> <a href="/tags/Selenium/" style="font-size: 13px;">Selenium</a> <a href="/tags/Spring/" style="font-size: 13px;">Spring</a> <a href="/tags/Stream/" style="font-size: 13px;">Stream</a> <a href="/tags/Swift/" style="font-size: 13.2px;">Swift</a> <a href="/tags/TCP-IP/" style="font-size: 13px;">TCP/IP</a> <a href="/tags/Unit-Tests/" style="font-size: 13px;">Unit Tests</a> <a href="/tags/Web-Development/" style="font-size: 13px;">Web Development</a> <a href="/tags/Wishlist/" style="font-size: 13.2px;">Wishlist</a> <a href="/tags/XML/" style="font-size: 13px;">XML</a> <a href="/tags/git/" style="font-size: 13.2px;">git</a> <a href="/tags/iOS/" style="font-size: 13px;">iOS</a>
    </div>
  </div>

    
      
  <div class="widget">
    <h3 class="widget-title">Archive</h3>
    <div class="widget-body">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/">2022</a><span class="archive-list-count">17</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/">2021</a><span class="archive-list-count">39</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/">2020</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/">2019</a><span class="archive-list-count">10</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget-body">
      <ul class="recent-post-list list-unstyled ">
        
          <li>
            
            <div class="item-thumb">
              <a href="/2022/06/18/GraphQL-and-React/" class="thumb">
    
    
        <span class="thumb-image thumb-none"></span>
    
</a>

            </div>
            
            <div class="item-inner">
              <p class="item-category">
                
              </p>
              <p class="item-title">
                <a href="/2022/06/18/GraphQL-and-React/" class="title">GraphQL and React</a>
              </p>
              <p class="item-date">
                <time datetime="2022-06-18T03:29:44.000Z" itemprop="datePublished">18-06-2022</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-thumb">
              <a href="/2022/02/21/MyBatis-Basics/" class="thumb">
    
    
        <span class="thumb-image thumb-none"></span>
    
</a>

            </div>
            
            <div class="item-inner">
              <p class="item-category">
                
              </p>
              <p class="item-title">
                <a href="/2022/02/21/MyBatis-Basics/" class="title">MyBatis Basics</a>
              </p>
              <p class="item-date">
                <time datetime="2022-02-21T11:21:51.000Z" itemprop="datePublished">21-02-2022</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-thumb">
              <a href="/2022/02/20/Java-Lambda-and-Stream/" class="thumb">
    
    
        <span class="thumb-image thumb-none"></span>
    
</a>

            </div>
            
            <div class="item-inner">
              <p class="item-category">
                
              </p>
              <p class="item-title">
                <a href="/2022/02/20/Java-Lambda-and-Stream/" class="title">Java Lambda and Stream</a>
              </p>
              <p class="item-date">
                <time datetime="2022-02-20T11:34:12.000Z" itemprop="datePublished">20-02-2022</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-thumb">
              <a href="/2022/02/20/Java-Reflection/" class="thumb">
    
    
        <span class="thumb-image thumb-none"></span>
    
</a>

            </div>
            
            <div class="item-inner">
              <p class="item-category">
                
              </p>
              <p class="item-title">
                <a href="/2022/02/20/Java-Reflection/" class="title">Java Reflection</a>
              </p>
              <p class="item-date">
                <time datetime="2022-02-20T05:27:27.000Z" itemprop="datePublished">20-02-2022</time>
              </p>
            </div>
          </li>
          
          <li>
            
            <div class="item-thumb">
              <a href="/2022/02/20/Factory-Design-Pattern/" class="thumb">
    
    
        <span class="thumb-image thumb-none"></span>
    
</a>

            </div>
            
            <div class="item-inner">
              <p class="item-category">
                
              </p>
              <p class="item-title">
                <a href="/2022/02/20/Factory-Design-Pattern/" class="title">Factory Design Pattern</a>
              </p>
              <p class="item-date">
                <time datetime="2022-02-20T04:52:51.000Z" itemprop="datePublished">20-02-2022</time>
              </p>
            </div>
          </li>
          
      </ul>
    </div>
  </div>
  

    
  </div>
</aside>

  
  
<aside class="sidebar sidebar-toc collapse" id="collapseToc" itemscope itemtype="http://schema.org/WPSideBar">
  <div class="slimContent">
    <nav id="toc" class="article-toc">
      <h3 class="toc-title">Catalogue</h3>
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#i-passed"><span class="toc-number">1.</span> <span class="toc-text"> I PASSED!</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#elb-asg"><span class="toc-number">2.</span> <span class="toc-text"> ELB + ASG</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#why-use-a-load-balancer"><span class="toc-number">2.1.</span> <span class="toc-text"> Why use a load balancer</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#elb-integrated-with-many-aws-services"><span class="toc-number">2.1.1.</span> <span class="toc-text"> ELB integrated with many AWS services</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#alb"><span class="toc-number">2.2.</span> <span class="toc-text"> ALB</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#target-groups"><span class="toc-number">2.2.1.</span> <span class="toc-text"> Target groups</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#nlb"><span class="toc-number">2.3.</span> <span class="toc-text"> NLB</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sticky-sessions"><span class="toc-number">2.4.</span> <span class="toc-text"> Sticky Sessions</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ssl-server-name-indication"><span class="toc-number">2.5.</span> <span class="toc-text"> SSL - server name indication</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#connection-draining-de-registration-delay"><span class="toc-number">2.6.</span> <span class="toc-text"> Connection Draining (De-registration delay)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#x-forwarded-for-and-x-forwarded-proto"><span class="toc-number">2.7.</span> <span class="toc-text"> X-Forwarded-For and X-Forwarded-Proto</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#asg"><span class="toc-number">2.8.</span> <span class="toc-text"> ASG</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#scaling-policies"><span class="toc-number">2.8.1.</span> <span class="toc-text"> Scaling Policies</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#good-metrics-to-scale-on"><span class="toc-number">2.8.2.</span> <span class="toc-text"> Good metrics to scale on</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#scaling-cooldowns"><span class="toc-number">2.8.3.</span> <span class="toc-text"> Scaling cooldowns</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#rds"><span class="toc-number">3.</span> <span class="toc-text"> RDS</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#rds-backups"><span class="toc-number">3.1.</span> <span class="toc-text"> RDS backups</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#rds-storage-auto-scaling"><span class="toc-number">3.2.</span> <span class="toc-text"> RDS storage auto scaling</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#rds-read-replicas-for-read-scalability"><span class="toc-number">3.3.</span> <span class="toc-text"> RDS read replicas for read scalability</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#rds-read-replicas-use-case"><span class="toc-number">3.4.</span> <span class="toc-text"> RDS read replicas - use case</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#rds-read-replicas-network-cost"><span class="toc-number">3.5.</span> <span class="toc-text"> RDS read replicas - network cost</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#rds-multi-az-dr"><span class="toc-number">3.6.</span> <span class="toc-text"> RDS multi AZ (DR)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#rds-from-single-az-to-multi-az"><span class="toc-number">3.7.</span> <span class="toc-text"> RDS from single AZ to Multi AZ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#rds-security-encryption"><span class="toc-number">3.8.</span> <span class="toc-text"> RDS security - encryption</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#rds-encryption-operations"><span class="toc-number">3.9.</span> <span class="toc-text"> RDS encryption operations</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#rds-security-network-and-iam"><span class="toc-number">3.10.</span> <span class="toc-text"> RDS security - Network and IAM</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#aurora"><span class="toc-number">3.11.</span> <span class="toc-text"> Aurora</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#elasticache"><span class="toc-number">4.</span> <span class="toc-text"> ElastiCache</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#db-cache"><span class="toc-number">4.1.</span> <span class="toc-text"> DB cache</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#user-session-store"><span class="toc-number">4.2.</span> <span class="toc-text"> User session store</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#redis-vs-memcached"><span class="toc-number">4.3.</span> <span class="toc-text"> Redis vs Memcached</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#caching-implementation-considerations"><span class="toc-number">4.4.</span> <span class="toc-text"> Caching implementation considerations</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lazy-loading-cache-aside-lazy-population"><span class="toc-number">4.5.</span> <span class="toc-text"> lazy loading &#x2F; cache aside &#x2F; lazy population</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#write-through-add-or-update-cache-when-database-is-updated"><span class="toc-number">4.6.</span> <span class="toc-text"> write through - add or update cache when database is updated</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cache-evictions-and-ttl-time-to-live"><span class="toc-number">4.7.</span> <span class="toc-text"> cache evictions and TTL (time to live)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#final-words"><span class="toc-number">4.8.</span> <span class="toc-text"> Final words</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#elasticache-replication-cluster-mode-disabled"><span class="toc-number">4.9.</span> <span class="toc-text"> ElastiCache replication - cluster mode disabled</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#elasticache-replication-cluster-mode-enabled"><span class="toc-number">4.10.</span> <span class="toc-text"> ElastiCache replication - cluster mode enabled</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#route-53"><span class="toc-number">5.</span> <span class="toc-text"> Route 53</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#hosted-zones"><span class="toc-number">5.1.</span> <span class="toc-text"> Hosted zones</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cname-vs-alias"><span class="toc-number">5.2.</span> <span class="toc-text"> CNAME vs alias</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#route-53-routing-policies"><span class="toc-number">5.3.</span> <span class="toc-text"> Route 53 - routing policies</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#simple"><span class="toc-number">5.4.</span> <span class="toc-text"> Simple</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#weighted"><span class="toc-number">5.5.</span> <span class="toc-text"> Weighted</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#latency"><span class="toc-number">5.6.</span> <span class="toc-text"> latency</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#health-checks"><span class="toc-number">5.7.</span> <span class="toc-text"> health checks</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#monitor-an-endpoint"><span class="toc-number">5.7.1.</span> <span class="toc-text"> monitor an endpoint</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#calculated-health-checks"><span class="toc-number">5.7.2.</span> <span class="toc-text"> calculated health checks</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#private-hosted-zones"><span class="toc-number">5.7.3.</span> <span class="toc-text"> private hosted zones</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#failover"><span class="toc-number">5.8.</span> <span class="toc-text"> failover</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#geolocation"><span class="toc-number">5.9.</span> <span class="toc-text"> Geolocation</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#geoproximity"><span class="toc-number">5.10.</span> <span class="toc-text"> Geoproximity</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#traffic-flow"><span class="toc-number">5.10.1.</span> <span class="toc-text"> Traffic flow</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#multi-value"><span class="toc-number">5.11.</span> <span class="toc-text"> multi value</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#vpc"><span class="toc-number">6.</span> <span class="toc-text"> VPC</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#internet-gateway-and-nat-gateways"><span class="toc-number">6.1.</span> <span class="toc-text"> Internet gateway and NAT gateways</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#nacl-and-security-groups"><span class="toc-number">6.2.</span> <span class="toc-text"> NACL and security groups</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#vpc-flow-logs"><span class="toc-number">6.3.</span> <span class="toc-text"> VPC Flow logs</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#vpc-peering"><span class="toc-number">6.4.</span> <span class="toc-text"> VPC Peering</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#vpc-endpoints"><span class="toc-number">6.5.</span> <span class="toc-text"> VPC endpoints</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#site-to-site-vpn-and-direct-connect"><span class="toc-number">6.6.</span> <span class="toc-text"> Site to site VPN and Direct connect</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#s3"><span class="toc-number">7.</span> <span class="toc-text"> S3</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#buckets"><span class="toc-number">7.1.</span> <span class="toc-text"> buckets</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#objects"><span class="toc-number">7.2.</span> <span class="toc-text"> objects</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#versioning"><span class="toc-number">7.3.</span> <span class="toc-text"> versioning</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#encryption-for-objects"><span class="toc-number">7.4.</span> <span class="toc-text"> Encryption for objects</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#sse-s3"><span class="toc-number">7.4.1.</span> <span class="toc-text"> SSE-S3</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sse-kms"><span class="toc-number">7.4.2.</span> <span class="toc-text"> SSE-KMS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sse-c"><span class="toc-number">7.4.3.</span> <span class="toc-text"> SSE-C</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#client-side-encryption"><span class="toc-number">7.4.4.</span> <span class="toc-text"> client side encryption</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#encryption-in-transit-ssltls"><span class="toc-number">7.4.5.</span> <span class="toc-text"> Encryption in transit (SSL&#x2F;TLS)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#security"><span class="toc-number">7.5.</span> <span class="toc-text"> security</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#bucket-settings-for-block-public-access"><span class="toc-number">7.5.1.</span> <span class="toc-text"> bucket settings for block public access</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#others"><span class="toc-number">7.5.2.</span> <span class="toc-text"> others</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cors"><span class="toc-number">7.6.</span> <span class="toc-text"> CORS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#consistency-model"><span class="toc-number">7.7.</span> <span class="toc-text"> consistency model</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#aws-cli-sdk-iam-roles-and-policies"><span class="toc-number">8.</span> <span class="toc-text"> AWS CLI, SDK, IAM Roles and policies</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#aws-ec2-instance-metadata"><span class="toc-number">8.1.</span> <span class="toc-text"> AWS EC2 instance metadata</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mfa-with-cli"><span class="toc-number">8.2.</span> <span class="toc-text"> MFA with CLI</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#aws-sdk"><span class="toc-number">8.3.</span> <span class="toc-text"> AWS SDK</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#aws-limit"><span class="toc-number">8.4.</span> <span class="toc-text"> AWS limit</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#exponential-backoff"><span class="toc-number">8.4.1.</span> <span class="toc-text"> Exponential Backoff</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#aws-cli-credentials-provider-chain"><span class="toc-number">8.5.</span> <span class="toc-text"> AWS CLI credentials provider chain</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#aws-sdk-default-credentials-provider-chain"><span class="toc-number">8.6.</span> <span class="toc-text"> AWS SDK default credentials provider chain</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#credentials-scenario"><span class="toc-number">8.6.1.</span> <span class="toc-text"> Credentials Scenario</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#credentials-best-practice"><span class="toc-number">8.6.2.</span> <span class="toc-text"> credentials best practice</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#signing-aws-api-requests"><span class="toc-number">8.7.</span> <span class="toc-text"> signing AWS API requests</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#sigv4-options"><span class="toc-number">8.7.1.</span> <span class="toc-text"> sigV4 options</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#s3-and-athena-advanced"><span class="toc-number">9.</span> <span class="toc-text"> S3 and Athena Advanced</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#s3-mfa-delete"><span class="toc-number">9.1.</span> <span class="toc-text"> S3 MFA delete</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#s3-default-encryption-vs-bucket-policies"><span class="toc-number">9.2.</span> <span class="toc-text"> S3 default encryption vs bucket policies</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#s3-access-logs"><span class="toc-number">9.3.</span> <span class="toc-text"> S3 access logs</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#s3-replication-crr-or-srr"><span class="toc-number">9.4.</span> <span class="toc-text"> S3 replication (CRR or SRR)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#s3-pre-signed-urls"><span class="toc-number">9.5.</span> <span class="toc-text"> S3 pre signed URLs</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#amazon-glacier-and-glacier-deep-archive"><span class="toc-number">9.6.</span> <span class="toc-text"> Amazon Glacier and Glacier Deep Archive</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#s3-lifecycle-rules"><span class="toc-number">9.7.</span> <span class="toc-text"> S3 lifecycle rules</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#s3-performance"><span class="toc-number">9.8.</span> <span class="toc-text"> S3 performance</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#kms-limitation"><span class="toc-number">9.8.1.</span> <span class="toc-text"> KMS limitation</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#multi-part-upload"><span class="toc-number">9.8.2.</span> <span class="toc-text"> multi part upload</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#s3-transfer-acceleration"><span class="toc-number">9.8.3.</span> <span class="toc-text"> S3 transfer acceleration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#s3-byte-range-fetches"><span class="toc-number">9.8.4.</span> <span class="toc-text"> S3 byte range fetches</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#s3-select-and-glacier-select"><span class="toc-number">9.9.</span> <span class="toc-text"> S3 select and Glacier select</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#s3-event-notifications"><span class="toc-number">9.10.</span> <span class="toc-text"> S3 event notifications</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#aws-athena"><span class="toc-number">10.</span> <span class="toc-text"> AWS Athena</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#aws-cloudfront"><span class="toc-number">11.</span> <span class="toc-text"> AWS CloudFront</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#origins"><span class="toc-number">11.1.</span> <span class="toc-text"> Origins</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cloudfront-geo-restriction"><span class="toc-number">11.2.</span> <span class="toc-text"> CloudFront Geo Restriction</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cloudfront-vs-s3-crr"><span class="toc-number">11.3.</span> <span class="toc-text"> CloudFront vs S3 CRR</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cloudfront-caching"><span class="toc-number">11.4.</span> <span class="toc-text"> CloudFront caching</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cloudfront-signed-url-signed-cookies"><span class="toc-number">11.5.</span> <span class="toc-text"> CloudFront signed URL &#x2F; signed cookies</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cloudfront-signed-url-vs-s3-pre-signed-url"><span class="toc-number">11.6.</span> <span class="toc-text"> CloudFront signed URL vs S3 pre signed URL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#signed-url"><span class="toc-number">11.6.1.</span> <span class="toc-text"> Signed URL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#s3-pre-signed-url"><span class="toc-number">11.6.2.</span> <span class="toc-text"> S3 pre signed URL</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cloudfront-signed-url-process"><span class="toc-number">11.7.</span> <span class="toc-text"> CloudFront signed URL process</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#price-classes"><span class="toc-number">11.8.</span> <span class="toc-text"> Price classes</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#multiple-origin"><span class="toc-number">11.9.</span> <span class="toc-text"> Multiple origin</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#origin-groups"><span class="toc-number">11.10.</span> <span class="toc-text"> origin groups</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#field-level-encryption"><span class="toc-number">11.11.</span> <span class="toc-text"> field level encryption</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ecs"><span class="toc-number">12.</span> <span class="toc-text"> ECS</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#docker"><span class="toc-number">12.1.</span> <span class="toc-text"> Docker</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ecs-clusters-overview"><span class="toc-number">12.2.</span> <span class="toc-text"> ECS clusters overview</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ecs-task-definitions"><span class="toc-number">12.3.</span> <span class="toc-text"> ECS task definitions</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ecs-service"><span class="toc-number">12.4.</span> <span class="toc-text"> ECS service</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ecs-service-with-load-balancer"><span class="toc-number">12.5.</span> <span class="toc-text"> ECS service with load balancer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ecr"><span class="toc-number">12.6.</span> <span class="toc-text"> ECR</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#how-to-login-to-ecr-using-aws-cli"><span class="toc-number">12.6.1.</span> <span class="toc-text"> how to login to ECR using AWS CLI</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#fargate"><span class="toc-number">12.7.</span> <span class="toc-text"> Fargate</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ecs-iam-roles-deep-dive"><span class="toc-number">12.8.</span> <span class="toc-text"> ECS IAM roles deep dive</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ecs-tasks-placement"><span class="toc-number">12.9.</span> <span class="toc-text"> ECS tasks placement</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ecs-task-placement-process"><span class="toc-number">12.9.1.</span> <span class="toc-text"> ECS task placement process</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ecs-task-placement-strategies"><span class="toc-number">12.9.2.</span> <span class="toc-text"> ECS task placement strategies</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ecs-task-placement-constraints"><span class="toc-number">12.9.3.</span> <span class="toc-text"> ECS task placement constraints</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ecs-service-auto-scaling"><span class="toc-number">12.10.</span> <span class="toc-text"> ECS service auto scaling</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ecs-cluster-capacity-provider"><span class="toc-number">12.11.</span> <span class="toc-text"> ECS cluster capacity provider</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ecs-data-volumes"><span class="toc-number">12.12.</span> <span class="toc-text"> ECS data volumes</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ec2-task-strategies"><span class="toc-number">12.12.1.</span> <span class="toc-text"> EC2 task strategies</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#efs-file-systems"><span class="toc-number">12.12.2.</span> <span class="toc-text"> EFS file systems</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#bind-mounts-sharing-data-between-containers"><span class="toc-number">12.12.3.</span> <span class="toc-text"> Bind Mounts sharing data between containers</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#beanstalk"><span class="toc-number">13.</span> <span class="toc-text"> Beanstalk</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#developer-problems-on-aws"><span class="toc-number">13.1.</span> <span class="toc-text"> developer problems on AWS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#elastic-beanstalk-overview"><span class="toc-number">13.2.</span> <span class="toc-text"> Elastic Beanstalk overview</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#components"><span class="toc-number">13.3.</span> <span class="toc-text"> Components</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#beanstalk-deployment-options"><span class="toc-number">13.4.</span> <span class="toc-text"> Beanstalk deployment options</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#all-at-once"><span class="toc-number">13.4.1.</span> <span class="toc-text"> All at once</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rolling"><span class="toc-number">13.4.2.</span> <span class="toc-text"> Rolling</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rolling-with-additional-batches"><span class="toc-number">13.4.3.</span> <span class="toc-text"> Rolling with additional batches</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#immutable"><span class="toc-number">13.4.4.</span> <span class="toc-text"> Immutable</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#blue-green"><span class="toc-number">13.4.5.</span> <span class="toc-text"> Blue &#x2F; Green</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#traffic-splitting-canary-testing"><span class="toc-number">13.4.6.</span> <span class="toc-text"> Traffic splitting (Canary Testing)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#deploy-using-cli"><span class="toc-number">13.4.7.</span> <span class="toc-text"> Deploy using CLI</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#beanstalk-lifecycle-policy"><span class="toc-number">13.5.</span> <span class="toc-text"> Beanstalk lifecycle policy</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#beanstalk-extensions"><span class="toc-number">13.6.</span> <span class="toc-text"> Beanstalk extensions</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#beanstalk-vs-cloudformation"><span class="toc-number">13.7.</span> <span class="toc-text"> Beanstalk vs CloudFormation</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#elastic-beanstalk-cloning"><span class="toc-number">13.8.</span> <span class="toc-text"> Elastic Beanstalk cloning</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#beanstalk-migration"><span class="toc-number">13.9.</span> <span class="toc-text"> Beanstalk migration</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#load-balancer"><span class="toc-number">13.9.1.</span> <span class="toc-text"> load balancer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rds-2"><span class="toc-number">13.9.2.</span> <span class="toc-text"> RDS</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#single-docker"><span class="toc-number">13.10.</span> <span class="toc-text"> single Docker</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#multi-docker-containers"><span class="toc-number">13.11.</span> <span class="toc-text"> Multi Docker containers</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#elastic-beanstalk-and-https"><span class="toc-number">13.12.</span> <span class="toc-text"> Elastic Beanstalk and HTTPS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#web-server-vs-worker-environment"><span class="toc-number">13.13.</span> <span class="toc-text"> Web server vs worker environment</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#custom-platform-advanced"><span class="toc-number">13.14.</span> <span class="toc-text"> custom platform (advanced)</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cicd"><span class="toc-number">14.</span> <span class="toc-text"> CICD</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#introduction"><span class="toc-number">14.1.</span> <span class="toc-text"> Introduction</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#continuous-integration"><span class="toc-number">14.2.</span> <span class="toc-text"> Continuous integration</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#continuous-delivery"><span class="toc-number">14.3.</span> <span class="toc-text"> Continuous delivery</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#codecommit"><span class="toc-number">14.4.</span> <span class="toc-text"> CodeCommit</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#security-2"><span class="toc-number">14.4.1.</span> <span class="toc-text"> security</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#codecommit-vs-github"><span class="toc-number">14.4.2.</span> <span class="toc-text"> CodeCommit vs Github</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#notifications"><span class="toc-number">14.4.3.</span> <span class="toc-text"> notifications</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#codepipeline"><span class="toc-number">14.5.</span> <span class="toc-text"> CodePipeline</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#artifacts"><span class="toc-number">14.5.1.</span> <span class="toc-text"> artifacts</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#troubleshooting"><span class="toc-number">14.5.2.</span> <span class="toc-text"> troubleshooting</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#codebuild"><span class="toc-number">14.6.</span> <span class="toc-text"> CodeBuild</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#buildspec"><span class="toc-number">14.6.1.</span> <span class="toc-text"> BuildSpec</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#local-build"><span class="toc-number">14.6.2.</span> <span class="toc-text"> local build</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#codebuild-in-vpc"><span class="toc-number">14.6.3.</span> <span class="toc-text"> CodeBuild in VPC</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#codedeploy"><span class="toc-number">14.7.</span> <span class="toc-text"> CodeDeploy</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#steps"><span class="toc-number">14.7.1.</span> <span class="toc-text"> Steps</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#other-information"><span class="toc-number">14.7.2.</span> <span class="toc-text"> other information</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#primary-components"><span class="toc-number">14.7.3.</span> <span class="toc-text"> primary components</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#appspec"><span class="toc-number">14.7.4.</span> <span class="toc-text"> Appspec</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#deployment-config"><span class="toc-number">14.7.5.</span> <span class="toc-text"> Deployment config</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#codedeploy-for-ec2-and-asg"><span class="toc-number">14.7.6.</span> <span class="toc-text"> CodeDeploy for EC2 and ASG</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#codestar"><span class="toc-number">14.8.</span> <span class="toc-text"> CodeStar</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cloudformation"><span class="toc-number">15.</span> <span class="toc-text"> CloudFormation</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#infrastructure-as-code"><span class="toc-number">15.1.</span> <span class="toc-text"> infrastructure as code</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#benefits"><span class="toc-number">15.2.</span> <span class="toc-text"> benefits</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#how-cloudformation-works"><span class="toc-number">15.3.</span> <span class="toc-text"> how cloudformation works</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#deploying-cloudformation-template"><span class="toc-number">15.4.</span> <span class="toc-text"> deploying cloudformation template</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#building-blocks"><span class="toc-number">15.5.</span> <span class="toc-text"> building blocks</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#resources"><span class="toc-number">15.6.</span> <span class="toc-text"> resources</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#parameters"><span class="toc-number">15.7.</span> <span class="toc-text"> parameters</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#how-to-reference-a-parameter"><span class="toc-number">15.7.1.</span> <span class="toc-text"> how to reference a parameter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#pseudo-parameters"><span class="toc-number">15.7.2.</span> <span class="toc-text"> Pseudo parameters</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mappings"><span class="toc-number">15.8.</span> <span class="toc-text"> mappings</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#when-would-you-use-mappings-vs-parameters"><span class="toc-number">15.8.1.</span> <span class="toc-text"> when would you use mappings vs parameters</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#accessing-mapping-values"><span class="toc-number">15.8.2.</span> <span class="toc-text"> accessing mapping values</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#outputs"><span class="toc-number">15.9.</span> <span class="toc-text"> outputs</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#outputs-example"><span class="toc-number">15.9.1.</span> <span class="toc-text"> outputs example</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cross-stack-reference"><span class="toc-number">15.9.2.</span> <span class="toc-text"> Cross stack reference</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#conditions"><span class="toc-number">15.10.</span> <span class="toc-text"> conditions</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#define-a-conditon"><span class="toc-number">15.10.1.</span> <span class="toc-text"> define a conditon</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#using-a-condition"><span class="toc-number">15.10.2.</span> <span class="toc-text"> using a condition</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#intrinsic-functions"><span class="toc-number">15.11.</span> <span class="toc-text"> Intrinsic functions</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#fnref"><span class="toc-number">15.11.1.</span> <span class="toc-text"> Fn::Ref</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#fngetatt"><span class="toc-number">15.11.2.</span> <span class="toc-text"> Fn::GetAtt</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#fnfindinmap"><span class="toc-number">15.11.3.</span> <span class="toc-text"> Fn::FindInMap</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#fnimportvalue"><span class="toc-number">15.11.4.</span> <span class="toc-text"> Fn::ImportValue</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#fnjoin"><span class="toc-number">15.11.5.</span> <span class="toc-text"> Fn::Join</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#fnsub"><span class="toc-number">15.11.6.</span> <span class="toc-text"> Fn::Sub</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#condition-functions"><span class="toc-number">15.11.7.</span> <span class="toc-text"> Condition Functions</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cloudformation-rollbacks"><span class="toc-number">15.12.</span> <span class="toc-text"> CloudFormation rollbacks</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#changesets"><span class="toc-number">15.13.</span> <span class="toc-text"> ChangeSets</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#nested-stacks"><span class="toc-number">15.14.</span> <span class="toc-text"> Nested Stacks</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#cross-stack-vs-nested-stack"><span class="toc-number">15.14.1.</span> <span class="toc-text"> Cross stack vs nested stack</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#stacksets"><span class="toc-number">15.15.</span> <span class="toc-text"> StackSets</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cloudformation-drift"><span class="toc-number">15.16.</span> <span class="toc-text"> CloudFormation drift</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#monitoring"><span class="toc-number">16.</span> <span class="toc-text"> Monitoring</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#cloudwatch-metrics"><span class="toc-number">16.1.</span> <span class="toc-text"> CLoudWatch metrics</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#detailed-monitoring"><span class="toc-number">16.1.1.</span> <span class="toc-text"> Detailed monitoring</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cloudwatch-custom-metrics"><span class="toc-number">16.2.</span> <span class="toc-text"> CloudWatch Custom metrics</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cloudwatch-logs"><span class="toc-number">16.3.</span> <span class="toc-text"> CloudWatch logs</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cloudwatch-logs-for-ec2"><span class="toc-number">16.4.</span> <span class="toc-text"> CloudWatch logs for EC2</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#cloudwatch-logs-agent-vs-unified-agent"><span class="toc-number">16.4.1.</span> <span class="toc-text"> CloudWatch logs agent vs Unified agent</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cloudwatch-logs-metric-filter"><span class="toc-number">16.5.</span> <span class="toc-text"> CloudWatch logs metric filter</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cloudwatch-alarms"><span class="toc-number">16.6.</span> <span class="toc-text"> CloudWatch alarms</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#cloudwatch-alarm-targets"><span class="toc-number">16.6.1.</span> <span class="toc-text"> CloudWatch alarm targets</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#good-to-know"><span class="toc-number">16.6.2.</span> <span class="toc-text"> good to know</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cloudwatch-events"><span class="toc-number">16.7.</span> <span class="toc-text"> CloudWatch Events</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cloudwatch-event-bridge"><span class="toc-number">16.8.</span> <span class="toc-text"> CloudWatch event bridge</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#schema-registry"><span class="toc-number">16.8.1.</span> <span class="toc-text"> Schema registry</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#amazon-eventbridge-vs-cloudwatch-events"><span class="toc-number">16.9.</span> <span class="toc-text"> Amazon EventBridge vs CloudWatch events</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#x-ray"><span class="toc-number">16.10.</span> <span class="toc-text"> X-Ray</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#x-ray-advantages"><span class="toc-number">16.10.1.</span> <span class="toc-text"> X-ray advantages</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#tracing"><span class="toc-number">16.10.2.</span> <span class="toc-text"> tracing</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#how-to-enable"><span class="toc-number">16.10.3.</span> <span class="toc-text"> How to enable?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#x-ray-magic"><span class="toc-number">16.10.4.</span> <span class="toc-text"> X-Ray magic</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#x-ray-troubleshooting"><span class="toc-number">16.10.5.</span> <span class="toc-text"> X-Ray troubleshooting</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#x-ray-instrumentation-and-concepts"><span class="toc-number">16.11.</span> <span class="toc-text"> X-Ray instrumentation and concepts</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#x-ray-concepts"><span class="toc-number">16.11.1.</span> <span class="toc-text"> X-Ray concepts</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#x-ray-sampling-rules"><span class="toc-number">16.11.2.</span> <span class="toc-text"> X-Ray sampling rules</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#x-ray-with-beanstalk"><span class="toc-number">16.12.</span> <span class="toc-text"> X-Ray with Beanstalk</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cloudtrail"><span class="toc-number">16.13.</span> <span class="toc-text"> CloudTrail</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#cloudtrail-events"><span class="toc-number">16.13.1.</span> <span class="toc-text"> CloudTrail events</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cloudtrail-insights"><span class="toc-number">16.13.2.</span> <span class="toc-text"> CloudTrail insights</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cloudtrail-events-retention"><span class="toc-number">16.13.3.</span> <span class="toc-text"> CloudTrail events retention</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cloudtrail-vs-cloudwatch-vs-x-ray"><span class="toc-number">16.14.</span> <span class="toc-text"> CloudTrail vs CloudWatch vs X-Ray</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#sqs"><span class="toc-number">17.</span> <span class="toc-text"> SQS</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#communications-between-applications"><span class="toc-number">17.1.</span> <span class="toc-text"> Communications between applications</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sqs-standard-queue"><span class="toc-number">17.2.</span> <span class="toc-text"> SQS - standard queue</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#producing-messages"><span class="toc-number">17.3.</span> <span class="toc-text"> Producing messages</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#comsuming-messages"><span class="toc-number">17.4.</span> <span class="toc-text"> comsuming messages</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#multiple-ec2-instances-consumers"><span class="toc-number">17.5.</span> <span class="toc-text"> multiple EC2 instances consumers</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#security-3"><span class="toc-number">17.6.</span> <span class="toc-text"> security</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#message-visibility-timeout"><span class="toc-number">17.7.</span> <span class="toc-text"> message visibility timeout</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dead-letter-queue"><span class="toc-number">17.8.</span> <span class="toc-text"> Dead letter queue</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#delay-queue"><span class="toc-number">17.9.</span> <span class="toc-text"> delay queue</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#long-polling"><span class="toc-number">17.10.</span> <span class="toc-text"> long polling</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sqs-extended-client"><span class="toc-number">17.11.</span> <span class="toc-text"> SQS extended client</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#fifo-queue"><span class="toc-number">17.12.</span> <span class="toc-text"> FIFO queue</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#fifo-deduplication"><span class="toc-number">17.12.1.</span> <span class="toc-text"> FIFO deduplication</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#message-grouping"><span class="toc-number">17.12.2.</span> <span class="toc-text"> message grouping</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#sns"><span class="toc-number">18.</span> <span class="toc-text"> SNS</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#how-to-publish"><span class="toc-number">18.1.</span> <span class="toc-text"> How to publish</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#security-4"><span class="toc-number">18.2.</span> <span class="toc-text"> security</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sns-sqs-fan-out"><span class="toc-number">18.3.</span> <span class="toc-text"> SNS + SQS: Fan out</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#s3-events-to-multiple-queues"><span class="toc-number">18.4.</span> <span class="toc-text"> S3 events to multiple queues</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sns-fifo"><span class="toc-number">18.5.</span> <span class="toc-text"> SNS - FIFO</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#message-filtering"><span class="toc-number">18.6.</span> <span class="toc-text"> message filtering</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#kinesis"><span class="toc-number">19.</span> <span class="toc-text"> Kinesis</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#kinesis-data-streams"><span class="toc-number">19.1.</span> <span class="toc-text"> Kinesis data streams</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#kinesis-data-streams-security"><span class="toc-number">19.1.1.</span> <span class="toc-text"> Kinesis data streams security</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#kinesis-consumers"><span class="toc-number">19.2.</span> <span class="toc-text"> Kinesis consumers</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#kinesis-consumer-types"><span class="toc-number">19.2.1.</span> <span class="toc-text"> Kinesis consumer types</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#kinesis-client-library-kcl"><span class="toc-number">19.3.</span> <span class="toc-text"> Kinesis Client library (KCL)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#kinesis-operations"><span class="toc-number">19.4.</span> <span class="toc-text"> Kinesis operations</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#shard-splitting"><span class="toc-number">19.4.1.</span> <span class="toc-text"> Shard splitting</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#merging-shards"><span class="toc-number">19.4.2.</span> <span class="toc-text"> merging shards</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#kinesis-data-firehose"><span class="toc-number">19.5.</span> <span class="toc-text"> Kinesis data firehose</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#kinesis-data-streams-vs-firehose"><span class="toc-number">19.5.1.</span> <span class="toc-text"> Kinesis data streams vs Firehose</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#kinesis-data-analytics-sql-application"><span class="toc-number">19.6.</span> <span class="toc-text"> Kinesis data analytics (SQL application)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sqs-vs-sns-vs-kinesis"><span class="toc-number">19.7.</span> <span class="toc-text"> SQS vs SNS vs Kinesis</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#sqs-2"><span class="toc-number">19.7.1.</span> <span class="toc-text"> SQS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sns-2"><span class="toc-number">19.7.2.</span> <span class="toc-text"> SNS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#kinesis-2"><span class="toc-number">19.7.3.</span> <span class="toc-text"> Kinesis</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#kinesis-vs-sqs-ordering"><span class="toc-number">19.8.</span> <span class="toc-text"> Kinesis vs SQS ordering</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#lambda"><span class="toc-number">20.</span> <span class="toc-text"> Lambda</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#what-is-serverless"><span class="toc-number">20.1.</span> <span class="toc-text"> what is serverless</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#serverless-in-aws"><span class="toc-number">20.1.1.</span> <span class="toc-text"> serverless in AWS</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lambda-synchronous-invocations"><span class="toc-number">20.2.</span> <span class="toc-text"> Lambda synchronous invocations</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lambda-integration-with-alb"><span class="toc-number">20.3.</span> <span class="toc-text"> lambda integration with ALB</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#alb-multi-healer-values"><span class="toc-number">20.3.1.</span> <span class="toc-text"> ALB multi healer values</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lambdaedge"><span class="toc-number">20.4.</span> <span class="toc-text"> lambda@Edge</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lambda-asynchronous-invocations"><span class="toc-number">20.5.</span> <span class="toc-text"> lambda - asynchronous invocations</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lambda-event-source-mapping"><span class="toc-number">20.6.</span> <span class="toc-text"> lambda event source mapping</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#streams-and-lambda-kinesis-and-dynamodb"><span class="toc-number">20.6.1.</span> <span class="toc-text"> Streams and lambda (Kinesis and DynamoDB)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#streams-and-lambda-error-handling"><span class="toc-number">20.6.2.</span> <span class="toc-text"> Streams and lambda - error handling</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sqs-and-sqs-fifo-with-lambda"><span class="toc-number">20.6.3.</span> <span class="toc-text"> SQS and SQS FIFO with lambda</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lambda-event-mapper-scaling"><span class="toc-number">20.6.4.</span> <span class="toc-text"> lambda event mapper scaling</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lambda-destinations"><span class="toc-number">20.7.</span> <span class="toc-text"> lambda - Destinations</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lambda-permissions-iam-roles-and-resource-policies"><span class="toc-number">20.8.</span> <span class="toc-text"> lambda permissions - IAM roles and resource policies</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lambda-environment-variables"><span class="toc-number">20.9.</span> <span class="toc-text"> lambda environment variables</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lambda-logging-and-monitoring"><span class="toc-number">20.10.</span> <span class="toc-text"> lambda logging and monitoring</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#lambda-tracing-with-x-ray"><span class="toc-number">20.10.1.</span> <span class="toc-text"> lambda tracing with X-Ray</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lambda-in-vpc"><span class="toc-number">20.11.</span> <span class="toc-text"> lambda in VPC</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#lambda-by-default"><span class="toc-number">20.11.1.</span> <span class="toc-text"> lambda by default</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lambda-in-vpc-2"><span class="toc-number">20.11.2.</span> <span class="toc-text"> lambda in VPC</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#internet-access"><span class="toc-number">20.11.3.</span> <span class="toc-text"> internet access</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lambda-function-performance"><span class="toc-number">20.12.</span> <span class="toc-text"> lambda function performance</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#configuration"><span class="toc-number">20.12.1.</span> <span class="toc-text"> configuration</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lambda-execution-context"><span class="toc-number">20.12.2.</span> <span class="toc-text"> lambda execution context</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lambda-function-tmp-space"><span class="toc-number">20.12.3.</span> <span class="toc-text"> lambda function &#x2F;tmp space</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lambda-concurrency"><span class="toc-number">20.13.</span> <span class="toc-text"> lambda concurrency</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#lambda-concurrency-and-asynchronous-invocations"><span class="toc-number">20.13.1.</span> <span class="toc-text"> lambda concurrency and asynchronous invocations</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#cold-start-and-provisioned-concurrency"><span class="toc-number">20.13.2.</span> <span class="toc-text"> Cold start and provisioned concurrency</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lambda-external-dependencies"><span class="toc-number">20.14.</span> <span class="toc-text"> lambda external dependencies</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lambda-and-cloudformation"><span class="toc-number">20.15.</span> <span class="toc-text"> lambda and CloudFormation</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#inline"><span class="toc-number">20.15.1.</span> <span class="toc-text"> inline</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#through-s3"><span class="toc-number">20.15.2.</span> <span class="toc-text"> through S3</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lambda-layers"><span class="toc-number">20.16.</span> <span class="toc-text"> lambda layers</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lambda-container-images"><span class="toc-number">20.17.</span> <span class="toc-text"> lambda container images</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lambda-versions-and-aliases"><span class="toc-number">20.18.</span> <span class="toc-text"> lambda versions and aliases</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#lambda-versions"><span class="toc-number">20.18.1.</span> <span class="toc-text"> lambda versions</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#lambda-aliases"><span class="toc-number">20.18.2.</span> <span class="toc-text"> lambda aliases</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lambda-and-codedeploy"><span class="toc-number">20.19.</span> <span class="toc-text"> lambda and CodeDeploy</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lambda-limits-good-to-know-per-region"><span class="toc-number">20.20.</span> <span class="toc-text"> lambda limits good to know - per region</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lambda-best-practices"><span class="toc-number">20.21.</span> <span class="toc-text"> lambda best practices</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#dynamodb"><span class="toc-number">21.</span> <span class="toc-text"> DynamoDB</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#nosql-database"><span class="toc-number">21.1.</span> <span class="toc-text"> NoSQL database</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#amazon-dynamodb"><span class="toc-number">21.2.</span> <span class="toc-text"> Amazon DynamoDB</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#basics"><span class="toc-number">21.3.</span> <span class="toc-text"> basics</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#read-write-capacity-modes"><span class="toc-number">21.4.</span> <span class="toc-text"> Read &#x2F; Write capacity modes</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#rw-capacity-modes-provisioned"><span class="toc-number">21.5.</span> <span class="toc-text"> R&#x2F;W capacity modes - provisioned</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#write-capacity-units-wcu"><span class="toc-number">21.6.</span> <span class="toc-text"> Write Capacity units (WCU)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#strongly-consistent-read-vs-eventually-consistent-read"><span class="toc-number">21.7.</span> <span class="toc-text"> Strongly consistent read vs Eventually consistent read</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#read-capacity-units-rcu"><span class="toc-number">21.8.</span> <span class="toc-text"> Read capacity units (RCU)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#paritions-internal"><span class="toc-number">21.9.</span> <span class="toc-text"> Paritions Internal</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#throttling"><span class="toc-number">21.10.</span> <span class="toc-text"> Throttling</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#on-demand"><span class="toc-number">21.11.</span> <span class="toc-text"> on demand</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#writing-data"><span class="toc-number">21.12.</span> <span class="toc-text"> writing data</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#reading-data"><span class="toc-number">21.13.</span> <span class="toc-text"> reading data</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#reading-data-query"><span class="toc-number">21.14.</span> <span class="toc-text"> reading data - query</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#reading-data-scan"><span class="toc-number">21.15.</span> <span class="toc-text"> reading data - scan</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#deleting-data"><span class="toc-number">21.16.</span> <span class="toc-text"> deleting data</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#batch-operations"><span class="toc-number">21.17.</span> <span class="toc-text"> batch operations</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#local-secondary-index-lsi"><span class="toc-number">21.18.</span> <span class="toc-text"> Local Secondary Index (LSI)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#global-secondary-index-gsi"><span class="toc-number">21.19.</span> <span class="toc-text"> Global secondary index (GSI)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#indexes-and-throttling"><span class="toc-number">21.20.</span> <span class="toc-text"> indexes and throttling</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#optimistic-locking"><span class="toc-number">21.21.</span> <span class="toc-text"> Optimistic locking</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dynamodb-dax"><span class="toc-number">21.22.</span> <span class="toc-text"> DynamoDB DAX</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#dax-vs-elasticache"><span class="toc-number">21.22.1.</span> <span class="toc-text"> DAX vs ElastiCache</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dynamodb-streams"><span class="toc-number">21.23.</span> <span class="toc-text"> DynamoDB Streams</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#streams-and-lambda"><span class="toc-number">21.23.1.</span> <span class="toc-text"> Streams and lambda</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dynamodb-ttl"><span class="toc-number">21.24.</span> <span class="toc-text"> DynamoDB TTL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dynamodb-cli"><span class="toc-number">21.25.</span> <span class="toc-text"> DynamoDB CLI</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dynamodb-transactions"><span class="toc-number">21.26.</span> <span class="toc-text"> DynamoDB transactions</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dynamodb-session-state-cache"><span class="toc-number">21.27.</span> <span class="toc-text"> DynamoDB Session State Cache</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dynamodb-security-and-other-features"><span class="toc-number">21.28.</span> <span class="toc-text"> DynamoDB Security and other features</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#fine-grained-access-control"><span class="toc-number">21.28.1.</span> <span class="toc-text"> Fine-Grained access control</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#api-gateway"><span class="toc-number">22.</span> <span class="toc-text"> API Gateway</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#integrations-high-level"><span class="toc-number">22.1.</span> <span class="toc-text"> Integrations high level</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#endpoint-types"><span class="toc-number">22.2.</span> <span class="toc-text"> endpoint types</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#deployment-stages"><span class="toc-number">22.3.</span> <span class="toc-text"> Deployment stages</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#stage-variables"><span class="toc-number">22.3.1.</span> <span class="toc-text"> stage variables</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#stage-variables-with-lambda-aliases"><span class="toc-number">22.3.2.</span> <span class="toc-text"> stage variables with lambda aliases</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#canary-deployment"><span class="toc-number">22.4.</span> <span class="toc-text"> canary deployment</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#api-gateway-integration-types"><span class="toc-number">22.5.</span> <span class="toc-text"> API Gateway - Integration types</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#mapping-template"><span class="toc-number">22.5.1.</span> <span class="toc-text"> Mapping template</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mapping-template-json-to-xml-with-soap"><span class="toc-number">22.5.2.</span> <span class="toc-text"> Mapping template: JSON to XML with SOAP</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#api-gateway-swagger-open-api-spec"><span class="toc-number">22.6.</span> <span class="toc-text"> API Gateway Swagger &#x2F; Open API spec</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#caching-api-response"><span class="toc-number">22.7.</span> <span class="toc-text"> Caching API response</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#api-gateway-cache-invalidation"><span class="toc-number">22.7.1.</span> <span class="toc-text"> API Gateway cache invalidation</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#usage-plan-and-api-keys"><span class="toc-number">22.8.</span> <span class="toc-text"> Usage plan and API keys</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#logging-and-tracing"><span class="toc-number">22.9.</span> <span class="toc-text"> logging and tracing</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cloudwatch-metrics-2"><span class="toc-number">22.10.</span> <span class="toc-text"> CloudWatch metrics</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#throttling-2"><span class="toc-number">22.11.</span> <span class="toc-text"> throttling</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cors-2"><span class="toc-number">22.12.</span> <span class="toc-text"> CORS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#authentication-and-authorization"><span class="toc-number">22.13.</span> <span class="toc-text"> Authentication and Authorization</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#websocket-api"><span class="toc-number">22.14.</span> <span class="toc-text"> WebSocket API</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#routing"><span class="toc-number">22.14.1.</span> <span class="toc-text"> Routing</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#architecture"><span class="toc-number">22.15.</span> <span class="toc-text"> Architecture</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#sam-serverless-application-model"><span class="toc-number">23.</span> <span class="toc-text"> SAM (serverless application model)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#recipe"><span class="toc-number">23.1.</span> <span class="toc-text"> Recipe</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sam-policy-templates"><span class="toc-number">23.2.</span> <span class="toc-text"> SAM policy templates</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sam-sumary"><span class="toc-number">23.3.</span> <span class="toc-text"> SAM Sumary</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#serverless-application-repository-sar"><span class="toc-number">23.4.</span> <span class="toc-text"> Serverless Application Repository (SAR)</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cloud-development-kit-cdk"><span class="toc-number">24.</span> <span class="toc-text"> Cloud Development Kit (CDK)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#cdk-vs-sam"><span class="toc-number">24.1.</span> <span class="toc-text"> CDK vs SAM</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#cognito"><span class="toc-number">25.</span> <span class="toc-text"> Cognito</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#cognito-user-pools"><span class="toc-number">25.1.</span> <span class="toc-text"> Cognito User Pools</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cognito-identity-pools"><span class="toc-number">25.2.</span> <span class="toc-text"> Cognito Identity Pools</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#iam-roles"><span class="toc-number">25.2.1.</span> <span class="toc-text"> IAM roles</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cognito-user-pools-vs-cognito-identity-pools"><span class="toc-number">25.3.</span> <span class="toc-text"> Cognito User Pools vs Cognito Identity Pools</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cognito-sync"><span class="toc-number">25.4.</span> <span class="toc-text"> Cognito Sync</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#step-functions"><span class="toc-number">26.</span> <span class="toc-text"> Step Functions</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#task-states"><span class="toc-number">26.1.</span> <span class="toc-text"> task states</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#states"><span class="toc-number">26.2.</span> <span class="toc-text"> states</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#error-handling"><span class="toc-number">26.3.</span> <span class="toc-text"> Error handling</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#retry"><span class="toc-number">26.3.1.</span> <span class="toc-text"> Retry</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#catch"><span class="toc-number">26.3.2.</span> <span class="toc-text"> Catch</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#resultpath"><span class="toc-number">26.3.3.</span> <span class="toc-text"> ResultPath</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#appsync"><span class="toc-number">27.</span> <span class="toc-text"> AppSync</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#security-5"><span class="toc-number">27.1.</span> <span class="toc-text"> Security</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#sts-security-token-service"><span class="toc-number">28.</span> <span class="toc-text"> STS (security Token service)</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#using-sts-to-assume-a-role"><span class="toc-number">28.1.</span> <span class="toc-text"> using STS to assume a role</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sts-with-mfa"><span class="toc-number">28.2.</span> <span class="toc-text"> STS with MFA</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#advanced-iam"><span class="toc-number">29.</span> <span class="toc-text"> Advanced IAM</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#iam-policies-and-s3-bucket-policies"><span class="toc-number">29.1.</span> <span class="toc-text"> IAM policies and S3 Bucket policies</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dynamic-policies-with-iam"><span class="toc-number">29.2.</span> <span class="toc-text"> Dynamic policies with IAM</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#inline-vs-managed-policies"><span class="toc-number">29.3.</span> <span class="toc-text"> inline vs managed policies</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#granting-a-user-permissions-to-pass-a-role-to-an-aws-service"><span class="toc-number">29.4.</span> <span class="toc-text"> granting a user permissions to pass a role to an AWS service</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#can-a-role-be-passed-to-any-service"><span class="toc-number">29.4.1.</span> <span class="toc-text"> can a role be passed to any service?</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#directory-service-overview"><span class="toc-number">29.5.</span> <span class="toc-text"> Directory service - overview</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#kms"><span class="toc-number">30.</span> <span class="toc-text"> KMS</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#encryption"><span class="toc-number">30.1.</span> <span class="toc-text"> Encryption</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#encryption-in-flight"><span class="toc-number">30.1.1.</span> <span class="toc-text"> Encryption in flight</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#server-side-encryption-at-rest"><span class="toc-number">30.1.2.</span> <span class="toc-text"> server side encryption at rest</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#client-side-encryption-2"><span class="toc-number">30.1.3.</span> <span class="toc-text"> Client side encryption</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#aws-kms"><span class="toc-number">30.2.</span> <span class="toc-text"> AWS KMS</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cmk-types"><span class="toc-number">30.3.</span> <span class="toc-text"> CMK Types</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#kms-key-policies"><span class="toc-number">30.4.</span> <span class="toc-text"> KMS key policies</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#copying-snapshots-across-accounts"><span class="toc-number">30.4.1.</span> <span class="toc-text"> copying snapshots across accounts</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#envelope-encryption"><span class="toc-number">30.5.</span> <span class="toc-text"> Envelope encryption</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#encryption-sdk"><span class="toc-number">30.5.1.</span> <span class="toc-text"> Encryption SDK</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#kms-symmetric-api-summary"><span class="toc-number">30.6.</span> <span class="toc-text"> KMS symmetric - API summary</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#quota-limits"><span class="toc-number">30.7.</span> <span class="toc-text"> Quota limits</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#sse-kms-deep-dive"><span class="toc-number">30.8.</span> <span class="toc-text"> SSE-KMS deep dive</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#s3-bucket-policies-force-ssl"><span class="toc-number">30.8.1.</span> <span class="toc-text"> S3 bucket policies - force SSL</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#s3-bucket-policy-force-encryption-of-sse-kms"><span class="toc-number">30.8.2.</span> <span class="toc-text"> S3 bucket policy - force encryption of SSE-KMS</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#s3-bucket-key-for-sse-kms-encryption"><span class="toc-number">30.9.</span> <span class="toc-text"> S3 bucket key for SSE-KMS encryption</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ssm-parameter-store"><span class="toc-number">31.</span> <span class="toc-text"> SSM Parameter Store</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#parameter-policies"><span class="toc-number">31.1.</span> <span class="toc-text"> Parameter policies</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#secrets-manager"><span class="toc-number">32.</span> <span class="toc-text"> Secrets Manager</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ssm-parameter-store-vs-secrets-manager"><span class="toc-number">32.1.</span> <span class="toc-text"> SSM Parameter store vs secrets manager</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cloudwatch-logs-encryption"><span class="toc-number">32.2.</span> <span class="toc-text"> CloudWatch logs - encryption</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#acm-aws-certificate-manager"><span class="toc-number">33.</span> <span class="toc-text"> ACM (AWS certificate manager)</span></a></li></ol>
    </nav>
  </div>
</aside>

<main class="main" role="main">
  <div class="content">
  <article id="post-AWS-DVA-review" class="article article-type-post" itemscope itemtype="http://schema.org/BlogPosting">
    
    <div class="article-header">
      
        
  
    <h1 class="article-title" itemprop="name">
      AWS DVA review
    </h1>
  

      
      <div class="article-meta">
        <span class="article-date">
    <i class="icon icon-calendar-check"></i>
	<a href="/2021/09/12/AWS-DVA-review/" class="article-date">
	  <time datetime="2021-09-11T16:06:00.000Z" itemprop="datePublished">12-09-2021</time>
	</a>
</span>
        
        
  <span class="article-tag">
    <i class="icon icon-tags"></i>
	<a class="article-tag-link-link" href="/tags/AWS/" rel="tag">AWS</a>
  </span>


        

        <span class="post-comment"><i class="icon icon-comment"></i> <a href="/2021/09/12/AWS-DVA-review/#comments" class="article-comment-link">Comments</a></span>
        
	
		<span class="post-wordcount hidden-xs" itemprop="wordCount">Word Count: 24.5k(words)</span>
	
	
		<span class="post-readcount hidden-xs" itemprop="timeRequired">Read Count: 153(minutes)</span>
	

      </div>
    </div>
    <div class="article-entry marked-body" itemprop="articleBody">
      
        <h1 id="i-passed"><a class="markdownIt-Anchor" href="#i-passed"></a> I PASSED!</h1>
<p><img src="/../images/AWS-DVA-Review/AWSCertifiedDeveloperAssociatecertificate.png" alt="" /><br />
<a target="_blank" rel="noopener" href="https://www.credly.com/badges/1ccb74e0-f7a1-4e64-9ca2-c1c5b1ece31a?source=linked_in_profile">View My Certificate</a></p>
<h1 id="elb-asg"><a class="markdownIt-Anchor" href="#elb-asg"></a> ELB + ASG</h1>
<h2 id="why-use-a-load-balancer"><a class="markdownIt-Anchor" href="#why-use-a-load-balancer"></a> Why use a load balancer</h2>
<ul>
<li>spread load across multiple downstream instances</li>
<li>expose a single point of access (DNS) to your application</li>
<li>seamlessly handle faliures of downstream instances</li>
<li>do regular health checks to your instances</li>
<li>provide SSL termination (HTTPS) for your websites</li>
<li>enforce stickness with cookies</li>
<li>high availability across zones</li>
<li>separate public traffic from private traffic</li>
</ul>
<h3 id="elb-integrated-with-many-aws-services"><a class="markdownIt-Anchor" href="#elb-integrated-with-many-aws-services"></a> ELB integrated with many AWS services</h3>
<ul>
<li>EC2, ASG, ECS</li>
<li>ACM, CloudWatch</li>
<li>Route 53, WAF, Global Accelerator</li>
</ul>
<h2 id="alb"><a class="markdownIt-Anchor" href="#alb"></a> ALB</h2>
<ul>
<li>Layer 7 (HTTP)</li>
<li>load balancing to multiple HTTP applications across machines (target groups)</li>
<li>load balancing to multiple applications on the same machine (containers)</li>
<li>support for HTTP and WebSockets</li>
<li>support redirects (from HTTP to HTTPS)</li>
<li>routing tables to different target groups
<ul>
<li>based on path in URL</li>
<li>based on hostname in URL</li>
<li>routing based on query string, headers</li>
</ul>
</li>
<li>ALB are a great fit for micro services and container based application</li>
<li>has a port mapping feature to redirect to a dynamic port in ECS</li>
<li>in comparison, we need multiple CLB per application</li>
<li>the application doesn’t see the client IP directly</li>
</ul>
<h3 id="target-groups"><a class="markdownIt-Anchor" href="#target-groups"></a> Target groups</h3>
<ul>
<li>EC2 instances</li>
<li>ECS tasks</li>
<li>lambda functions (HTTP request is translated into a JSON event)</li>
<li>IP addresses - must be private IPs</li>
<li>ALB can route to multiple target groups, each target group could have multiple instances</li>
<li>health checks are at the target group level</li>
<li>you can set rules to decide which target groups to redirect the traffic</li>
</ul>
<h2 id="nlb"><a class="markdownIt-Anchor" href="#nlb"></a> NLB</h2>
<ul>
<li>layer 4 (TCP and UDP)</li>
<li>handle millions of request per second, lower latency</li>
<li>NLB has one static IP per AZ, and supports assigning Elastic IP (helpful for whitelisting specific IP)</li>
<li>NLB are used for extreme performance, TCP or UDP traffic</li>
</ul>
<h2 id="sticky-sessions"><a class="markdownIt-Anchor" href="#sticky-sessions"></a> Sticky Sessions</h2>
<ul>
<li>it is possible to implement stickness so that the same client is always redirected to the same instance behind a load balancer</li>
<li>this works for CLB and ALB</li>
<li>the cookie used for stickness has an expiration date you control</li>
<li>use case: make sure the user doesn’t lose his session data</li>
<li>enabling stickness may bring imbalance to the load over the backend EC2 instnaces</li>
</ul>
<h2 id="ssl-server-name-indication"><a class="markdownIt-Anchor" href="#ssl-server-name-indication"></a> SSL - server name indication</h2>
<ul>
<li>SNL solves the problem of loading multiple SSL certificates onto one web server (to serve multiple websites)</li>
<li>it is a newer protocol, and requires the client to indicate the hostname and the target server in the initial SSL handshake</li>
<li>the server will then find the correct certificate, or return the default one</li>
<li>only works for ALB and NLB, CloudFront</li>
</ul>
<h2 id="connection-draining-de-registration-delay"><a class="markdownIt-Anchor" href="#connection-draining-de-registration-delay"></a> Connection Draining (De-registration delay)</h2>
<ul>
<li>time to complete the in-flight requests while the instance is de-registering or unhealthy</li>
<li>stops sending new requests to the EC2 instances which is de-registering</li>
<li>between 1 to 3600 seconds (default 300 seconds)</li>
<li>can be disabled (set value to 0)</li>
<li>set to a low value if your requests are short</li>
<li>instances will be terminated after the draining time is over</li>
</ul>
<h2 id="x-forwarded-for-and-x-forwarded-proto"><a class="markdownIt-Anchor" href="#x-forwarded-for-and-x-forwarded-proto"></a> X-Forwarded-For and X-Forwarded-Proto</h2>
<ul>
<li>X-Forwarded-For
<ul>
<li>The X-Forwarded-For (XFF) header is a de-facto standard header for identifying the originating IP address of a client connecting to a web server through an HTTP proxy or a load balancer. When traffic is intercepted between clients and servers, server access logs contain the IP address of the proxy or load balancer only. To see the original IP address of the client, the X-Forwarded-For request header is used.</li>
</ul>
</li>
<li>X-Forwarded-Proto
<ul>
<li>The X-Forwarded-Proto (XFP) header is a de-facto standard header for identifying the protocol (HTTP or HTTPS) that a client used to connect to your proxy or load balancer. Your server access logs contain the protocol used between the server and the load balancer, but not the protocol used between the client and the load balancer. To determine the protocol used between the client and the load balancer, the X-Forwarded-Proto request header can be used.</li>
</ul>
</li>
</ul>
<h2 id="asg"><a class="markdownIt-Anchor" href="#asg"></a> ASG</h2>
<ul>
<li>A launch configuration (launch template is the newer version)
<ul>
<li>AMI + instance type</li>
<li>EC2 user data</li>
<li>EBS volume</li>
<li>security groups</li>
<li>SSH key pair</li>
</ul>
</li>
<li>min size, max size, initial capacity</li>
<li>network + subnets information</li>
<li>load balancer information (so ASG knows which target group to launch the instnace), ASG and ELB can be linked</li>
<li>scaling policies</li>
<li>it is possible to scale an ASG based on CloudWatch alarms</li>
<li>an alarm monitors a metric (such as average CPU)</li>
<li>metrics are computed for the overall ASG instnaces</li>
<li>to update an ASG, you must provide a new launch configuration or new launch template</li>
<li>IAM roles attached to an ASG will get assigned to EC2 instances launched</li>
<li>ASG is free, you need to pay for the underlying resources launched</li>
</ul>
<h3 id="scaling-policies"><a class="markdownIt-Anchor" href="#scaling-policies"></a> Scaling Policies</h3>
<ul>
<li>Target tracking scaling
<ul>
<li>most simple and easy to setup</li>
<li>example: I want the average ASG CPU to stay at around 40%</li>
</ul>
</li>
<li>Simple / Step scaling
<ul>
<li>when a CloudWatch alarm is triggered, then add 2 units</li>
<li>when a CloudWatch alarm is triggered, then remove 1 unit</li>
<li>the difference between simple and step scaling policies are: for step policy, you can create step adjustments, and ASG will change the number of instances based on the size of the alarm breach.</li>
</ul>
</li>
<li>scheduled actions
<ul>
<li>anticipate a scaling based on known usage patterns</li>
<li>example: increase the min capacity to 10 at 5pm on Fridays</li>
</ul>
</li>
<li>predictive scaling
<ul>
<li>continuously forecast load and schedule scaling ahead</li>
</ul>
</li>
</ul>
<h3 id="good-metrics-to-scale-on"><a class="markdownIt-Anchor" href="#good-metrics-to-scale-on"></a> Good metrics to scale on</h3>
<ul>
<li>CPU utilization</li>
<li>request count per target</li>
<li>average network in / out</li>
</ul>
<h3 id="scaling-cooldowns"><a class="markdownIt-Anchor" href="#scaling-cooldowns"></a> Scaling cooldowns</h3>
<ul>
<li>after a scaling policy happens, you are in the cooldown period (default is 300 seconds)</li>
<li>during the cooldown period, the ASG will not launch or terminate additional instance (to allow for metrics to stablize)</li>
<li>advice: use a ready to use AMI to reduce configuration time in order to be serving request faster and reduce the cooldown period</li>
</ul>
<h1 id="rds"><a class="markdownIt-Anchor" href="#rds"></a> RDS</h1>
<ul>
<li>
<p>managed DB service for DB use SQL as a language</p>
</li>
<li>
<p>it allows you to create databases in the cloud that are managed by AWS</p>
<ul>
<li>Postgres</li>
<li>MySQL</li>
<li>MariaDB</li>
<li>Oracle</li>
<li>SQL server</li>
<li>Aurora</li>
</ul>
</li>
<li>
<p>RDS is a managed service</p>
<ul>
<li>automated provisioning, OS patching</li>
<li>continuous backups and restore to specific timestamp (point in time restore)</li>
<li>monitoring dashboards</li>
<li>read replicas for improved read performance</li>
<li>Multi AZ setup for DR</li>
<li>maintenance windows for upgrades</li>
<li>scaling capability</li>
<li>storage backup by EBS</li>
<li>RDS DB will be launched in a VPC in an AZ</li>
</ul>
</li>
<li>
<p>you can’t SSH into your instances</p>
</li>
</ul>
<h2 id="rds-backups"><a class="markdownIt-Anchor" href="#rds-backups"></a> RDS backups</h2>
<ul>
<li>Automated backups
<ul>
<li>daily full backup of the database</li>
<li>transaction logs are backuped by RDS every 5 mins</li>
<li>ability to restore to any point in time (from oldest to 5 mins ago)</li>
<li>7 days retention (can be increased to 35 days)</li>
</ul>
</li>
<li>DB snapshots
<ul>
<li>manually triggered by the user</li>
<li>retention of backup for as long as you want</li>
</ul>
</li>
</ul>
<h2 id="rds-storage-auto-scaling"><a class="markdownIt-Anchor" href="#rds-storage-auto-scaling"></a> RDS storage auto scaling</h2>
<ul>
<li>helps you increase storage on your RDS DB instnace dynamically</li>
<li>when RDS detects you are running out of free database storage, it scales automatically</li>
<li>avoid manually scaling your database storage</li>
<li>you have to set Maximum storage threshold</li>
<li>automatically modify storage if
<ul>
<li>free storage is less than 10% of allocated storage</li>
<li>low storage lasts at least 5 mins</li>
<li>6 hours have passed since last modification</li>
</ul>
</li>
<li>useful for applications with unpredictable workloads</li>
</ul>
<h2 id="rds-read-replicas-for-read-scalability"><a class="markdownIt-Anchor" href="#rds-read-replicas-for-read-scalability"></a> RDS read replicas for read scalability</h2>
<ul>
<li>up to 5 read replicas</li>
<li>within AZ, cross AZ or cross region</li>
<li>replication is async, so reads are eventually consistent</li>
<li>replicas can be promoted to their own DB</li>
<li>applications must update the connection string to leverage read replicas</li>
</ul>
<h2 id="rds-read-replicas-use-case"><a class="markdownIt-Anchor" href="#rds-read-replicas-use-case"></a> RDS read replicas - use case</h2>
<ul>
<li>you have a production database, that is taking on normal load</li>
<li>you want to run a reporting application to run some analytics</li>
<li>you create a read replica to run the new workload there</li>
<li>the production application is unaffected</li>
<li>read replicas are used for SELECT only kind of statements</li>
</ul>
<h2 id="rds-read-replicas-network-cost"><a class="markdownIt-Anchor" href="#rds-read-replicas-network-cost"></a> RDS read replicas - network cost</h2>
<ul>
<li>in AWS there is a network cost when data goes from one AZ to another</li>
<li>for RDS read replicas, within the same region, you don’t pay that fee, but you do need to pay if data goes to another region</li>
</ul>
<h2 id="rds-multi-az-dr"><a class="markdownIt-Anchor" href="#rds-multi-az-dr"></a> RDS multi AZ (DR)</h2>
<ul>
<li>SYNC replication</li>
<li>one DNS name - automatic app failover to standby</li>
<li>increase availability</li>
<li>failover in case of loss of AZ, loss of network, instance or storage failure</li>
<li>no manual intervention in apps</li>
<li>not used for scaling (standby instance can’t be read or write)</li>
<li>NOTE: the read replicas can be setup as Multi AZ for DR</li>
</ul>
<h2 id="rds-from-single-az-to-multi-az"><a class="markdownIt-Anchor" href="#rds-from-single-az-to-multi-az"></a> RDS from single AZ to Multi AZ</h2>
<ul>
<li>zero downtime operation (no need to stop the DB)</li>
<li>just click on modify for the database</li>
<li>the following happens internally
<ul>
<li>a snapshot is taken</li>
<li>a new DB is restored from the snapshot in a new AZ</li>
<li>synchronization is established between the two databases</li>
</ul>
</li>
</ul>
<h2 id="rds-security-encryption"><a class="markdownIt-Anchor" href="#rds-security-encryption"></a> RDS security - encryption</h2>
<ul>
<li>at rest encryption
<ul>
<li>possibility to encrypt the master and read replicas with AWS KMS - AES-256 encryption</li>
<li>encryption has to be defined at launch time</li>
<li>if the master is not encrypted, the read replicas cannot be encrypted</li>
</ul>
</li>
<li>in flight encryption
<ul>
<li>SSL certificates to encrypt data to RDS in flight</li>
<li>provide SSL options with trust certificate when connecting to database</li>
</ul>
</li>
</ul>
<h2 id="rds-encryption-operations"><a class="markdownIt-Anchor" href="#rds-encryption-operations"></a> RDS encryption operations</h2>
<ul>
<li>encrypting RDS backups
<ul>
<li>snapshots of unencrypted RDS databases are un-encrypted</li>
<li>snapshots of encrypted RDS databases are encrypted</li>
<li>can copy a snapshot into an encrypted one</li>
</ul>
</li>
<li>to encrypt an un-encrypted RDS database
<ul>
<li>create a snapshot of the un-encrypted database</li>
<li>copy the snapshot and enable encryption for the snapshot</li>
<li>restore the database from the encrypted snapshot</li>
<li>migrate applications to the new database, and delete the old database</li>
</ul>
</li>
</ul>
<h2 id="rds-security-network-and-iam"><a class="markdownIt-Anchor" href="#rds-security-network-and-iam"></a> RDS security - Network and IAM</h2>
<ul>
<li>network security
<ul>
<li>RDS databases are usually deployed within a private subnet, not in a public one</li>
<li>RDS security works by leveraging security groups (the same concept as for EC2 instances) - it controls which IP / security group can communicate with RDS</li>
</ul>
</li>
<li>Access management
<ul>
<li>IAM policies help control who can manage AWS RDS</li>
<li>traditional username and password can be used to login into the database</li>
<li>IAM based authentication can be used to login into RDS MySQL and postgreSQL</li>
</ul>
</li>
</ul>
<h2 id="aurora"><a class="markdownIt-Anchor" href="#aurora"></a> Aurora</h2>
<ul>
<li>Aurora is a proprietary technology from AWS</li>
<li>postgres and MySQL are both supported as Aurora DB</li>
<li>Aurora is AWS cloud optimized and claims 5x performance improvement over MySQL on RDS, over 3x performance of Postgres on RDS</li>
<li>Aurora storage automatically grows in increments of 10GB, up to 64TB</li>
<li>Aurora can have 15 replicas while MySQL has 5, and the replication process is faster</li>
<li>failover in Aurora is instantaneous, it is HA native</li>
<li>user to connect to write endpoint or read endpoint, these endpoints will redirect traffic to the correct instances.</li>
<li>Security is the same as RDS</li>
<li>Aurora has 4 features
<ul>
<li>one writer, multiple reader</li>
<li>one writer, multiple readers - parallel query</li>
<li>multiple writers</li>
<li>severless</li>
</ul>
</li>
</ul>
<h1 id="elasticache"><a class="markdownIt-Anchor" href="#elasticache"></a> ElastiCache</h1>
<ul>
<li>the same way RDS is to get managed relational databases</li>
<li>ElatiCache is to get managed Redis and Memcachced</li>
<li>Caches are in memory databases with really high performance, low latency</li>
<li>helps reduce load off of databases for read intensive workloads</li>
<li>helps make your application stateless</li>
<li>AWS takes care of OS maintenance and patching, optimizations, setup, configuration, monitoring, failure recovery and backups</li>
<li>using ElastiCache involves heavy application code changes</li>
</ul>
<h2 id="db-cache"><a class="markdownIt-Anchor" href="#db-cache"></a> DB cache</h2>
<ul>
<li>Application queries ElastiCache, if not avaialble, get from RDS and store in ElastiCache</li>
<li>helps relieve load in RDS</li>
<li>cache must have an invalidation strategy to make sure only the most current data is used in there</li>
</ul>
<h2 id="user-session-store"><a class="markdownIt-Anchor" href="#user-session-store"></a> User session store</h2>
<ul>
<li>user logs into any of the application</li>
<li>the application writes the session data into ElastiCache</li>
<li>the user hits another instance of our application</li>
<li>the instance retrieves the data and the user is already logged in</li>
</ul>
<h2 id="redis-vs-memcached"><a class="markdownIt-Anchor" href="#redis-vs-memcached"></a> Redis vs Memcached</h2>
<table>
<thead>
<tr>
<th>Redis</th>
<th>Memcached</th>
</tr>
</thead>
<tbody>
<tr>
<td>Multi AZ with auto failover</td>
<td>multi node for partitioning of data (sharding)</td>
</tr>
<tr>
<td>read replicas to scale reads and have HA</td>
<td>no HA</td>
</tr>
<tr>
<td>data durability using AOF persistence</td>
<td>non persistent</td>
</tr>
<tr>
<td>backup and restore features</td>
<td>no back and restore</td>
</tr>
<tr>
<td>-</td>
<td>Multi threaded architecture</td>
</tr>
</tbody>
</table>
<ul>
<li>Redis Auth
<ul>
<li>if you enable encryption in transit, you can enable Redis Auth, you need to setup a token for your application to connect to Redis.</li>
</ul>
</li>
</ul>
<h2 id="caching-implementation-considerations"><a class="markdownIt-Anchor" href="#caching-implementation-considerations"></a> Caching implementation considerations</h2>
<ul>
<li>is it safe to cache data
<ul>
<li>data may be out of data, eventaully consistent</li>
</ul>
</li>
<li>is caching effective for that data
<ul>
<li>pattern: data changing slowly, few keys are frequently needed, good to use caching</li>
<li>anti pattern: data changing rapidly, all large keys space frequently needed, not good to use caching</li>
</ul>
</li>
<li>is data structured well for caching?
<ul>
<li>key value caching, or caching of aggregations results?</li>
<li>caching is good for well structured data</li>
</ul>
</li>
</ul>
<h2 id="lazy-loading-cache-aside-lazy-population"><a class="markdownIt-Anchor" href="#lazy-loading-cache-aside-lazy-population"></a> lazy loading / cache aside / lazy population</h2>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># python</span><br><span class="line"></span><br><span class="line">def get_user(user_id):</span><br><span class="line">  &#x2F;&#x2F; check the cache</span><br><span class="line">  record &#x3D; cache.get(user_id)</span><br><span class="line"></span><br><span class="line">  if record is None:</span><br><span class="line">    &#x2F;&#x2F; run a DB query</span><br><span class="line">    record &#x3D; db.query(&quot;select * from users where id &#x3D; ?&quot;, user_id)</span><br><span class="line">    &#x2F;&#x2F; populate the cache</span><br><span class="line">    cache.set(user_id, record)</span><br><span class="line">    return record</span><br><span class="line">  else:</span><br><span class="line">    return record</span><br></pre></td></tr></table></figure>
<h2 id="write-through-add-or-update-cache-when-database-is-updated"><a class="markdownIt-Anchor" href="#write-through-add-or-update-cache-when-database-is-updated"></a> write through - add or update cache when database is updated</h2>
<ul>
<li>when there is a write call</li>
</ul>
<ol>
<li>write to DB</li>
<li>write to cache</li>
</ol>
<ul>
<li>pros
<ul>
<li>data in cache is never stale, reads are quick</li>
<li>wirte penalty vs read penalty (each write requires 2 calls)</li>
</ul>
</li>
<li>cons
<ul>
<li>missing data until it is added/ updated in the DB, mitigation is to implement lazy loading strategy as well, combine 2 strategies together</li>
<li>cache churn - a lot of the data will never be read</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># python</span><br><span class="line"></span><br><span class="line">def save_user(user_id, values):</span><br><span class="line"></span><br><span class="line">  # save to DB</span><br><span class="line">  record &#x3D; db.query(&quot;update users ... where id &#x3D; ?&quot;, user_id, values)</span><br><span class="line"></span><br><span class="line">  # push into cache</span><br><span class="line">  cache.set(user_id, record)</span><br><span class="line"></span><br><span class="line">  return record</span><br></pre></td></tr></table></figure>
<h2 id="cache-evictions-and-ttl-time-to-live"><a class="markdownIt-Anchor" href="#cache-evictions-and-ttl-time-to-live"></a> cache evictions and TTL (time to live)</h2>
<ul>
<li>cache eviction can occur in 3 ways
<ul>
<li>you delete item explicity in the cache</li>
<li>item is evicted because the memory is full and it is not recently used (LRU)</li>
<li>you set an item TTL</li>
</ul>
</li>
<li>TTL are helpful for any kind of data
<ul>
<li>leaderboard</li>
<li>comments</li>
<li>activity streams</li>
</ul>
</li>
<li>TTL can range from few seconds to hours or days</li>
<li>if too many evictions happen due to memory, you should scale up or out</li>
</ul>
<h2 id="final-words"><a class="markdownIt-Anchor" href="#final-words"></a> Final words</h2>
<ul>
<li>lazy loading is easy to implement and works for many situations as a foundation, especially on the read side</li>
<li>write through is usually combined with lazy loading as targeted for the queries or workloads that benefit from this optimization</li>
<li>setting a TTL is usually not a bad idea, except when you are using write through, set it to a sensible value for your application</li>
<li>only cache data that makes sense</li>
</ul>
<h2 id="elasticache-replication-cluster-mode-disabled"><a class="markdownIt-Anchor" href="#elasticache-replication-cluster-mode-disabled"></a> ElastiCache replication - cluster mode disabled</h2>
<ul>
<li>one primary node, up to 5 replicas</li>
<li>asynchronous replication</li>
<li>the primary node is used for read and write</li>
<li>the other nodes are read only</li>
<li>we have only one shard, and all nodes are in the shard, each node has all the data</li>
<li>guard against data loss if node failure</li>
<li>multi AZ enabled by default for failover</li>
<li>helpful to scale read performance</li>
</ul>
<h2 id="elasticache-replication-cluster-mode-enabled"><a class="markdownIt-Anchor" href="#elasticache-replication-cluster-mode-enabled"></a> ElastiCache replication - cluster mode enabled</h2>
<ul>
<li>data is partitioned across shards (helpful to scale writes)</li>
<li>each shard has a primary and up to 5 replica nodes, each shard has part of the data</li>
<li>multi AZ capability</li>
<li>up to 500 nodes per cluster</li>
</ul>
<h1 id="route-53"><a class="markdownIt-Anchor" href="#route-53"></a> Route 53</h1>
<ul>
<li>
<p>DNS</p>
<ul>
<li>Domain Name System which translates the human friendly hostnames into the machine IP addresses</li>
</ul>
</li>
<li>
<p>Route 53</p>
<ul>
<li>A highly available, scalable, fully managed and authoritive DNS</li>
<li>route 53 is also a Domain Registrar</li>
<li>ability to check the health of your resources</li>
<li>the only AWS service which provides 100% availability SLA</li>
</ul>
</li>
</ul>
<h2 id="hosted-zones"><a class="markdownIt-Anchor" href="#hosted-zones"></a> Hosted zones</h2>
<ul>
<li>a container for records that define how to route traffic to a domain and its subdomains</li>
<li>public hosted zones
<ul>
<li>contains records that specify how to route traffic on the internet (public domain names)</li>
</ul>
</li>
<li>private hosted zones
<ul>
<li>contain records that specify how you route traffic within one or more VPCs (private domain names)</li>
</ul>
</li>
</ul>
<h2 id="cname-vs-alias"><a class="markdownIt-Anchor" href="#cname-vs-alias"></a> CNAME vs alias</h2>
<ul>
<li>
<p>CNAME</p>
<ul>
<li>points a hostname to any other hostname</li>
<li>only for non root domain</li>
</ul>
</li>
<li>
<p>Alias</p>
<ul>
<li>points a hostname to an AWS resource</li>
<li>works for root domain and non root domain</li>
<li>free of charge</li>
<li>native health check</li>
<li>automatically recognizes changes in the resource’s IP addresses</li>
</ul>
</li>
<li>
<p>Alias targets</p>
<ul>
<li>ELB</li>
<li>CloudFront distributions</li>
<li>API gateway</li>
<li>Elastic Beanstalk environments</li>
<li>S3 websites</li>
<li>VPC interface endpoints</li>
<li>Global accelerator</li>
<li>route 53 record in the same hosted zone</li>
</ul>
</li>
<li>
<p>You cannot set an Alias record for an EC2 DNS name</p>
</li>
</ul>
<h2 id="route-53-routing-policies"><a class="markdownIt-Anchor" href="#route-53-routing-policies"></a> Route 53 - routing policies</h2>
<ul>
<li>define how route 53 responds to DNS queries</li>
<li>route 53 supports the following routing policies
<ul>
<li>simple</li>
<li>weighted</li>
<li>failover</li>
<li>latency based</li>
<li>geolocation</li>
<li>multi value answer</li>
<li>geoproximity (using route 53 traffic flow feature)</li>
</ul>
</li>
</ul>
<h2 id="simple"><a class="markdownIt-Anchor" href="#simple"></a> Simple</h2>
<ul>
<li>typically, route traffic to a single resource</li>
<li>can specify multiple values in the same record</li>
<li>if multiple values are returned, a random one is chosen by the client</li>
<li>when Alias enabled, sepecify only one AWS resource</li>
<li>can’t be associated with health checks</li>
</ul>
<h2 id="weighted"><a class="markdownIt-Anchor" href="#weighted"></a> Weighted</h2>
<ul>
<li>control the percentage of the requests that go to each specific resource</li>
<li>assign each record a relative weight</li>
<li>DNS records must have the same name and type</li>
<li>use cases: load balancing between regions, testing new application versions…</li>
<li>assign a weight of 0 to a record to stop sending traffic to a resource</li>
<li>if all records have weight of 0, then all records will be returned equally</li>
</ul>
<h2 id="latency"><a class="markdownIt-Anchor" href="#latency"></a> latency</h2>
<ul>
<li>redirect to the resource that has the least latency close to us</li>
<li>super helpful when latency for users is a priority</li>
<li>latency is based on traffic between users and AWS regions</li>
<li>Germany users may be directed to the US</li>
<li>can be associated with health checks (has a failover capability)</li>
</ul>
<h2 id="health-checks"><a class="markdownIt-Anchor" href="#health-checks"></a> health checks</h2>
<ul>
<li>HTTP health checks are only for public resources</li>
<li>health check =&gt; automated DNS failover</li>
</ul>
<ol>
<li>health checks that monitor an endpoint</li>
<li>health checks that monitor other health checks (calculated health checks)</li>
<li>health checks that monitor cloudwatch alarms</li>
</ol>
<ul>
<li>health checks are integrated with CW metrics</li>
</ul>
<h3 id="monitor-an-endpoint"><a class="markdownIt-Anchor" href="#monitor-an-endpoint"></a> monitor an endpoint</h3>
<ul>
<li>about 15 global health checks will check the endpoint health
<ul>
<li>healthy / unhealthy threshold = 3</li>
<li>interval - 30 seconds</li>
<li>supported protocol: HTTP, HTTPS, TCP</li>
<li>if &gt; 18% of health checks report the endpoint is healthy, route 53 consider it is healthy, otherwise, it is unhealthy</li>
<li>ability to choose which locations you want route 53 to use</li>
</ul>
</li>
<li>health checks pass only when the endpoint responds with the 2xx and 3xx status codes</li>
<li>health checks can be setup to pass or fail based on the text in the first 5120 bytes of the response</li>
<li>your ELB must allow the incoming requests from the route 53 health checkers IP address range</li>
</ul>
<h3 id="calculated-health-checks"><a class="markdownIt-Anchor" href="#calculated-health-checks"></a> calculated health checks</h3>
<ul>
<li>combine the results of multiple health checks into a single health check</li>
<li>you can use OR, AND, or NOT</li>
<li>can monitor up to 256 child health checks</li>
<li>specify how many of the health checks need to pass to make the parent pass</li>
<li>usage: perform maintenance to your website without causing all health checks to fail</li>
</ul>
<h3 id="private-hosted-zones"><a class="markdownIt-Anchor" href="#private-hosted-zones"></a> private hosted zones</h3>
<ul>
<li>route 53 health checks are outside the VPC</li>
<li>they can’t access private endpoint</li>
<li>you can create a CloudWatch metric and associate a CloudWatch alarm, then create a health check that checks the alarm itself, if the CloudWatch alarm status becomes ALARM, the health checker will become to unhealthy</li>
</ul>
<h2 id="failover"><a class="markdownIt-Anchor" href="#failover"></a> failover</h2>
<ul>
<li>create two records associate with 2 resources</li>
<li>primary and secondary records</li>
<li>primary record must associated with a health checker</li>
<li>if the primary record is unhealthy, DNS will return IP address of the secondary resource</li>
</ul>
<h2 id="geolocation"><a class="markdownIt-Anchor" href="#geolocation"></a> Geolocation</h2>
<ul>
<li>different from latency based</li>
<li>this routing is based on user location</li>
<li>specify location by Continent, Country, or by US state</li>
<li>should create a default record (in case there is no match on location)</li>
<li>use cases: website localization, restrict content distribution, load balancing…</li>
<li>can be associated with health checks</li>
</ul>
<h2 id="geoproximity"><a class="markdownIt-Anchor" href="#geoproximity"></a> Geoproximity</h2>
<ul>
<li>route traffic to your resources based on the geographic location of users and resources</li>
<li>ability to shift more to resources based on the defined bias</li>
<li>to change the size of the geographic region, specify bias values
<ul>
<li>to expand (1 to 99), more traffic to the resource</li>
<li>to shrink (-1 to -99), less traffic to the resource</li>
</ul>
</li>
<li>resource can be
<ul>
<li>AWS resources (AWS region)</li>
<li>non AWS resources (latitude and longitude)</li>
</ul>
</li>
<li>you must use route 53 traffic flow (advanced) to use this feature</li>
</ul>
<h3 id="traffic-flow"><a class="markdownIt-Anchor" href="#traffic-flow"></a> Traffic flow</h3>
<ul>
<li>simplify the process of creating and maintaing records in large and complex configurations</li>
<li>visual editor to manage complex routing decision trees</li>
<li>configurations can be saved as traffic flow policy
<ul>
<li>can be applied to different route 53 hosted zones</li>
<li>supports versioning</li>
</ul>
</li>
</ul>
<h2 id="multi-value"><a class="markdownIt-Anchor" href="#multi-value"></a> multi value</h2>
<ul>
<li>use when routing traffic to multiple resources</li>
<li>route 53 return multiple values / resources</li>
<li>can be associated with health checks (return only values for healthy resources)</li>
<li>up to 8 healthy records are returned for each multi value query</li>
<li>multi value is not a substitude for having an ELB (it is more like a client side load balancing)</li>
</ul>
<h1 id="vpc"><a class="markdownIt-Anchor" href="#vpc"></a> VPC</h1>
<ul>
<li>VPC: private network to deploy your resource</li>
<li>subnet: allow you to partition your network inside your VPC (AZ resource)</li>
<li>a public subnet is a subnet that is accessible from the internet</li>
<li>a private subnet is a subnet that is not accessible from the internet</li>
<li>to define access to the internet and between subnets, we use route tables</li>
</ul>
<h2 id="internet-gateway-and-nat-gateways"><a class="markdownIt-Anchor" href="#internet-gateway-and-nat-gateways"></a> Internet gateway and NAT gateways</h2>
<ul>
<li>internet gateways helps our VPC instances connect with the internet</li>
<li>public subnets have a route to the internet gateway</li>
<li>NAT gateways (AWS managed) and NAT instances (self managed) allow your instances in your private subnets to access the internet while remaining private</li>
</ul>
<h2 id="nacl-and-security-groups"><a class="markdownIt-Anchor" href="#nacl-and-security-groups"></a> NACL and security groups</h2>
<ul>
<li>NACL (network ACL)
<ul>
<li>a firewall which controls traffic from and to subnet</li>
<li>can have ALLOW and DENY rules</li>
<li>are attached at the subnet level</li>
<li>rules only include IP addresses</li>
</ul>
</li>
<li>security groups
<ul>
<li>a firewall that controls traffic to and from an ENI / an EC2 instance</li>
<li>can have only ALLOW rules</li>
<li>rules include IP addresses and other security groups</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th>Security group</th>
<th>Network ACL</th>
</tr>
</thead>
<tbody>
<tr>
<td>operates at the instance level</td>
<td>operates at the subnet level</td>
</tr>
<tr>
<td>supports allow rules only</td>
<td>supports allow rules and deny rules</td>
</tr>
<tr>
<td>is stateful: return traffic is automatically allowed, regardless of any rules</td>
<td>is stateless: return traffic must be explicitly allowed by rules</td>
</tr>
<tr>
<td>we evaluate all rules before deciding whether to allow traffic</td>
<td>we process rules in number order when deciding whether to allow traffic</td>
</tr>
<tr>
<td>applies to an instance only if someone specifies the security group when launching the instance, or associate the security group with the instance later on</td>
<td>automatically applies to all instances in the subnets it’s associated with (therefore, you don’t have to rely on users to specify the security group)</td>
</tr>
</tbody>
</table>
<h2 id="vpc-flow-logs"><a class="markdownIt-Anchor" href="#vpc-flow-logs"></a> VPC Flow logs</h2>
<ul>
<li>capture information about IP traffic going into your interfaces
<ul>
<li>VPC flow logs</li>
<li>subnet flow logs</li>
<li>ENI (elastic network interface) flow logs</li>
</ul>
</li>
<li>helps to monitor and troubleshoot connectivity issues
<ul>
<li>subnets to internet</li>
<li>subnets to subnets</li>
<li>internet to subnets</li>
</ul>
</li>
<li>captures network information from AWS managed interfaces too: Elastic load balancers, ElastiCache, RDS, Aurora, etc…</li>
<li>VPC flow logs data can go to S3 / CloudWatch logs</li>
</ul>
<h2 id="vpc-peering"><a class="markdownIt-Anchor" href="#vpc-peering"></a> VPC Peering</h2>
<ul>
<li>connect two VPCs, privately using AWS network</li>
<li>make them behave as if they were in the same network</li>
<li>must not have overlapping CIDR</li>
<li>VPC peering connection is not transitive (must be established for each VPC that need to communicate with one another)</li>
</ul>
<h2 id="vpc-endpoints"><a class="markdownIt-Anchor" href="#vpc-endpoints"></a> VPC endpoints</h2>
<ul>
<li>endpoints allow you to connect to AWS services using a private network instead of the public www network</li>
<li>this gives you enhanced security and lower latency to access AWS services</li>
<li>VPC endpoint gateway: S3 and DynamoDB</li>
<li>VPC endpoint interface: the rest AWS rervices</li>
<li>only used within your VPC</li>
</ul>
<h2 id="site-to-site-vpn-and-direct-connect"><a class="markdownIt-Anchor" href="#site-to-site-vpn-and-direct-connect"></a> Site to site VPN and Direct connect</h2>
<ul>
<li>site to site VPN
<ul>
<li>connect an on premises VPN to AWS</li>
<li>the connection is automatically encrypted</li>
<li>goes over the public internet</li>
</ul>
</li>
<li>direct connect
<ul>
<li>establish a physical connection between on premises and AWS</li>
<li>the connection is private, secure, and fast</li>
<li>goes over a private network</li>
<li>takes at least a month to establish</li>
</ul>
</li>
<li>NOTE: site to site VPN and direct connect cannot access VPC endpoints</li>
</ul>
<h1 id="s3"><a class="markdownIt-Anchor" href="#s3"></a> S3</h1>
<h2 id="buckets"><a class="markdownIt-Anchor" href="#buckets"></a> buckets</h2>
<ul>
<li>S3 allows people to store objects in buckets</li>
<li>buckets must have a globally unique name</li>
<li>buckets are defined at the region level</li>
</ul>
<h2 id="objects"><a class="markdownIt-Anchor" href="#objects"></a> objects</h2>
<ul>
<li>objects have a key</li>
<li>the key is the FULL path</li>
<li>the key is composed of prefix + object name</li>
<li>there is no concept of directories within buckets</li>
<li>just keys with very long names that contain slashes</li>
<li>object values are the content of the body
<ul>
<li>max object size is 5TB</li>
<li>if uploading more than 5GB, must use multi-part upload</li>
</ul>
</li>
<li>metadata (list of text key / value pairs - system or user metadata)</li>
<li>tags (unicode key / value pair, up to 10) - useful for security / lifecycle</li>
<li>version ID (if versioning is enabled)</li>
</ul>
<h2 id="versioning"><a class="markdownIt-Anchor" href="#versioning"></a> versioning</h2>
<ul>
<li>you can version your files in S3</li>
<li>it is enabled at the bucket level</li>
<li>same key overwrite will increment the version: 1,2,3…</li>
<li>it is best practice to version your buckets
<ul>
<li>protect against unintended deletes</li>
<li>easy roll back to previous version</li>
</ul>
</li>
<li>note:
<ul>
<li>any file that is not versioned prior to enabling versioning will have version null</li>
<li>suspending versioning does not delete the previous versions</li>
</ul>
</li>
</ul>
<h2 id="encryption-for-objects"><a class="markdownIt-Anchor" href="#encryption-for-objects"></a> Encryption for objects</h2>
<h3 id="sse-s3"><a class="markdownIt-Anchor" href="#sse-s3"></a> SSE-S3</h3>
<ul>
<li>encryption using keys handled and managed by S3</li>
<li>object is encrypted server side</li>
<li>AES-256 encryption type</li>
</ul>
<h3 id="sse-kms"><a class="markdownIt-Anchor" href="#sse-kms"></a> SSE-KMS</h3>
<ul>
<li>encryption using keys handled and managed by KMS</li>
<li>KMS advantages: user control + audit trail</li>
<li>object is encrypted server side</li>
</ul>
<h3 id="sse-c"><a class="markdownIt-Anchor" href="#sse-c"></a> SSE-C</h3>
<ul>
<li>server side encryption using data keys fully managed by the customer outside of AWS</li>
<li>S3 does not store the encryption key you provide</li>
<li>HTTPS must be used, because you need to send the encryption key in the header</li>
<li>encryption key must be provided in HTTP headers, for every HTTP request made</li>
</ul>
<h3 id="client-side-encryption"><a class="markdownIt-Anchor" href="#client-side-encryption"></a> client side encryption</h3>
<ul>
<li>client library such as the Amazon S3 encryption client</li>
<li>clients must encrypt data themselves before sending to S3</li>
<li>clients must decrypt the data themselves when retrieving from S3</li>
<li>customer fully manages the keys and encryption cycle</li>
</ul>
<h3 id="encryption-in-transit-ssltls"><a class="markdownIt-Anchor" href="#encryption-in-transit-ssltls"></a> Encryption in transit (SSL/TLS)</h3>
<ul>
<li>Amazon S3 exposes
<ul>
<li>HTTP endpoint: non encrypted</li>
<li>HTTPS endpoint: encryption in flight</li>
</ul>
</li>
<li>you are free to use the endpoint you want, but HTTPS is recommended</li>
<li>most clients would use the HTTPS endpoint by default</li>
<li>HTTPS is mandatory for SSE-C</li>
</ul>
<h2 id="security"><a class="markdownIt-Anchor" href="#security"></a> security</h2>
<ul>
<li>user based
<ul>
<li>IAM policies - which API calls should be allowed for a specific user from IAM console</li>
</ul>
</li>
<li>resource based
<ul>
<li>bucket policies - bucket wide rules from the S3 console - allows cross account</li>
<li>object ACL - finer grain</li>
<li>bucket ACL - less common</li>
</ul>
</li>
<li>NOTE: an IAM principal can access an S3 object if
<ul>
<li>the user IAM permissions allow it OR the resource policy alloow it</li>
<li>AND there is no explicit DENY</li>
</ul>
</li>
</ul>
<h3 id="bucket-settings-for-block-public-access"><a class="markdownIt-Anchor" href="#bucket-settings-for-block-public-access"></a> bucket settings for block public access</h3>
<ul>
<li>block public access to buckets and objects granted through
<ul>
<li>new access control lists</li>
<li>any access control lists</li>
<li>new public bucket or access point policies</li>
<li>block public and cross account access to buckets and objects through any public bucket or access point policies</li>
</ul>
</li>
<li>these settings were created to prevent company data leaks</li>
<li>if you know your bucket should never be public, leave these on</li>
<li>can be set at the account level</li>
</ul>
<h3 id="others"><a class="markdownIt-Anchor" href="#others"></a> others</h3>
<ul>
<li>networking
<ul>
<li>supports VPC endpoints (for instances in VPC without www internet)</li>
</ul>
</li>
<li>logging and audit
<ul>
<li>S3 access logs can be stored in other S3 buckets</li>
<li>API calls can be logged in AWS cloudtrail</li>
</ul>
</li>
<li>user security
<ul>
<li>MFA delete: MFA can be required in versioned buckets to delete objects</li>
<li>pre-signed URLs: URLs that are valid for a limited time (premium videos service for logged in users)</li>
</ul>
</li>
</ul>
<h2 id="cors"><a class="markdownIt-Anchor" href="#cors"></a> CORS</h2>
<ul>
<li>an origin is a scheme, host, and port</li>
<li>CORS means cross origin resource sharing</li>
<li>web browser based mechanism to allow requests to other origins while visiting the main origin</li>
<li>the requests won’t be fulfilled unless the other origin allows for the requests, using CORS headers</li>
<li>if a client does a cross origin request on our S3 bucket, we need to enable the correct CORS headers</li>
<li>you can allow for a specific origin or for * (for all origins)</li>
</ul>
<h2 id="consistency-model"><a class="markdownIt-Anchor" href="#consistency-model"></a> consistency model</h2>
<ul>
<li>strong consistency as of Dec 2020</li>
</ul>
<h1 id="aws-cli-sdk-iam-roles-and-policies"><a class="markdownIt-Anchor" href="#aws-cli-sdk-iam-roles-and-policies"></a> AWS CLI, SDK, IAM Roles and policies</h1>
<ul>
<li>AWS CLI Dry run
<ul>
<li>tells you if your command would have succeed or not without actually executing it</li>
</ul>
</li>
<li>AWS CLI STS decode erros
<ul>
<li>decode API error messgaes using the STS command line</li>
</ul>
</li>
</ul>
<h2 id="aws-ec2-instance-metadata"><a class="markdownIt-Anchor" href="#aws-ec2-instance-metadata"></a> AWS EC2 instance metadata</h2>
<ul>
<li>it allows AWS EC2 instance to learn about themselves without using an IAM role for that purpose</li>
<li>the URL is <a target="_blank" rel="noopener" href="http://169.254.169.254/latest/meta-data/">http://169.254.169.254/latest/meta-data/</a></li>
<li>you can retrieve the IAM role name from the metadata, but you cannot retrieve the IAM policy</li>
<li>metadata = info about the EC2 instance</li>
<li>user data = launch script of the EC2 instance</li>
</ul>
<h2 id="mfa-with-cli"><a class="markdownIt-Anchor" href="#mfa-with-cli"></a> MFA with CLI</h2>
<ul>
<li>to use MFA with the CLI, you must create a temporary session</li>
<li>to do so, you must run the STS GetSessionToken API call</li>
</ul>
<h2 id="aws-sdk"><a class="markdownIt-Anchor" href="#aws-sdk"></a> AWS SDK</h2>
<ul>
<li>what if you want to perform actions on AWS directly from your applications code?</li>
<li>you can use an SDK</li>
<li>we have to use the AWS SDK when coding against AWS services such as DynamoDB</li>
<li>if you don’t specify or configure a default region, then us-east-1 will be chosen by default</li>
</ul>
<h2 id="aws-limit"><a class="markdownIt-Anchor" href="#aws-limit"></a> AWS limit</h2>
<ul>
<li>API rate limits
<ul>
<li>DescribeInstances API for EC2 has a limit of 100 calls per seconds</li>
<li>GetObject on S3 has a limit of 5500 GET per second per prefix</li>
<li>for intermittent errors: implement <code>exponential backoff</code></li>
<li>for consistent errors: request an API throttling limit increase</li>
</ul>
</li>
<li>service quotas
<ul>
<li>running on-demand standard instances: 1152 vCPU</li>
<li>you can request a service limit increase by opening a ticket</li>
<li>you can request a service quota increase by using the service quotas API</li>
</ul>
</li>
</ul>
<h3 id="exponential-backoff"><a class="markdownIt-Anchor" href="#exponential-backoff"></a> Exponential Backoff</h3>
<ul>
<li>if you get ThrottlingException intermittently, use exponential backoff</li>
<li>retry mechanism already included in AWS SDK API calls</li>
<li>must implement yourself if using the AWS API as-is or in specific cases
<ul>
<li>must only implement the retries on 5xx server errors and throttling</li>
<li>do not implement on the 4xx client errors</li>
</ul>
</li>
</ul>
<h2 id="aws-cli-credentials-provider-chain"><a class="markdownIt-Anchor" href="#aws-cli-credentials-provider-chain"></a> AWS CLI credentials provider chain</h2>
<ul>
<li>the CLI will look for credentials in this order</li>
</ul>
<ol>
<li>command line options</li>
<li>environment variables</li>
<li>CLI credentials file</li>
<li>CLI configuration file</li>
<li>container credentials</li>
<li>instance profile credentials</li>
</ol>
<h2 id="aws-sdk-default-credentials-provider-chain"><a class="markdownIt-Anchor" href="#aws-sdk-default-credentials-provider-chain"></a> AWS SDK default credentials provider chain</h2>
<ul>
<li>the java SDK will look for credentials in this order</li>
</ul>
<ol>
<li>java system properties</li>
<li>environment variables</li>
<li>the default credential profiles file</li>
<li>Amazon ECS container credentials</li>
<li>instance profile credentials</li>
</ol>
<h3 id="credentials-scenario"><a class="markdownIt-Anchor" href="#credentials-scenario"></a> Credentials Scenario</h3>
<ul>
<li>
<p>an application deployed on an EC2 instance is using environment variables with credentials from an IAM user to call the Amazon S3 API</p>
</li>
<li>
<p>The IAM user has S3FullAccess permissions</p>
</li>
<li>
<p>the application only uses one S3 bucket, so according to best practices</p>
<ul>
<li>an IAM role and EC2 instance profile was created for the EC2 instance</li>
<li>the role was assigned the minimum permissions to access that one S3 bucket</li>
</ul>
</li>
<li>
<p>the IAM instance profile was assigned to the EC2 instance, but it still had access to all S3 buckets, why?</p>
</li>
<li>
<p>the credentials provider chain is still giving priorities to the environment variables</p>
</li>
</ul>
<h3 id="credentials-best-practice"><a class="markdownIt-Anchor" href="#credentials-best-practice"></a> credentials best practice</h3>
<ul>
<li>never store AWS credentials in your code</li>
<li>best practice is for credentials to be inherited from the credentials chain</li>
<li>if working within AWS, use IAM roles
<ul>
<li>EC2 instance roles for EC2 instances</li>
<li>ECS roles for ECS tasks</li>
<li>lambda roles for lambda functions</li>
</ul>
</li>
<li>if working outside AWS, use environment variables / named profiles</li>
</ul>
<h2 id="signing-aws-api-requests"><a class="markdownIt-Anchor" href="#signing-aws-api-requests"></a> signing AWS API requests</h2>
<ul>
<li>when you call the AWS HTTP API, you sign the request so that AWS can identify you, using your AWS credentials (access key and secret key)</li>
<li>note: some requests to Amazon S3 don’t need to be signed</li>
<li>if you use the SDK or CLI, the HTTP requests are signed for you</li>
<li>you should sign an AWS HTTP request using Signature v4 (SigV4)</li>
</ul>
<h3 id="sigv4-options"><a class="markdownIt-Anchor" href="#sigv4-options"></a> sigV4 options</h3>
<ul>
<li>HTTP header</li>
<li>query string in URL</li>
</ul>
<h1 id="s3-and-athena-advanced"><a class="markdownIt-Anchor" href="#s3-and-athena-advanced"></a> S3 and Athena Advanced</h1>
<h2 id="s3-mfa-delete"><a class="markdownIt-Anchor" href="#s3-mfa-delete"></a> S3 MFA delete</h2>
<ul>
<li>MFA forces user to generate a code on a device before doing important operations on S3</li>
<li>to use MFA delete, we need to enable versioning on the S3 bucket</li>
<li>you will need MFA to
<ul>
<li>permanently delete an object version</li>
<li>suspend versioning on the bucket</li>
</ul>
</li>
<li>you won’t need MFA for
<ul>
<li>enabling versioning</li>
<li>listing deleted versions</li>
</ul>
</li>
<li>only the bucket owner can enable / disable MFA delete</li>
<li>MFA delete can only be enabled using the CLI</li>
</ul>
<h2 id="s3-default-encryption-vs-bucket-policies"><a class="markdownIt-Anchor" href="#s3-default-encryption-vs-bucket-policies"></a> S3 default encryption vs bucket policies</h2>
<ul>
<li>one way to force encryption is to use a bucket policy and refuse any API call to PUT an S3 object without encryption headers</li>
<li>another way is to use the default encryption option in S3</li>
<li>note: bucket policies are evaluated before default encryption</li>
</ul>
<h2 id="s3-access-logs"><a class="markdownIt-Anchor" href="#s3-access-logs"></a> S3 access logs</h2>
<ul>
<li>for audit purpose, you may want to log all access to S3 buckets</li>
<li>any request made to S3, from any account, authorized or denied, will be logged into another S3 bucket</li>
<li>that data can be analyzed using data analysis tools…</li>
<li>or Amazon Athena</li>
<li>do not set your logging bucket to be the monitored bucket</li>
<li>it will create a logging loop, and your bucket will grow in size exponentially</li>
</ul>
<h2 id="s3-replication-crr-or-srr"><a class="markdownIt-Anchor" href="#s3-replication-crr-or-srr"></a> S3 replication (CRR or SRR)</h2>
<ul>
<li>
<p>must enable versioning in source and destination</p>
</li>
<li>
<p>cross region replication - CRR</p>
</li>
<li>
<p>same region replication - SRR</p>
</li>
<li>
<p>buckets can be in different accounts</p>
</li>
<li>
<p>copying is asynchronous</p>
</li>
<li>
<p>must give proper IAM permissions to S3</p>
</li>
<li>
<p>CRR use cases: compliance, lower latency access for users in another region, replicatioin across accounts</p>
</li>
<li>
<p>SRR use cases: log aggregation, live replication between production and test accounts</p>
</li>
<li>
<p>after activating, only new objects are replicated (not retroactive), existing objects will not be replicated</p>
</li>
<li>
<p>for DELETE operations</p>
<ul>
<li>can replicate delete markers from source to target (optional setting)</li>
<li>deletions with a version ID are not replicated (to avoid malicious deletes), it means if you delete an object using its version ID, this operation will not be replicated</li>
</ul>
</li>
<li>
<p>there is no chaining of replication</p>
<ul>
<li>if bucket 1 has replication into bucket 2, which has replication into bucket 3</li>
<li>then objects created in bucket 1 are not replicated to bucket 3</li>
</ul>
</li>
</ul>
<h2 id="s3-pre-signed-urls"><a class="markdownIt-Anchor" href="#s3-pre-signed-urls"></a> S3 pre signed URLs</h2>
<ul>
<li>can generate per signed URLs using SDK or CLI
<ul>
<li>for downloads (easy, can use the CLI)</li>
<li>for uploads (harder, must use the SDK)</li>
</ul>
</li>
<li>valid for a default of 3600 seconds, can change timeout with <code>--expires-in [TIME_BY_SECONDS]</code> argument</li>
<li>users given a pre signed URL inherit the permissions of the person who generated the URL for GET / PUT</li>
<li>examples
<ul>
<li>allow only logged in users to download a permium video on your S3 buckets</li>
<li>allow an ever changing list of users to download files by generating URLs dynamically</li>
<li>allow temporarily a user to upload a file to a precise location in our bucket</li>
</ul>
</li>
</ul>
<h2 id="amazon-glacier-and-glacier-deep-archive"><a class="markdownIt-Anchor" href="#amazon-glacier-and-glacier-deep-archive"></a> Amazon Glacier and Glacier Deep Archive</h2>
<ul>
<li>Amazon Glacier - 3 retrival options
<ul>
<li>expedited - 1 to 5 mins</li>
<li>standard - 3 to 5 hours</li>
<li>bulk - 5 to 12 hours</li>
<li>minimum storage duration of 90 days</li>
</ul>
</li>
<li>Amazon Glacier Deep Archive - for long term storage - cheaper
<ul>
<li>standard - 12 hours</li>
<li>bulk - 48 hours</li>
<li>minimum storage duration of 180 days</li>
</ul>
</li>
</ul>
<h2 id="s3-lifecycle-rules"><a class="markdownIt-Anchor" href="#s3-lifecycle-rules"></a> S3 lifecycle rules</h2>
<ul>
<li>transition actions: it defines when objects are transitioned to another storage class
<ul>
<li>move objects to standard IA class 60 days after creation</li>
<li>move to Glacier for archiving after 6 months</li>
</ul>
</li>
<li>expiration actions: configure objects to expire (delete) after some time
<ul>
<li>access log files can be set to delete after a year</li>
<li>can be used to delete old versions of files (if versioning is enabled)</li>
<li>can be used to delete incomplete multi part uploads</li>
</ul>
</li>
<li>rules can be created for a certain prefix</li>
<li>rules can be created for certain object tags</li>
</ul>
<h2 id="s3-performance"><a class="markdownIt-Anchor" href="#s3-performance"></a> S3 performance</h2>
<ul>
<li>Amazon S3 automatically scales to high request rates, latency 100-200ms</li>
<li>your application can achieve at least 3500 PUT/COPY/POST/DELETE and 5500 GET/HEAD requests per second per prefix in a bucket</li>
<li>there are no limits to the number of prefixes (prefix is a folder in S3) in a bucket</li>
</ul>
<h3 id="kms-limitation"><a class="markdownIt-Anchor" href="#kms-limitation"></a> KMS limitation</h3>
<ul>
<li>if you SSE-KMS, S3 performance may be impacted by the KMS limits</li>
<li>when you upload, it calls the GenerateDataKey KMS API</li>
<li>when you download it, it calls the Decrypt KMS API</li>
<li>count towards the KMS quota per second (5500, 10000, 30000 based on region)</li>
<li>you can request a quota increase using the service quotas console</li>
</ul>
<h3 id="multi-part-upload"><a class="markdownIt-Anchor" href="#multi-part-upload"></a> multi part upload</h3>
<ul>
<li>recommended for files &gt; 100MB, must be used for files &gt; 5GB</li>
<li>can help parallelize uploads (speed up transfers)</li>
</ul>
<h3 id="s3-transfer-acceleration"><a class="markdownIt-Anchor" href="#s3-transfer-acceleration"></a> S3 transfer acceleration</h3>
<ul>
<li>increase transfer speed by transferring file to an AWS edge location which will forward the data to the S3 bucket in the target region</li>
<li>compatible with multi part upload</li>
</ul>
<h3 id="s3-byte-range-fetches"><a class="markdownIt-Anchor" href="#s3-byte-range-fetches"></a> S3 byte range fetches</h3>
<ul>
<li>parallelize GETs by requesting specific byte ranges</li>
<li>better resilience in case of failures</li>
<li>can be used to speed up downloads</li>
<li>can be used to retrieve only partial data (for example the head of a file)</li>
</ul>
<h2 id="s3-select-and-glacier-select"><a class="markdownIt-Anchor" href="#s3-select-and-glacier-select"></a> S3 select and Glacier select</h2>
<ul>
<li>retrieve less data using SQL by performing servide side filtering</li>
<li>can filter by rows and columns (complex query not supported)</li>
<li>less network transfer, less CPU cost client side</li>
</ul>
<h2 id="s3-event-notifications"><a class="markdownIt-Anchor" href="#s3-event-notifications"></a> S3 event notifications</h2>
<ul>
<li>use case: generate thumbnails of images uploaded to S3</li>
<li>can create as many S3 events as desired</li>
<li>S3 event notifications typically deliver events in seconds but can sometimes take a minute or longer</li>
<li>it two writes are made to a single non-versioned object at the same time, it is possible that only a single event notification will be sent</li>
<li>if you want to ensure that an event notification is sent for every successful write, you can enable versioning on your bucket</li>
<li>compared to CloudWatch event or EventBridge, S3 event notifications have lower latency and lower costs, it works better with S3</li>
</ul>
<h1 id="aws-athena"><a class="markdownIt-Anchor" href="#aws-athena"></a> AWS Athena</h1>
<ul>
<li>serverless service to perform analytics directly against S3 files</li>
<li>uses SQL language to query the files</li>
<li>has a JDBC / ODBC driver</li>
<li>charged per query and amount of data scanned</li>
<li>supports CSV, JSON, ORC, Avro and Parquet (built on Presto)</li>
<li>use cases: business intelligence, analytics, reporting, analyze and query, VPC flow logs, ELB logs, CloudTrail trails, etc…</li>
<li>exam tip: analyze data directly on S3 =&gt; use Athena</li>
</ul>
<h1 id="aws-cloudfront"><a class="markdownIt-Anchor" href="#aws-cloudfront"></a> AWS CloudFront</h1>
<ul>
<li>CDN</li>
<li>improves read performance, content is cached at the edge</li>
<li>216 point of presence globally (edge locations)</li>
<li>DDoS protection, integration, with Shield, AWS WAF</li>
<li>can expose external HTTPS and can talk to internal HTTPS backends</li>
</ul>
<h2 id="origins"><a class="markdownIt-Anchor" href="#origins"></a> Origins</h2>
<ul>
<li>S3 bucket
<ul>
<li>for distributing files and caching them at the edge</li>
<li>enhanced security with CloudFront OAI</li>
<li>CloudFront can be used as ingress (to upload files to S3)</li>
</ul>
</li>
<li>Custom Origin (HTTP)
<ul>
<li>ALB</li>
<li>EC2 instance</li>
<li>S3 website (must first enable the bucket as a static S3 website)</li>
<li>any HTTP backend you want</li>
</ul>
</li>
</ul>
<h2 id="cloudfront-geo-restriction"><a class="markdownIt-Anchor" href="#cloudfront-geo-restriction"></a> CloudFront Geo Restriction</h2>
<ul>
<li>you can restrict who can access your distribution
<ul>
<li>whitelist: allow your users to access your content only if they are in one of the countries on a list of approved countries</li>
<li>blacklist: prevent your users from accessing your content if they are in one of the countries on a blacklist of banned countries</li>
</ul>
</li>
<li>the country is determined using a third party geo IP database</li>
<li>use case: copyright laws to control access to content</li>
</ul>
<h2 id="cloudfront-vs-s3-crr"><a class="markdownIt-Anchor" href="#cloudfront-vs-s3-crr"></a> CloudFront vs S3 CRR</h2>
<ul>
<li>CloudFront
<ul>
<li>global edge network</li>
<li>files are cached for a TTL</li>
<li>great for static content that must be available everywhere</li>
</ul>
</li>
<li>S3 CRR
<ul>
<li>must be setup for each region you want to replication to happen</li>
<li>files are updated in near real time</li>
<li>read only</li>
<li>great for dynamic content that needs to be available at low latency in few regions</li>
</ul>
</li>
</ul>
<h2 id="cloudfront-caching"><a class="markdownIt-Anchor" href="#cloudfront-caching"></a> CloudFront caching</h2>
<ul>
<li>cache based on
<ul>
<li>headers</li>
<li>session cookies</li>
<li>query string parameters</li>
</ul>
</li>
<li>the cache lives at each CloudFront edge location</li>
<li>you want to maximize the cache hit rate to minimize request on the origin</li>
<li>control the TTL, can be set by the origin usign the cache-control header, expires header…</li>
<li>you can invalidate part of the cache using the CreateInvalidation API</li>
</ul>
<h2 id="cloudfront-signed-url-signed-cookies"><a class="markdownIt-Anchor" href="#cloudfront-signed-url-signed-cookies"></a> CloudFront signed URL / signed cookies</h2>
<ul>
<li>you want to distrbute paid shared content to premium users over the world</li>
<li>we can use CloudFront signed URL / signed cookie, we attach a policy with
<ul>
<li>includes URL expiration</li>
<li>includes IP ranges to access the data from</li>
<li>trusted signers (which AWS accounts can create signed URLs)</li>
</ul>
</li>
<li>how long should the URL be valid for
<ul>
<li>shared content (movie, music): make it short (a few minutes)</li>
<li>private content (private to the user): you can make it for years</li>
</ul>
</li>
<li>signed URL: access to individual files (one signed URL per file)</li>
<li>signed cookies: access to multiple files (one signed cookie for many files)</li>
</ul>
<h2 id="cloudfront-signed-url-vs-s3-pre-signed-url"><a class="markdownIt-Anchor" href="#cloudfront-signed-url-vs-s3-pre-signed-url"></a> CloudFront signed URL vs S3 pre signed URL</h2>
<h3 id="signed-url"><a class="markdownIt-Anchor" href="#signed-url"></a> Signed URL</h3>
<ul>
<li>allow access to a path, no matter the origin</li>
<li>account wide key pair, only the root can manage it</li>
<li>can filter by IP, path, date, expiration</li>
<li>can leverage caching features</li>
</ul>
<h3 id="s3-pre-signed-url"><a class="markdownIt-Anchor" href="#s3-pre-signed-url"></a> S3 pre signed URL</h3>
<ul>
<li>issue a request as the person who pre signed the URL</li>
<li>uses the IAM key of the signing IAM principal (has the same access as the IAM user who create the URL)</li>
<li>limited lifetime</li>
</ul>
<h2 id="cloudfront-signed-url-process"><a class="markdownIt-Anchor" href="#cloudfront-signed-url-process"></a> CloudFront signed URL process</h2>
<ul>
<li>two types of signers
<ul>
<li>either a trusted key group (recommended)
<ul>
<li>can leverage APIs to create and rotate keys (and IAM for API security)</li>
</ul>
</li>
<li>an AWS account that contains a CloudFront key pair
<ul>
<li>need to manage keys using the root account and the AWS console</li>
<li>not recommended because you shouldn’t use the root account for this</li>
</ul>
</li>
</ul>
</li>
<li>in your CloudFront distribution, create one or more trusted key groups</li>
<li>you generate your own public / private key
<ul>
<li>the private key is used by your applications to sign URLs</li>
<li>the public key is used by cloudfront to verify URLs</li>
</ul>
</li>
</ul>
<h2 id="price-classes"><a class="markdownIt-Anchor" href="#price-classes"></a> Price classes</h2>
<ul>
<li>you can reduce the number of edge locations for cost reduction</li>
<li>three price classes
<ul>
<li>price class All: all regions - best performance</li>
<li>price class 200: most regions, but excludes the most expensive regions</li>
<li>price class 100: only the least expensive regions</li>
</ul>
</li>
</ul>
<h2 id="multiple-origin"><a class="markdownIt-Anchor" href="#multiple-origin"></a> Multiple origin</h2>
<ul>
<li>to route to different kind of origins based on the content type</li>
<li>based on path pattern
<ul>
<li>/images/*</li>
<li>/api/*</li>
<li>/*</li>
</ul>
</li>
</ul>
<h2 id="origin-groups"><a class="markdownIt-Anchor" href="#origin-groups"></a> origin groups</h2>
<ul>
<li>to increase high availability and do failover</li>
<li>origin group: one primary and one secondary origin</li>
<li>if the primary origin fails, the second one is used (works for both EC2 instance and S3 buckets)</li>
</ul>
<h2 id="field-level-encryption"><a class="markdownIt-Anchor" href="#field-level-encryption"></a> field level encryption</h2>
<ul>
<li>protect user sensitive information throught application stack</li>
<li>adds an additional layer of security along with HTTPS</li>
<li>sensitive information encrypted at the edge close to user</li>
<li>uses asymmetric encryption</li>
<li>usage:
<ul>
<li>specify set of fields in POST request that you want to be encrypted (up to 10 fields)</li>
<li>specify the public key to encrypt them</li>
<li>fields will be encrypted using the public key at edge locations and will be decrypted when the request reached the web servers</li>
</ul>
</li>
</ul>
<h1 id="ecs"><a class="markdownIt-Anchor" href="#ecs"></a> ECS</h1>
<h2 id="docker"><a class="markdownIt-Anchor" href="#docker"></a> Docker</h2>
<ul>
<li>
<p>Docker is a software development platform to deploy apps</p>
</li>
<li>
<p>apps are packaged in containers that can be run on any OS</p>
</li>
<li>
<p>apps run the same, regardless of where they are run</p>
<ul>
<li>any machine</li>
<li>no compatibility issues</li>
<li>predictable behavior</li>
<li>less work</li>
<li>easier to maintain and deploy</li>
<li>works with any language, any OS, any technology</li>
</ul>
</li>
<li>
<p>Docker images are stored in Docker repositories</p>
</li>
<li>
<p>public: Docker hub</p>
</li>
<li>
<p>private: Amazon ECR</p>
</li>
<li>
<p>Docker vs VM</p>
<ul>
<li>docker is sort of a virtualization technology, but not exactly</li>
<li>resources are shared with the host =&gt; many containers on one server</li>
</ul>
</li>
<li>
<p>Docker containers management</p>
<ul>
<li>to manage containers, we need a container management platform</li>
<li>3 choices</li>
<li>ECS: Amazon’s own platform</li>
<li>Fargate: Amazon’s own serverless platform</li>
<li>EKS: Amazon’s managed Kubernates (open source)</li>
</ul>
</li>
</ul>
<h2 id="ecs-clusters-overview"><a class="markdownIt-Anchor" href="#ecs-clusters-overview"></a> ECS clusters overview</h2>
<ul>
<li>ECS clusters are logical grouping of EC2 instances</li>
<li>EC2 instances run the ECS agent (Docker container)</li>
<li>the ECS agents registers the instance to the ECS cluster</li>
<li>the EC2 instances run a special AMI, made specifically for ECS</li>
</ul>
<h2 id="ecs-task-definitions"><a class="markdownIt-Anchor" href="#ecs-task-definitions"></a> ECS task definitions</h2>
<ul>
<li>tasks definintions are metadata in JSON form to tell ECS how to run a Docker Container</li>
<li>it contains crucial information around
<ul>
<li>Image name</li>
<li>port binding for container and host (80 -&gt; 8080)</li>
<li>memory and CPU required</li>
<li>environment variables</li>
<li>networking information</li>
</ul>
</li>
</ul>
<h2 id="ecs-service"><a class="markdownIt-Anchor" href="#ecs-service"></a> ECS service</h2>
<ul>
<li>ECS service help define how many tasks should run and how they should be run</li>
<li>they ensure that the number of tasks desired is running across our fleet of EC2 instances</li>
<li>they can be linked to ELB / NLB / ALB if needed</li>
</ul>
<h2 id="ecs-service-with-load-balancer"><a class="markdownIt-Anchor" href="#ecs-service-with-load-balancer"></a> ECS service with load balancer</h2>
<ul>
<li>ALB has the dynamic port forwarding feature</li>
<li>when you create ECS tasks it assign random port numbers to tasks</li>
<li>multiple ECS tasks can be run on a single EC2 instances with different port numbers</li>
<li>ALB can use the dynamic port forwarding feature to route traffic to these tasks based on their port number</li>
</ul>
<h2 id="ecr"><a class="markdownIt-Anchor" href="#ecr"></a> ECR</h2>
<ul>
<li>ECR is a private Docker image reporsitory</li>
<li>access is controlled through IAM (if you have permission errors, check the policy)</li>
</ul>
<h3 id="how-to-login-to-ecr-using-aws-cli"><a class="markdownIt-Anchor" href="#how-to-login-to-ecr-using-aws-cli"></a> how to login to ECR using AWS CLI</h3>
<ul>
<li>if you have AWS CLI version 1
<ul>
<li><code>$(aws ecr get-login --no-include-email --region eu-west-1)</code></li>
<li>then you need to execute the output of the above command</li>
</ul>
</li>
<li>if you have AWS CLI version 2
<ul>
<li><code>aws ecr get-login-password --region eu-west-1 | docker login --username AWS --password-stdin 12334556790.dkr.ecr.eu-west-1.amazonaws.com</code></li>
<li>you could just execute the above command which is using the pipe feature</li>
</ul>
</li>
<li>Docker push and pull</li>
</ul>
<h2 id="fargate"><a class="markdownIt-Anchor" href="#fargate"></a> Fargate</h2>
<ul>
<li>when launching an ECS cluster, we have to create our EC2 instances</li>
<li>if we need to scale, we need to add EC2 instances</li>
<li>so we need to manage infrastructure…</li>
<li>with Fargate, it is all serverless</li>
<li>we don’t provision EC2 instances</li>
<li>we just create task definitions, and AWS will run our containers for us</li>
</ul>
<h2 id="ecs-iam-roles-deep-dive"><a class="markdownIt-Anchor" href="#ecs-iam-roles-deep-dive"></a> ECS IAM roles deep dive</h2>
<ul>
<li>EC2 instance profile
<ul>
<li>for EC2 instance to run ECS task, we need to install ECS agent on the EC2 instance</li>
<li>ECS will do these things</li>
<li>make API calls to ECS service</li>
<li>send container logs to CloudWatch logs</li>
<li>pull docker image from ECR</li>
<li>so ECS agent will use the EC2 instance profile role to do these things</li>
</ul>
</li>
<li>ECS task role
<ul>
<li>when we run ECS tasks on EC2 instance, each task will have its own role</li>
<li>we use different roles for the different ECS services run</li>
<li>task role in defined in the task definition</li>
</ul>
</li>
</ul>
<h2 id="ecs-tasks-placement"><a class="markdownIt-Anchor" href="#ecs-tasks-placement"></a> ECS tasks placement</h2>
<ul>
<li>when a task of type EC2 is launched, ECS must determine where to place it, with the constraints of CPU, memory, and available port</li>
<li>similarly, when a service scales in, ECS needs to determine which task to terminate</li>
<li>to assist with this, you can define a task placement strategy and task placement constraints</li>
<li>NOTE: this is only for ECS with EC2, not for Fargate</li>
</ul>
<h3 id="ecs-task-placement-process"><a class="markdownIt-Anchor" href="#ecs-task-placement-process"></a> ECS task placement process</h3>
<ul>
<li>task placement strategies are a best effort</li>
<li>when Amazon ECS places tasks, it uses the following process to select container instances</li>
</ul>
<ol>
<li>identify the instances that satisfy the CPU, memory, and port requirements in the task definition</li>
<li>identify the instances that satisfy the task placement constraints</li>
<li>identify the instances that satisfy the placement strategies</li>
</ol>
<h3 id="ecs-task-placement-strategies"><a class="markdownIt-Anchor" href="#ecs-task-placement-strategies"></a> ECS task placement strategies</h3>
<ul>
<li>Binpack
<ul>
<li>place tasks based on the least available amount of CPU or memory</li>
<li>this minimize the number of instances in use (cost savings)</li>
</ul>
</li>
<li>random
<ul>
<li>place the task randomly</li>
</ul>
</li>
<li>spread
<ul>
<li>place the task evenly based on the specified value</li>
<li>example: instanceID, availability zone</li>
</ul>
</li>
<li>you can also mix the placement strategies together, e.g. use Spread for the AZ and Binpack for memory</li>
</ul>
<h3 id="ecs-task-placement-constraints"><a class="markdownIt-Anchor" href="#ecs-task-placement-constraints"></a> ECS task placement constraints</h3>
<ul>
<li>distinctInstance: place each task on a different container instance</li>
<li>memberOf: places task on instances that satisfy an expression
<ul>
<li>uses the Cluster Query language</li>
<li>e.g. place tasks only on t2 instances</li>
</ul>
</li>
</ul>
<h2 id="ecs-service-auto-scaling"><a class="markdownIt-Anchor" href="#ecs-service-auto-scaling"></a> ECS service auto scaling</h2>
<ul>
<li>CPU and RAM is tracked in CloudWatch at the ECS service level</li>
<li>target tracking: target a specific average CloudWatch metric</li>
<li>step scaling: scale based on CloudWatch alarms</li>
<li>scheduled scaling: based on predictable changes</li>
<li>ECS service scaling (task level) != EC2 auto scaling (instance level)</li>
<li>Fargate auto scaling is much easier to setup (because of serverless)</li>
</ul>
<h2 id="ecs-cluster-capacity-provider"><a class="markdownIt-Anchor" href="#ecs-cluster-capacity-provider"></a> ECS cluster capacity provider</h2>
<ul>
<li>a capacity provider is used in association with a cluster to determine the infrastructure that a task runs on
<ul>
<li>for ECS and Fargate users, the FARGATE and FARGATE_SPOT capacity providers are added automatically</li>
<li>for Amazon ECS on EC2, you need to associate the capacity provider with an auto scaling group</li>
</ul>
</li>
<li>when you run a task or a service, you define a capacity provider strategy, to prioritize in which provider to run</li>
<li>this allows the capacity provider to automatically provision infrastructure for you</li>
<li>if you set the average CPU to be at most 70%, then cluster capacity provider will create a new EC2 instance for you when you create a new task to run</li>
</ul>
<h2 id="ecs-data-volumes"><a class="markdownIt-Anchor" href="#ecs-data-volumes"></a> ECS data volumes</h2>
<h3 id="ec2-task-strategies"><a class="markdownIt-Anchor" href="#ec2-task-strategies"></a> EC2 task strategies</h3>
<ul>
<li>the EBS volume is already mounted onto the EC2 instances</li>
<li>this allows your Docker containers to mount the EBS volume and extend the storage capacity of your task</li>
<li>Problem: if your task moves from one EC2 instance to another one, it won’t be the same EBS volume and data, because EBS volume is mounted to the old EC2 instance</li>
<li>use cases:
<ul>
<li>mount a data volume between different containers on the same instance</li>
<li>extend the temporary storage of a task</li>
</ul>
</li>
</ul>
<h3 id="efs-file-systems"><a class="markdownIt-Anchor" href="#efs-file-systems"></a> EFS file systems</h3>
<ul>
<li>works for both EC2 tasks and Fargate tasks</li>
<li>ability to mount EFS volumes onto tasks</li>
<li>tasks launched in any AZ will be able to share the same data in the EFS volume</li>
<li>Fargate + EFS = serverless + data storage without managing servers</li>
<li>use case: persistent multi AZ shared storage for your containers</li>
</ul>
<h3 id="bind-mounts-sharing-data-between-containers"><a class="markdownIt-Anchor" href="#bind-mounts-sharing-data-between-containers"></a> Bind Mounts sharing data between containers</h3>
<ul>
<li>works for both EC2 tasks (using local EC2 instance storage) and Fargate tasks (get 4GB for volume mounts)</li>
<li>useful to share an ephemeral storage between multiple containers part of the same ECS task</li>
<li>great for sidecar container pattern where the sidecar can be used to send metrics / logs to other destinations</li>
</ul>
<h1 id="beanstalk"><a class="markdownIt-Anchor" href="#beanstalk"></a> Beanstalk</h1>
<h2 id="developer-problems-on-aws"><a class="markdownIt-Anchor" href="#developer-problems-on-aws"></a> developer problems on AWS</h2>
<ul>
<li>
<p>managing infrastructure</p>
</li>
<li>
<p>deploying code</p>
</li>
<li>
<p>configuring all the databases, load balancers, etc…</p>
</li>
<li>
<p>scaling concerns</p>
</li>
<li>
<p>most web apps have the same architecture (ALB + ASG)</p>
</li>
<li>
<p>all the developers want is for their code to run</p>
</li>
<li>
<p>possibly, consistently across different applications and environments</p>
</li>
</ul>
<h2 id="elastic-beanstalk-overview"><a class="markdownIt-Anchor" href="#elastic-beanstalk-overview"></a> Elastic Beanstalk overview</h2>
<ul>
<li>a developer centric view of deploying an application on AWS</li>
<li>it uses all components’ we have seen before: EC2, ASG, ELB, RDS…</li>
<li>managed services
<ul>
<li>automatically handles capacity provisioning, load balancing, scaling, application health monitoring, instance configuration…</li>
<li>just the application code is the responsiblity of the developer</li>
</ul>
</li>
<li>we still have full control over the configuration</li>
<li>Beanstalk is free but you pay for the underlying instances</li>
</ul>
<h2 id="components"><a class="markdownIt-Anchor" href="#components"></a> Components</h2>
<ul>
<li>
<p>application: collection of Elastic Beanstalk components (environments, versions, configurations)</p>
</li>
<li>
<p>application version: an iteration of your application code</p>
</li>
<li>
<p>environment</p>
<ul>
<li>collection of AWS resources running an application version (only one application version at a time)</li>
<li>tiers: web server environment tier and worker environment tier</li>
<li>you can create multiple environmnets (dev, test, prod…)</li>
</ul>
</li>
<li>
<p>web environment</p>
<ul>
<li>use ELB with multiple EC2 instances running on different AZs and ASG to scale</li>
</ul>
</li>
<li>
<p>worker environment</p>
<ul>
<li>use SQS queue with multiple EC2 instances running on different AZs and ASG will scale based on SQS’s length</li>
</ul>
</li>
</ul>
<h2 id="beanstalk-deployment-options"><a class="markdownIt-Anchor" href="#beanstalk-deployment-options"></a> Beanstalk deployment options</h2>
<h3 id="all-at-once"><a class="markdownIt-Anchor" href="#all-at-once"></a> All at once</h3>
<ul>
<li>fastest deployment</li>
<li>application has downtime</li>
<li>great for quick iterations in development environment</li>
<li>no additional cost</li>
</ul>
<h3 id="rolling"><a class="markdownIt-Anchor" href="#rolling"></a> Rolling</h3>
<ul>
<li>application is running below capacity</li>
<li>can set the bucket size, bucket size is the number of new instances we launched each time</li>
<li>application is running both versions simultaneously</li>
<li>no additional cost</li>
<li>long deployment</li>
</ul>
<h3 id="rolling-with-additional-batches"><a class="markdownIt-Anchor" href="#rolling-with-additional-batches"></a> Rolling with additional batches</h3>
<ul>
<li>application is running at capacity</li>
<li>can set the bucket size</li>
<li>application is running both versions simultaneously</li>
<li>small additional cost</li>
<li>additional batch is removed at the end of the deployment</li>
<li>longer deployment</li>
<li>good for production environment</li>
</ul>
<h3 id="immutable"><a class="markdownIt-Anchor" href="#immutable"></a> Immutable</h3>
<ul>
<li>zero downtime</li>
<li>new code is deployed to new instances on a temporary ASG</li>
<li>high cost, double capacity</li>
<li>longest deployment</li>
<li>quick rollback in case of failures (just terminate new ASG)</li>
<li>great for production</li>
</ul>
<h3 id="blue-green"><a class="markdownIt-Anchor" href="#blue-green"></a> Blue / Green</h3>
<ul>
<li>not a direct feature of Elastic Beanstalk</li>
<li>zero downtime and release facility</li>
<li>create a new stage environment and deploy version 2 there</li>
<li>the new environment (green) can be validated independently and roll back if issue happens</li>
<li>route 53 can be setup using weighted policies to redirect a little bit of traffic to the stage environment</li>
<li>using Beanstalk, swap URLs when done with the environment test</li>
</ul>
<h3 id="traffic-splitting-canary-testing"><a class="markdownIt-Anchor" href="#traffic-splitting-canary-testing"></a> Traffic splitting (Canary Testing)</h3>
<ul>
<li>new application version is deployed to a temporary ASG with the same capacity</li>
<li>a small percetage of traffic is sent to the temporary ASG for a configuraion amount of time</li>
<li>deployment health is monitored</li>
<li>if there is a deployment failure, this triggers an automated roll back (very quick)</li>
<li>no application downtime</li>
<li>new instances are migrated from the temporary to the original ASG</li>
<li>old application version is then terminated</li>
</ul>
<h3 id="deploy-using-cli"><a class="markdownIt-Anchor" href="#deploy-using-cli"></a> Deploy using CLI</h3>
<ul>
<li>describe dependencies</li>
<li>package code as zip, and describe dependencies</li>
<li>console: upload zip file  (creates new app version), and then deploy</li>
<li>CLI: create new app version using CLI (uploads zip), and then deploy</li>
<li>Elastic Beanstalk will deploy the zip on each EC2 instance, resolve dependencies and start the application</li>
</ul>
<h2 id="beanstalk-lifecycle-policy"><a class="markdownIt-Anchor" href="#beanstalk-lifecycle-policy"></a> Beanstalk lifecycle policy</h2>
<ul>
<li>Elastic Beanstalk can store at most 1000 application versions</li>
<li>if you don’t remove old versions, you won’t be able to deploy anymore</li>
<li>to phase out old application versions, use a lifecycle policy
<ul>
<li>based on time (old versions are removed)</li>
<li>based on space (when you have too many versions)</li>
</ul>
</li>
<li>versions that are currently used won’t be deleted</li>
<li>option not to delete the source bundle in S3 to prevent data loss</li>
</ul>
<h2 id="beanstalk-extensions"><a class="markdownIt-Anchor" href="#beanstalk-extensions"></a> Beanstalk extensions</h2>
<ul>
<li>a zip file containing our code must be deployed to Elastic Beanstalk</li>
<li>all the parameters set in the UI can be configured with code using files</li>
<li>requriements
<ul>
<li>in the <code>.ebextensions/</code> directory in the root of source code</li>
<li>YAML / JSON format</li>
<li><code>.config</code> extensions (example: <code>logging.config</code>)</li>
<li>able to modify some default settings using: <code>option_settings</code></li>
<li>ability to add resources such as RDS, ElastiCache, DynamoDB, etc…</li>
</ul>
</li>
<li>resources managed by <code>.ebextensions</code> get deleted if the environment goes away</li>
</ul>
<h2 id="beanstalk-vs-cloudformation"><a class="markdownIt-Anchor" href="#beanstalk-vs-cloudformation"></a> Beanstalk vs CloudFormation</h2>
<ul>
<li>under the hood, Elastic Beanstalk relies on CloudFormation</li>
<li>CloudFormation is used to provision other AWS services</li>
<li>use case: you can define CloudFormation resources in your <code>.ebextensions</code> to provision ElastiCache, S3 bucket, or anything you want.</li>
</ul>
<h2 id="elastic-beanstalk-cloning"><a class="markdownIt-Anchor" href="#elastic-beanstalk-cloning"></a> Elastic Beanstalk cloning</h2>
<ul>
<li>clone an environment with the exact same configuration</li>
<li>useful for deploying a test version of your application</li>
<li>all resources and configuration are preserved
<ul>
<li>load balancer type and configuration</li>
<li>RDS database type (but data is not preserved)</li>
<li>environment variables</li>
</ul>
</li>
<li>after cloning an environment, you can change settings</li>
</ul>
<h2 id="beanstalk-migration"><a class="markdownIt-Anchor" href="#beanstalk-migration"></a> Beanstalk migration</h2>
<h3 id="load-balancer"><a class="markdownIt-Anchor" href="#load-balancer"></a> load balancer</h3>
<ul>
<li>after creating an Elastic Beanstalk environmnet, you cannot change the ELB type</li>
<li>to migrate to a different ELB
<ol>
<li>create a new env with the same configuration except LB, create your new LB here</li>
<li>deploy your application onto the new env</li>
<li>perform a CNAME swap or Route 53 update so all your traffic can be direct to the new env</li>
</ol>
</li>
</ul>
<h3 id="rds-2"><a class="markdownIt-Anchor" href="#rds-2"></a> RDS</h3>
<ul>
<li>
<p>RDS can be provisioned with Beanstalk, which is greate for dev / test</p>
</li>
<li>
<p>this is not great for production as database lifecycle is tied to the Beanstalk environment lifecycle</p>
</li>
<li>
<p>the best for prod is to separately create an RDS database and provide our Beanstalk application with the connection string</p>
</li>
<li>
<p>but what if you have already created Beanstalk application with the RDS in production? How to migrate it to a new environment without RDS?</p>
</li>
</ul>
<ol>
<li>create a snapshot of RDS DB (as a safeguard)</li>
<li>go to the RDS console and protect the RDS database from deletion</li>
<li>create a new environment, without RDS, point your application to the existing RDS in the old env</li>
<li>perform a CNAME swap or Route 53 update, confirm it is working</li>
<li>terminate the old env (RDS will not be deleted because you prevent it in the console)</li>
<li>delete the CloudFormation stack manually (it will be in DELETE_FAILED state because it can’t delete RDS)</li>
</ol>
<h2 id="single-docker"><a class="markdownIt-Anchor" href="#single-docker"></a> single Docker</h2>
<ul>
<li>run your application as a single Docker container</li>
<li>either provide
<ul>
<li>Dockerfile: Elastic Beanstalk will build and run the Docker container</li>
<li>Dockerrun.aws.json (v1): describe where the Docker image is (already built)</li>
</ul>
</li>
<li>Beanstalk in single Docker container does not use ECS</li>
</ul>
<h2 id="multi-docker-containers"><a class="markdownIt-Anchor" href="#multi-docker-containers"></a> Multi Docker containers</h2>
<ul>
<li>multi docker helps run multiple containers per EC2 instance in EB</li>
<li>this will create for you
<ul>
<li>ECS cluster</li>
<li>EC2 instances, configured to use the ECS cluster</li>
<li>load balancer (in HA mode)</li>
<li>task definitions and execution</li>
</ul>
</li>
<li>requries a config Dockerrun.aws.json (v2) at the root of the source code</li>
<li>Dockerrun.aws.json is used to generate the ECS task definition</li>
</ul>
<h2 id="elastic-beanstalk-and-https"><a class="markdownIt-Anchor" href="#elastic-beanstalk-and-https"></a> Elastic Beanstalk and HTTPS</h2>
<ul>
<li>Beanstalk with HTTPS
<ul>
<li>idea: load the SSL certificate onto the load balancer</li>
<li>can be done from the console (EB console, load balancer configuration)</li>
<li>can be done from the code: <code>.ebextensions/securelistener-alb.config</code></li>
<li>SSL certificate can be provisioned using ACM or CLI</li>
<li>must configure a security group rule to allow incoming port 443 (HTTPS port)</li>
</ul>
</li>
<li>Beanstalk redirect HTTP to HTTPS
<ul>
<li>configure your instances to redirect HTTP to HTTPS</li>
<li>configure the application load balancer with a rule</li>
<li>make sure health checks are not redirected (so they keep giving 200 OK, otherwise they will receive 301 and 302…)</li>
</ul>
</li>
</ul>
<h2 id="web-server-vs-worker-environment"><a class="markdownIt-Anchor" href="#web-server-vs-worker-environment"></a> Web server vs worker environment</h2>
<ul>
<li>if your application performs tasks that are long to complete, offload these tasks to a dedicated worker environment</li>
<li>decoupling your application into two tiers is common</li>
<li>example: processing a video, generating a zip file, etc…</li>
<li>you can define periodic tasks in a file <code>cron.yaml</code></li>
</ul>
<h2 id="custom-platform-advanced"><a class="markdownIt-Anchor" href="#custom-platform-advanced"></a> custom platform (advanced)</h2>
<ul>
<li>custom platforms are very advanced, they allow to define from scratch
<ul>
<li>the OS</li>
<li>additional software</li>
<li>scripts that Beanstalk runs on these platforms</li>
</ul>
</li>
<li>use case: app language is incompatible with Beanstalk and doesn’t use Docker</li>
<li>to create your own platform
<ul>
<li>define an AMI using Platform.yaml file</li>
<li>build that platform using the Packer software (open source tool to create AMIs)</li>
</ul>
</li>
<li>custom platform vs Custom image
<ul>
<li>custom image is to tweak an existing Beanstalk platform</li>
<li>custom platform is to create an entirely new Beanstalk platform</li>
</ul>
</li>
</ul>
<h1 id="cicd"><a class="markdownIt-Anchor" href="#cicd"></a> CICD</h1>
<h2 id="introduction"><a class="markdownIt-Anchor" href="#introduction"></a> Introduction</h2>
<ul>
<li>we now know how to create resources in AWS manually</li>
<li>we know how to interact with AWS CLI</li>
<li>we have seen how to deploy code to AWS using Elastic Beanstalk</li>
<li>all these manual steps make it very likely for us to do mistakes</li>
<li>what we would like is to push our code in a repository and have it deployed onto the AWS
<ul>
<li>automatically</li>
<li>the right way</li>
<li>making sure it is tested before deploying</li>
<li>with possibility to go into different stages</li>
<li>with manual approval where needed</li>
</ul>
</li>
<li>to be a proper AWS developer, we need to learn AWS CICD</li>
</ul>
<h2 id="continuous-integration"><a class="markdownIt-Anchor" href="#continuous-integration"></a> Continuous integration</h2>
<ul>
<li>developers push the code to a code repository often (github, codecommit, bitbucket, etc…)</li>
<li>a testing / build server checks the code as soon as it is pushed (codebuild, Jenkins CI, etc…)</li>
<li>the developer gets feedback about the tests and checks that have passed / failed</li>
<li>find bugs early, fix bugs</li>
<li>deliver faster as the code is tested</li>
<li>deploy often</li>
</ul>
<h2 id="continuous-delivery"><a class="markdownIt-Anchor" href="#continuous-delivery"></a> Continuous delivery</h2>
<ul>
<li>ensure that the software can be released reliably whenever needed</li>
<li>ensures deployments happen often and are quick</li>
<li>automated deployment</li>
</ul>
<h2 id="codecommit"><a class="markdownIt-Anchor" href="#codecommit"></a> CodeCommit</h2>
<ul>
<li>
<p>version control is the ability to understand the various changes that happened to the code over time</p>
</li>
<li>
<p>all these are enabled by using a version control system such as git</p>
</li>
<li>
<p>a git repository can live on one’s machine, but it usually lives on a central online repository</p>
</li>
<li>
<p>benefits are</p>
<ul>
<li>collaborate with other developers</li>
<li>make sure the code is backed up somewhere</li>
<li>make sure it is fully viewable and auditable</li>
</ul>
</li>
<li>
<p>git repositories can be expensive</p>
</li>
<li>
<p>the industry incldues</p>
<ul>
<li>github</li>
<li>bitbucket</li>
</ul>
</li>
<li>
<p>AWS CodeCommit</p>
<ul>
<li>private git repositories</li>
<li>no size limit on repositories</li>
<li>fully managed, HA</li>
<li>code only in AWS, increased security and compliance</li>
<li>secure</li>
<li>integrated with Jenkins / CodeBuild / other CI tools</li>
</ul>
</li>
</ul>
<h3 id="security-2"><a class="markdownIt-Anchor" href="#security-2"></a> security</h3>
<ul>
<li>interactions are done using git</li>
<li>authentication in git
<ul>
<li>SSH keys: AWS users can configure SSH keys in their IAM console</li>
<li>HTTPS: done through the AWS CLI Authentication helper ot generating HTTPS credentials</li>
<li>MFA can be enabled for extra security</li>
</ul>
</li>
<li>Authorization in git
<ul>
<li>IAM policies manage user / roles rights to repositories</li>
</ul>
</li>
<li>encryption
<ul>
<li>repositories are automatically encrypted at rest using KMS</li>
<li>encrypted in transit (can only use HTTPS and SSH - both secure)</li>
</ul>
</li>
<li>cross account access
<ul>
<li>do not share your SSH keys</li>
<li>do not share your AWS credentials</li>
<li>use IAM role in your AWS account and use AWS STS (with AssumeRole API)</li>
</ul>
</li>
</ul>
<h3 id="codecommit-vs-github"><a class="markdownIt-Anchor" href="#codecommit-vs-github"></a> CodeCommit vs Github</h3>
<ul>
<li>Similarities
<ul>
<li>both are git repositories</li>
<li>both support code review</li>
<li>github and CodeCommit can be integrated with AWS CodeBuild</li>
<li>both support HTTPS and SSH method of authentication</li>
</ul>
</li>
<li>differences
<ul>
<li>security
<ul>
<li>github: github users</li>
<li>codecommit: AWS IAM users / roles</li>
</ul>
</li>
<li>hosted:
<ul>
<li>github: hosted by github</li>
<li>github enterprise: self hosted on your servers</li>
<li>codecommit: managed and hosted by AWS</li>
</ul>
</li>
<li>UI
<ul>
<li>github UI is fully featured</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="notifications"><a class="markdownIt-Anchor" href="#notifications"></a> notifications</h3>
<ul>
<li>you can trigger notifications in CodeCommit using AWS SNS or AWS lambda or CloudWatch event rules</li>
<li>use cases for notifications SNS / lambda
<ul>
<li>deletion of branches</li>
<li>trigger for pushes that happens in master branch</li>
<li>notify external build system</li>
<li>trigger AWS lambda function to perform codebase analysis</li>
</ul>
</li>
<li>use cases for CloudWatch event rules
<ul>
<li>trigger for pull request updates</li>
<li>commit comment event</li>
<li>CloudWatch event rules goes into an SNS topic</li>
</ul>
</li>
</ul>
<h2 id="codepipeline"><a class="markdownIt-Anchor" href="#codepipeline"></a> CodePipeline</h2>
<ul>
<li>Continuous delivery</li>
<li>visual workflow</li>
<li>source: github / codecommit / S3</li>
<li>build: codebuild / Jenkins</li>
<li>load testing: third party tools</li>
<li>deploy: AWS code deploy / Beanstalk / CloudFormation / ECS</li>
<li>made of stages
<ul>
<li>each stage can have sequential actions or parallel actions</li>
<li>stages examples: build / test / deploy / load test</li>
<li>manual approval can be defined at any stage</li>
</ul>
</li>
</ul>
<h3 id="artifacts"><a class="markdownIt-Anchor" href="#artifacts"></a> artifacts</h3>
<ul>
<li>each pipeline stage can create artifacts</li>
<li>artifacts are passed stored in S3 and passed on to the next stage</li>
</ul>
<h3 id="troubleshooting"><a class="markdownIt-Anchor" href="#troubleshooting"></a> troubleshooting</h3>
<ul>
<li>codepipeline state changes happen in CloudWatch events, which can in return create SNS notifications
<ul>
<li>you can create events for failed pipelines</li>
<li>you can create events for cancelled stages</li>
</ul>
</li>
<li>if codepipeline fails a stage, your pipeline stops and you can get information in the console</li>
<li>CloudTrail can be used to audit AWS API calls</li>
<li>if pipeline can’t perform an action, make sure the IAM service role attached does have enough permissions</li>
</ul>
<h2 id="codebuild"><a class="markdownIt-Anchor" href="#codebuild"></a> CodeBuild</h2>
<ul>
<li>
<p>fully managed build service</p>
</li>
<li>
<p>alternative to other build tools such as Jenkins</p>
</li>
<li>
<p>continuous scaling (no servers to manage or provision - no build queue)</p>
</li>
<li>
<p>pay for usage: the time it takes to complete the builds</p>
</li>
<li>
<p>leverages Docker under the hood for reproducible builds</p>
</li>
<li>
<p>possibility to extend capabilities leveraging our own base Docker images</p>
</li>
<li>
<p>secure: integration with KMS for encryption of build artifacts, IAM for build permissions, and VPC for network security, CloudTrail for API calls logging</p>
</li>
<li>
<p>source code from github / codecommit / codepipeline / S3</p>
</li>
<li>
<p>build instructions can be defined in code (buildspec.yml file)</p>
</li>
<li>
<p>output logs to S3 and AWS cloudwatch logs</p>
</li>
<li>
<p>metrics to monitor codebuild statistics</p>
</li>
<li>
<p>use cloudwatch alarms to detect failed builds and trigger notifications</p>
</li>
<li>
<p>cloudwatch events / lambda as a Glue</p>
</li>
<li>
<p>SNS notifications</p>
</li>
<li>
<p>ability to reproduce codebuild locally to troubleshoot in case of errors</p>
</li>
<li>
<p>builds can be defined within CodePipeline or Codebuild itself</p>
</li>
</ul>
<h3 id="buildspec"><a class="markdownIt-Anchor" href="#buildspec"></a> BuildSpec</h3>
<ul>
<li>buildspec.yml file must be at the root of your code</li>
<li>define environment variables
<ul>
<li>plaintext variables</li>
<li>secure secrets: use SSM parameter store</li>
</ul>
</li>
<li>phases
<ul>
<li>install: install dependencies you may need for your build</li>
<li>pre build: final commands to execute before build</li>
<li>build: actual build commands</li>
<li>post build: finishing touches (zip output)</li>
</ul>
</li>
<li>artifacts: what to upload to S3</li>
<li>cache: files to cache to S3 for future build speedup</li>
</ul>
<h3 id="local-build"><a class="markdownIt-Anchor" href="#local-build"></a> local build</h3>
<ul>
<li>in case of need of deep troubleshooting beyond logs</li>
<li>you can run CodeBuild on your laptop (after installing Docker)</li>
<li>for this, leverage CodeBuild agent</li>
</ul>
<h3 id="codebuild-in-vpc"><a class="markdownIt-Anchor" href="#codebuild-in-vpc"></a> CodeBuild in VPC</h3>
<ul>
<li>by default, your Codebuild containers are launched outside your VPC</li>
<li>therefore, by default, it cannot access resources in a VPC</li>
<li>you can specify a VPC configuration
<ul>
<li>VPC ID</li>
<li>subnet ID</li>
<li>security group ID</li>
</ul>
</li>
<li>they your build can access resources in your VPC</li>
<li>use case: integration tests, data query, internal load balancers</li>
</ul>
<h2 id="codedeploy"><a class="markdownIt-Anchor" href="#codedeploy"></a> CodeDeploy</h2>
<ul>
<li>we want to deploy our application automatically to many EC2 instances</li>
<li>these instances are not managed by Elastic Beanstalk</li>
<li>there are several ways to handle deployments using open source tools (Ansible, Terraform, Chef, Pupper, etc…)</li>
</ul>
<h3 id="steps"><a class="markdownIt-Anchor" href="#steps"></a> Steps</h3>
<ul>
<li>Each EC2 machine (or on premises machine) must be running the CodeDeploy agent</li>
<li>the agent is continuously polling AWS codeDeploy for work to do</li>
<li>CodeDeploy sends appspec.yml file</li>
<li>application is pulled from github or S3</li>
<li>EC2 will run the deployment instructions</li>
<li>CodeDeploy agent will report of success / faliure of deployment on the instance</li>
</ul>
<h3 id="other-information"><a class="markdownIt-Anchor" href="#other-information"></a> other information</h3>
<ul>
<li>EC2 instances are grouped by deployment group (dev / test / prod)</li>
<li>lots of flexibility to define any kind of deployments</li>
<li>CodeDeploy can be chained into CodePipeline and use artifacts from there</li>
<li>CodeDeploy can reuse existing setup tools, works with any application, auto scaling integraion</li>
<li>Note: Blue / Green only works with EC2 instances (not on premises)</li>
<li>support for AWS lambda deployments</li>
<li>CodeDeploy does not provision resources</li>
</ul>
<h3 id="primary-components"><a class="markdownIt-Anchor" href="#primary-components"></a> primary components</h3>
<ul>
<li>application: unique name</li>
<li>compute platform: EC2 or on premises or lambda</li>
<li>deployment configuration: deployment rules for success / failures
<ul>
<li>EC2 or on premises: you can specify the minimum number of healthy instances for the deployment</li>
<li>lambda: specify how traffic ;is routed to your updated lambda function versions</li>
</ul>
</li>
<li>deployment group: group of tagged instances (allows to deploy gradually)</li>
<li>deployment type: in place deployment or Blue/Green deployment</li>
<li>IAM instance profile: need to give EC2 the permissions to pull from S3 / github</li>
<li>application revision: application code + appspec.yml file</li>
<li>service role: role for CodeDeploy to perform what it needs</li>
<li>target revision: target deployment application version</li>
</ul>
<h3 id="appspec"><a class="markdownIt-Anchor" href="#appspec"></a> Appspec</h3>
<ul>
<li>file section: how to source and copy from S3 / github to filesystem</li>
<li>hooks: set of instructions to do to deploy the new version (hooks can have timeouts)
<ul>
<li>applicationStop</li>
<li>DownloadBundle</li>
<li>BeforeInstall</li>
<li>AfterInstall</li>
<li>ApplicationStart</li>
<li>ValidateService: really important</li>
</ul>
</li>
</ul>
<h3 id="deployment-config"><a class="markdownIt-Anchor" href="#deployment-config"></a> Deployment config</h3>
<ul>
<li>Configs:
<ul>
<li>one a time: one instance at a time, one instance fails =&gt; deployment stops</li>
<li>half at a time: 50%</li>
<li>all at once: quick but no healthy host, downtime, good for dev</li>
<li>custom: min healthy host = 75%</li>
</ul>
</li>
<li>failures:
<ul>
<li>instances stay in failed state</li>
<li>new deployments will first be deployed to failed state instances</li>
<li>to rollback: re-deploy old deployment or enable automated rollback for failures</li>
</ul>
</li>
<li>deployment targets
<ul>
<li>set of EC2 instances with tags</li>
<li>directly to an ASG</li>
<li>mix of ASG / tags so you can build deployment segments</li>
<li>customization in scripts with DEPLOYMENT_GROUP_NAME environment variables</li>
</ul>
</li>
</ul>
<h3 id="codedeploy-for-ec2-and-asg"><a class="markdownIt-Anchor" href="#codedeploy-for-ec2-and-asg"></a> CodeDeploy for EC2 and ASG</h3>
<ul>
<li>
<p>code deploy to EC2</p>
<ul>
<li>define how to deploy the application using appspec.yml + deployment strategy</li>
<li>will do in place update to your fleet of EC2 instances</li>
<li>can use hooks to verify the deployment after each deployment phase</li>
</ul>
</li>
<li>
<p>code deploy to ASG</p>
<ul>
<li>in place updates
<ul>
<li>updates current existing EC2 instances</li>
<li>instances newly created by an ASG will also get automated deployments</li>
</ul>
</li>
<li>Blue / Green deployment
<ul>
<li>a new auto scaling group is created (settings are copied)</li>
<li>choose how long to keep the old instances</li>
<li>must be using an ELB (for directing traffic to new ASG group)</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="codestar"><a class="markdownIt-Anchor" href="#codestar"></a> CodeStar</h2>
<ul>
<li>CodeStar is an integrated solution that regroups: github, codecommit, codebuild, codeDeploy, CloudFormation, codepipeline, cloudwatch</li>
<li>helps quickly create CICD ready projects for EC2, lambda, Beanstalk</li>
<li>supported language: C#, Go, HTML5, Java, Node.js, PHP, Python, Ruby</li>
<li>issue tracking integration with JIRA, Github issues</li>
<li>ability to integrate with Cloud9 to obtain a web IDE</li>
<li>one dashboard to view all your components</li>
<li>free services, pay only for the underlying usage of other services</li>
<li>limited customization</li>
</ul>
<h1 id="cloudformation"><a class="markdownIt-Anchor" href="#cloudformation"></a> CloudFormation</h1>
<h2 id="infrastructure-as-code"><a class="markdownIt-Anchor" href="#infrastructure-as-code"></a> infrastructure as code</h2>
<ul>
<li>
<p>manual work will be very tough to reproduce</p>
<ul>
<li>in another region</li>
<li>in another AWS account</li>
<li>within the same region if everything was deleted</li>
</ul>
</li>
<li>
<p>CloudFormation would be the code to create / update / delete our infrastructure</p>
</li>
<li>
<p>CloudFormation is a declarative way of outlining your AWS infrastructure, for any resources</p>
</li>
<li>
<p>CloudFormation creates the resources for you in the right order, with the exact configuration that you sepcify</p>
</li>
</ul>
<h2 id="benefits"><a class="markdownIt-Anchor" href="#benefits"></a> benefits</h2>
<ul>
<li>
<p>infrastructure as code</p>
<ul>
<li>no resources are manually created, which is excellent for control</li>
<li>the code can be version controlled for example using git</li>
<li>changes to the infrastructure are reviewed through code</li>
</ul>
</li>
<li>
<p>cost</p>
<ul>
<li>each resources within the stack is stagged with an identifier so you can easily see how much a stack costs you</li>
<li>you can estimate the costs of your resources using the CloudFormation template</li>
<li>savings strategy: in dev, you could automation deletion of templates at 5pm and recreate anything at 8am safely</li>
</ul>
</li>
<li>
<p>productivity</p>
<ul>
<li>ability to destroy and recreate an infrastructure on the cloud on the fly</li>
<li>automated generation of diagram for your templates</li>
<li>declarative programming (no need to figure out ordering and orchestration)</li>
</ul>
</li>
<li>
<p>separation of concern: create many stacks for many apps, and many layers</p>
</li>
<li>
<p>don’t reinvent the wheel</p>
<ul>
<li>leverage existing templates on the web</li>
<li>leverage the documentation</li>
</ul>
</li>
</ul>
<h2 id="how-cloudformation-works"><a class="markdownIt-Anchor" href="#how-cloudformation-works"></a> how cloudformation works</h2>
<ul>
<li>templates have to be uplaoded in S3 and then referenced in cloudformation</li>
<li>to update a template, we can’t edit previous ones, we have to reupload a new version of the template to AWS</li>
<li>stacks are identified by a name</li>
<li>deleting a stack deletes every single artifact that was created by CloudFormation</li>
</ul>
<h2 id="deploying-cloudformation-template"><a class="markdownIt-Anchor" href="#deploying-cloudformation-template"></a> deploying cloudformation template</h2>
<ul>
<li>manual way
<ul>
<li>editing templates in the CloudFormation designer</li>
<li>using the console to input parameters</li>
</ul>
</li>
<li>automated way
<ul>
<li>editing templates in a YAML file</li>
<li>using the AWS CLI to deploy the templates</li>
<li>recommended way when you fully want to automate your flow</li>
</ul>
</li>
</ul>
<h2 id="building-blocks"><a class="markdownIt-Anchor" href="#building-blocks"></a> building blocks</h2>
<ul>
<li>templates components
<ul>
<li>resources: your AWS resources declared in the template (mandatory)</li>
<li>parameters: the dynamic inputs for your template</li>
<li>mappings: the static variables for your templates</li>
<li>outputs: references to what has been created</li>
<li>conditionals: list of conditions to perform resource creation</li>
<li>metadata</li>
</ul>
</li>
<li>template helpers
<ul>
<li>references</li>
<li>functions</li>
</ul>
</li>
</ul>
<h2 id="resources"><a class="markdownIt-Anchor" href="#resources"></a> resources</h2>
<ul>
<li>
<p>resources are the core of your CloudFormation template</p>
</li>
<li>
<p>they repreesent the different AWS components that will be created and configured</p>
</li>
<li>
<p>resources are declared and can reference each other</p>
</li>
<li>
<p>AWS figures out creation, updates and deletes of resources for us</p>
</li>
<li>
<p>can I create a dynamic amount of resources</p>
<ul>
<li>no you can’t</li>
</ul>
</li>
<li>
<p>is every AWS services suported</p>
<ul>
<li>almost, only a few are not</li>
</ul>
</li>
</ul>
<h2 id="parameters"><a class="markdownIt-Anchor" href="#parameters"></a> parameters</h2>
<ul>
<li>parameters are a way to provide inputs to your AWS CloudFormation template</li>
<li>they are important to know about if
<ul>
<li>you want to resue your templates across the company</li>
<li>some inputs can not be determined ahead of time</li>
</ul>
</li>
<li>parameters are extremely powerful, controlled, and can precent errors from happening in your templates thanks you types</li>
</ul>
<h3 id="how-to-reference-a-parameter"><a class="markdownIt-Anchor" href="#how-to-reference-a-parameter"></a> how to reference a parameter</h3>
<ul>
<li>the <code>Fn::Ref</code> function can be leveraged to reference parameters</li>
<li>parameters can be used anywhere in a template</li>
<li>the shorthand for this in YAML is <code>!Ref</code></li>
<li>the function can also reference other elements within the template</li>
</ul>
<h3 id="pseudo-parameters"><a class="markdownIt-Anchor" href="#pseudo-parameters"></a> Pseudo parameters</h3>
<ul>
<li>AWS offers us pseudo parameters in any CloudFormation template</li>
<li>these can be used at any time and are enabled by default</li>
</ul>
<h2 id="mappings"><a class="markdownIt-Anchor" href="#mappings"></a> mappings</h2>
<ul>
<li>mappings are fixed variables within your CloudFormation template</li>
<li>they are very handy to differentiate between different environments (dev vs prod), regions, AMI types, etc…</li>
<li>all the values are hardcoded within the template</li>
</ul>
<h3 id="when-would-you-use-mappings-vs-parameters"><a class="markdownIt-Anchor" href="#when-would-you-use-mappings-vs-parameters"></a> when would you use mappings vs parameters</h3>
<ul>
<li>mappings are great when you know in advance all the values that can be taken and that they can be deduced from variables such as
<ul>
<li>region</li>
<li>AZ</li>
<li>AWS account</li>
<li>environment</li>
</ul>
</li>
<li>they allow safer control over the template</li>
<li>use parameters when the values are really user specific</li>
</ul>
<h3 id="accessing-mapping-values"><a class="markdownIt-Anchor" href="#accessing-mapping-values"></a> accessing mapping values</h3>
<ul>
<li>we use <code>Fn::FindInMap</code> to return a named value from a specific key</li>
<li><code>!FindInMap [MapName, TopLevelKey, SecondLevelKey]</code></li>
</ul>
<h2 id="outputs"><a class="markdownIt-Anchor" href="#outputs"></a> outputs</h2>
<ul>
<li>the outputs section declares optional outputs values that we can import into other stacks (if you export them first)</li>
<li>you can also view the outputs in the AWS console or using the AWS CLI</li>
<li>they are very useful for example if you define a network CloudFormation, and output the variables such as VPC ID, and your subnet IDs</li>
<li>it is the best way to perform some collaboration cross stack, as you let export handle their own part of the stack</li>
<li>you can’t delete a CloudFormation stack if its outputs are being referenced by another CloudFormation stack</li>
</ul>
<h3 id="outputs-example"><a class="markdownIt-Anchor" href="#outputs-example"></a> outputs example</h3>
<ul>
<li>create a SSH security group as part of one template</li>
<li>we create an output that references that security group</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Outputs:</span><br><span class="line">  StackSSHSecurityGroup:</span><br><span class="line">    Description: The SSH security group for our company</span><br><span class="line">    Value: !Ref MyCompanyWideSSHSecurityGroup</span><br><span class="line">    Export:</span><br><span class="line">      Name: SSHSecurityGroup</span><br></pre></td></tr></table></figure>
<h3 id="cross-stack-reference"><a class="markdownIt-Anchor" href="#cross-stack-reference"></a> Cross stack reference</h3>
<ul>
<li>we then create a second template that leverages that security group</li>
<li>for this, we use the <code>Fn::ImportValue</code> function</li>
<li>you can’t delete the underlying stack until all the references are deleted too</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Resources:</span><br><span class="line">  MySecureInstance:</span><br><span class="line">    Type: AWS::EC2::Instance</span><br><span class="line">    Properties:</span><br><span class="line">      AvailabilityZone: us-east-1a</span><br><span class="line">      ImageId: ami-xxxxxxxx</span><br><span class="line">      InstanceType: t2.micro</span><br><span class="line">      SecurityGroups:</span><br><span class="line">        - !ImportValue SSHSecurityGroup</span><br></pre></td></tr></table></figure>
<h2 id="conditions"><a class="markdownIt-Anchor" href="#conditions"></a> conditions</h2>
<ul>
<li>conditions are used to control the creation of resources or outputs based on a condition</li>
<li>conditions can be whatever you want them to be, but common ones are
<ul>
<li>environment</li>
<li>region</li>
<li>parameter value</li>
</ul>
</li>
<li>each condition can reference another condition, parameter value or mapping</li>
</ul>
<h3 id="define-a-conditon"><a class="markdownIt-Anchor" href="#define-a-conditon"></a> define a conditon</h3>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Conditions:</span><br><span class="line">  CreateProdResources: !Equals [ !Ref EnvType, prod]</span><br></pre></td></tr></table></figure>
<ul>
<li>the logical ID is for you to choose, it is how you name condition</li>
<li>the intrinsic function can by any of the following
<ul>
<li><code>Fn::And</code></li>
<li><code>Fn::Equals</code></li>
<li><code>Fn::If</code></li>
<li><code>Fn::Not</code></li>
<li><code>Fn::Or</code></li>
</ul>
</li>
</ul>
<h3 id="using-a-condition"><a class="markdownIt-Anchor" href="#using-a-condition"></a> using a condition</h3>
<ul>
<li>conditions can be applied to resources / outputs</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Resources:</span><br><span class="line">  Mountpoint:</span><br><span class="line">    Type: &quot;AWS::EC2::VolumeAttachment&quot;</span><br><span class="line">    Condition: CreateProdResources</span><br></pre></td></tr></table></figure>
<h2 id="intrinsic-functions"><a class="markdownIt-Anchor" href="#intrinsic-functions"></a> Intrinsic functions</h2>
<h3 id="fnref"><a class="markdownIt-Anchor" href="#fnref"></a> Fn::Ref</h3>
<ul>
<li>can be leveraged to reference
<ul>
<li>parameters</li>
<li>resources</li>
</ul>
</li>
</ul>
<h3 id="fngetatt"><a class="markdownIt-Anchor" href="#fngetatt"></a> Fn::GetAtt</h3>
<ul>
<li>attributes are attached to any resources you create</li>
<li>to know the attributes of your resources, the best place to look at is the documentation</li>
<li>example: AZ of an EC2 machine</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Resources:</span><br><span class="line">  EC2Instance:</span><br><span class="line">    Type: &quot;AWS::EC2::Instance&quot;</span><br><span class="line">    Properties:</span><br><span class="line">      ImageId: ami-xxxxx</span><br><span class="line">      InstanceType: t2.micro</span><br><span class="line"></span><br><span class="line">NewVolume:</span><br><span class="line">  Type: &quot;AWS::EC2::Instance&quot;</span><br><span class="line">  Condition: CreateProdResources</span><br><span class="line">  Properties:</span><br><span class="line">    Size: 100</span><br><span class="line">    AvailabilityZone:</span><br><span class="line">      !GetAtt EC2Instance.AvailabilityZone</span><br></pre></td></tr></table></figure>
<h3 id="fnfindinmap"><a class="markdownIt-Anchor" href="#fnfindinmap"></a> Fn::FindInMap</h3>
<ul>
<li>we use Fn::FindInMap to return a named value from a specific key</li>
<li>!FindInMap [MapName, TopLevelKey, SecondLevelKey]</li>
</ul>
<h3 id="fnimportvalue"><a class="markdownIt-Anchor" href="#fnimportvalue"></a> Fn::ImportValue</h3>
<ul>
<li>import values that are exported in other templates</li>
</ul>
<h3 id="fnjoin"><a class="markdownIt-Anchor" href="#fnjoin"></a> Fn::Join</h3>
<ul>
<li>join values with a delimiter</li>
<li>!Join [delimiter, [a, b, c]]</li>
</ul>
<h3 id="fnsub"><a class="markdownIt-Anchor" href="#fnsub"></a> Fn::Sub</h3>
<ul>
<li>used to substitute variables from a text, it is a very handy function that will allow you to fully customize your templates</li>
<li>for example: you can combine Fn::Sub with references or AWS Pseudo variables</li>
<li>String must contain ${VariableName} and will substitute them</li>
</ul>
<h3 id="condition-functions"><a class="markdownIt-Anchor" href="#condition-functions"></a> Condition Functions</h3>
<ul>
<li>the logical ID is for you to choose, it is how you name condition</li>
</ul>
<h2 id="cloudformation-rollbacks"><a class="markdownIt-Anchor" href="#cloudformation-rollbacks"></a> CloudFormation rollbacks</h2>
<ul>
<li>stack creation fails
<ul>
<li>default: everything rolls back, we can look at the log</li>
<li>option to disable rollback and troubleshoot what happened</li>
</ul>
</li>
<li>stack update fails:
<ul>
<li>the stack automatically rolls back to the previous known working state</li>
<li>ability to see in the log     what happened and error messages</li>
</ul>
</li>
</ul>
<h2 id="changesets"><a class="markdownIt-Anchor" href="#changesets"></a> ChangeSets</h2>
<ul>
<li>when you update a stack, you need to know what changes before it happens for greater confidence</li>
<li>ChangeSets won’t say if the update will be successful</li>
</ul>
<h2 id="nested-stacks"><a class="markdownIt-Anchor" href="#nested-stacks"></a> Nested Stacks</h2>
<ul>
<li>stacks as part of other stacks</li>
<li>they allow you to isolate repeated patterns / common components in separate stacks and call them from other stacks</li>
<li>Example:
<ul>
<li>load balancer configuration that is re used</li>
<li>security group that is re used</li>
</ul>
</li>
<li>nested stacks are considered best practice</li>
<li>to update a nested stack, always update the parent (root stack)</li>
</ul>
<h3 id="cross-stack-vs-nested-stack"><a class="markdownIt-Anchor" href="#cross-stack-vs-nested-stack"></a> Cross stack vs nested stack</h3>
<ul>
<li>
<p>Cross stacks</p>
<ul>
<li>helpful when stacks have different lifecycles</li>
<li>use outputs export and Fn::ImportValue</li>
<li>when you need to pass export values to many stacks</li>
</ul>
</li>
<li>
<p>nested stacks</p>
<ul>
<li>helpful when components must be re used</li>
<li>example: re use how to properly configure an application load balancer</li>
<li>the nested stack only is important to the higher level stack</li>
</ul>
</li>
</ul>
<h2 id="stacksets"><a class="markdownIt-Anchor" href="#stacksets"></a> StackSets</h2>
<ul>
<li>create, update, or delete stacks across multiple accounts and regions with a single operation</li>
<li>administrator account to create StackSets</li>
<li>trusted accounts to create, update, delete stack instances from StackSets</li>
<li>when you update a stack set, all associated stack instances are updated throughout all accounts and regions</li>
</ul>
<h2 id="cloudformation-drift"><a class="markdownIt-Anchor" href="#cloudformation-drift"></a> CloudFormation drift</h2>
<ul>
<li>
<p>CloudFormation allows you to create infrastructure</p>
</li>
<li>
<p>but it doesn’t protect you against manual configuration changes</p>
</li>
<li>
<p>how do we know if our resources have drifted?</p>
</li>
<li>
<p>we can use CloudFormation drift</p>
</li>
</ul>
<h1 id="monitoring"><a class="markdownIt-Anchor" href="#monitoring"></a> Monitoring</h1>
<ul>
<li>AWS CloudWatch
<ul>
<li>metrics: collect and track key metrics</li>
<li>log: collect, monitor, analyze, and store log files</li>
<li>events: send notifications when certain events happen in your AWS</li>
<li>alarms: react in real-time to metrics / events</li>
</ul>
</li>
<li>X-Ray
<ul>
<li>troubleshooting application performance and errors</li>
<li>distrbuted tracing of microservices</li>
</ul>
</li>
<li>CloudTrail
<ul>
<li>internal monitoring of API calls being made</li>
<li>audit changes to AWS resources by your users</li>
</ul>
</li>
</ul>
<h2 id="cloudwatch-metrics"><a class="markdownIt-Anchor" href="#cloudwatch-metrics"></a> CLoudWatch metrics</h2>
<ul>
<li>CloudWatch provides metrics for every services in AWS</li>
<li>metric is a variable to monitor</li>
<li>metric belong to namespaces</li>
<li>dimension is an attribute of a metric</li>
<li>up to 10 dimensions per metric</li>
<li>metrics have timestamps</li>
<li>can create CloudWatch dashboards of metrics</li>
</ul>
<h3 id="detailed-monitoring"><a class="markdownIt-Anchor" href="#detailed-monitoring"></a> Detailed monitoring</h3>
<ul>
<li>EC2 instance metrics have metrics every 5 minutes</li>
<li>with detailed monitoring, you get data every 1 minute</li>
<li>use detailed monitoring if you want to scale faster for your ASG</li>
<li>the AWS free tier allows us to have 10 detailed monitoring metrics</li>
<li>NOTE: EC2 memory usage is by default not pushed (must be pushed from inside the instance as a custom metric)</li>
</ul>
<h2 id="cloudwatch-custom-metrics"><a class="markdownIt-Anchor" href="#cloudwatch-custom-metrics"></a> CloudWatch Custom metrics</h2>
<ul>
<li>possibility to define and send your own custom metrics to CloudWatch</li>
<li>example: RAM usage, disk space, number of logged in users</li>
<li>use API call PutMetricData</li>
<li>ability to use dimensions (attribute) to segment metrics
<ul>
<li>instance id</li>
<li>environment name</li>
</ul>
</li>
<li>matric resolution
<ul>
<li>standard: 60 seconds</li>
<li>high resolution: 1 / 5 / 10 / 30 seconds - higher cost</li>
</ul>
</li>
<li>important: the API accepts metric data points two weeks in the past and two hours in the future (make sure to configure your EC2 instance time correctly)</li>
</ul>
<h2 id="cloudwatch-logs"><a class="markdownIt-Anchor" href="#cloudwatch-logs"></a> CloudWatch logs</h2>
<ul>
<li>
<p>applicatoins can send logs to CloudWatch using the SDK</p>
</li>
<li>
<p>CLoudWatch can collect log from</p>
<ul>
<li>Elastic Beanstalk: collection of logs from application</li>
<li>ECS: colletion from containers</li>
<li>AWS lambda: collection from function logs</li>
<li>VPC flow logs: VPC specific logs</li>
<li>API gateway</li>
<li>CLoudTrail based on filter</li>
<li>CloudWatch log agents: for example on EC2 machines</li>
<li>route 53: log DNS queries</li>
</ul>
</li>
<li>
<p>cloudWatch logs can go to</p>
<ul>
<li>batch exporter to S3 for archival</li>
<li>stream to elasticSearch cluster for further analysis</li>
</ul>
</li>
<li>
<p>ClouWatch logs can use filter expressions</p>
</li>
<li>
<p>logs storage architecture</p>
<ul>
<li>log groups: arbitrary name, usually representing an application</li>
<li>log stream: instances within application / log files / containers</li>
</ul>
</li>
<li>
<p>can define log expiration policies (never, 30 days, etc…)</p>
</li>
<li>
<p>using the AWS CLI we can tail CloudWatch logs</p>
</li>
<li>
<p>to send logs to CloudWatch, make sure IAM permissions are correct</p>
</li>
<li>
<p>security: encryption of logs using KMS at the group level</p>
</li>
</ul>
<h2 id="cloudwatch-logs-for-ec2"><a class="markdownIt-Anchor" href="#cloudwatch-logs-for-ec2"></a> CloudWatch logs for EC2</h2>
<ul>
<li>by default, no logs from EC2 machine will go to CloudWatch</li>
<li>you need to run a CloudWatch agent on EC2 to push the log files you want</li>
<li>make sure IAM permissions are correct</li>
<li>the CLoudWatch log agent can be setup on premises too</li>
</ul>
<h3 id="cloudwatch-logs-agent-vs-unified-agent"><a class="markdownIt-Anchor" href="#cloudwatch-logs-agent-vs-unified-agent"></a> CloudWatch logs agent vs Unified agent</h3>
<ul>
<li>CloudWatch logs agent
<ul>
<li>old version of the agent</li>
<li>can only send to CloudWatch logs</li>
</ul>
</li>
<li>CloudWatch Unified agent
<ul>
<li>collect additional system level metrics such as RAM, processes, etc…</li>
<li>collect logs to send to CloudWatch logs</li>
<li>centralized configuration using SSM parameters store</li>
</ul>
</li>
</ul>
<h2 id="cloudwatch-logs-metric-filter"><a class="markdownIt-Anchor" href="#cloudwatch-logs-metric-filter"></a> CloudWatch logs metric filter</h2>
<ul>
<li>CloudWatch logs can use filter expressions
<ul>
<li>for exampe: find a specific IP inside of a log</li>
<li>or count occurrences of ERROR in your logs</li>
<li>metric filters can be used to trigger alarms</li>
</ul>
</li>
<li>filter do not retroactively filter data. (it doesn’t not filter historical data, only data since filter is created is counted).</li>
<li>filters only publish the metric data points for events that happen after the filter was created</li>
<li>can be integrated with CloudWatch alarms, SNS, etc…</li>
</ul>
<h2 id="cloudwatch-alarms"><a class="markdownIt-Anchor" href="#cloudwatch-alarms"></a> CloudWatch alarms</h2>
<ul>
<li>alarms are used to trigger notifications for any metric</li>
<li>various options</li>
<li>alarm states
<ul>
<li>OK</li>
<li>INSUFFICIETN_DATA</li>
<li>ALARM</li>
</ul>
</li>
<li>period
<ul>
<li>length of time in seconds to evaluate the metric</li>
<li>high resolution custom metrics: 10 sec, 30 sec or multiple of 60 sec</li>
</ul>
</li>
</ul>
<h3 id="cloudwatch-alarm-targets"><a class="markdownIt-Anchor" href="#cloudwatch-alarm-targets"></a> CloudWatch alarm targets</h3>
<ul>
<li>stop, terminate, reboot or recover EC2 instances</li>
<li>trigger auto scaling action</li>
<li>send notification to SNS</li>
</ul>
<h3 id="good-to-know"><a class="markdownIt-Anchor" href="#good-to-know"></a> good to know</h3>
<ul>
<li>alarms can be created based on CloudWatch logs metrics filters</li>
<li>to test alarms and notifications, you could set the alarm state using CLI</li>
</ul>
<h2 id="cloudwatch-events"><a class="markdownIt-Anchor" href="#cloudwatch-events"></a> CloudWatch Events</h2>
<ul>
<li>event pattern: intercept events from AWS service
<ul>
<li>EC2 instance state change, code build failure, S3…</li>
<li>can intercept any API call with CloudTrail integration</li>
</ul>
</li>
<li>schedule or Cron</li>
<li>A json payload is created from the event and passed to a target</li>
</ul>
<h2 id="cloudwatch-event-bridge"><a class="markdownIt-Anchor" href="#cloudwatch-event-bridge"></a> CloudWatch event bridge</h2>
<ul>
<li>EventBridge is the next evolution of CloudWatch events</li>
<li>default event bus: generated by AWS service</li>
<li>partner event bus: receive events from SaaS service or applications</li>
<li>custom event bus: for you own application</li>
<li>event buses can be accessed by other AWS accounts</li>
<li>rules: how to process the events (similar to CloudWatch event rules)</li>
</ul>
<h3 id="schema-registry"><a class="markdownIt-Anchor" href="#schema-registry"></a> Schema registry</h3>
<ul>
<li>eventBridge can analyze the events in your bus and infer the schema</li>
<li>the schema registry allows you to generate code for your application that will know in advance how data is structured in the event bus</li>
<li>schema can be versioned</li>
</ul>
<h2 id="amazon-eventbridge-vs-cloudwatch-events"><a class="markdownIt-Anchor" href="#amazon-eventbridge-vs-cloudwatch-events"></a> Amazon EventBridge vs CloudWatch events</h2>
<ul>
<li>EventBridge builds upon and extends CloudWatch events</li>
<li>it uses the same service API and endpoint, and the same underlying service infrastructure</li>
<li>EventBridge allows extension to add event buses for your custom applications and third party SaaS apps</li>
<li>EventBridge has the schema registry capability</li>
<li>EventBridge has a different name to mark the new capabilities</li>
<li>over time, the CloudWatch events name will be replaced with EventBridge</li>
</ul>
<h2 id="x-ray"><a class="markdownIt-Anchor" href="#x-ray"></a> X-Ray</h2>
<ul>
<li>debugging in Production, the old way
<ul>
<li>test locally</li>
<li>add log statements everywhere</li>
<li>re deploy in production</li>
</ul>
</li>
<li>log formats differ across applications using CLoudWatch and analytics is hard</li>
</ul>
<h3 id="x-ray-advantages"><a class="markdownIt-Anchor" href="#x-ray-advantages"></a> X-ray advantages</h3>
<ul>
<li>troubleshooting performance</li>
<li>understand dependencies in a microservices architecture</li>
<li>pinpoint service issues</li>
<li>review request behavior</li>
<li>find errors and exceptions</li>
</ul>
<h3 id="tracing"><a class="markdownIt-Anchor" href="#tracing"></a> tracing</h3>
<ul>
<li>tracing is an end to end way to following a request</li>
<li>each component dealing with the request adds its own trace</li>
<li>tracing is made of segments</li>
<li>annotations can be added to traces to provide extra information</li>
<li>ability to trace
<ul>
<li>every request</li>
<li>sample request (as a percentage for example or a rate per minute)</li>
</ul>
</li>
<li>X-Ray security
<ul>
<li>IAM for authorization</li>
</ul>
</li>
</ul>
<h3 id="how-to-enable"><a class="markdownIt-Anchor" href="#how-to-enable"></a> How to enable?</h3>
<ol>
<li>Your code must import the AWS X-Ray SDK</li>
</ol>
<ul>
<li>very little code modification needed</li>
<li>the application SDK will then capture
<ul>
<li>calls to AWS service</li>
<li>HTTP / HTTPS requests</li>
<li>database calls</li>
<li>queue calls</li>
</ul>
</li>
</ul>
<ol start="2">
<li>install X-Ray daemon or enable X-Ray AWS integration</li>
</ol>
<ul>
<li>X-Ray daemon works as a low level UDP packet interceptor</li>
<li>lambda / other AWS services already run the X-Ray daemon for you</li>
<li>each application must have the IAM rights to write data to X-Ray</li>
</ul>
<h3 id="x-ray-magic"><a class="markdownIt-Anchor" href="#x-ray-magic"></a> X-Ray magic</h3>
<ul>
<li>X-Ray service collects data from all the different services</li>
<li>service map is computed from all the segments and traces</li>
<li>X-Ray is graphical, so even non technical people can help troubleshoot</li>
</ul>
<h3 id="x-ray-troubleshooting"><a class="markdownIt-Anchor" href="#x-ray-troubleshooting"></a> X-Ray troubleshooting</h3>
<ul>
<li>if X-Ray is not working on EC2
<ul>
<li>ensure the EC2 IAM role has the proper permissions</li>
<li>ensure the EC2 instance is running the X-Ray daemon</li>
</ul>
</li>
<li>to enable on AWS lambda
<ul>
<li>ensure it has an IAM execution role with proper policy</li>
<li>ensure that X-Ray is imported in the code</li>
</ul>
</li>
</ul>
<h2 id="x-ray-instrumentation-and-concepts"><a class="markdownIt-Anchor" href="#x-ray-instrumentation-and-concepts"></a> X-Ray instrumentation and concepts</h2>
<ul>
<li>instrumentation means the measure of product’s performance, diagnose errors and to write trace information</li>
<li>to instrument your application code, you use the X-Ray SDK</li>
<li>many SDK require only configuration changes</li>
<li>you can modify your application code to customize and annotation the data that the SDK sends to X-Ray, using interceptors, filters, handlers, middleware…</li>
</ul>
<h3 id="x-ray-concepts"><a class="markdownIt-Anchor" href="#x-ray-concepts"></a> X-Ray concepts</h3>
<ul>
<li>segments: each application / service will send them</li>
<li>subsegments: if you need more details in your segment</li>
<li>trace: segments collected together to form an end to end trace</li>
<li>sampling: decrease the amount of requests sent to X-Ray, reduce cost</li>
<li>annotations: key value pairs used to index traces and use with filters</li>
<li>metadata: key value pairs, not indexed, not used for searching</li>
<li>the X-Ray daemon / agent has a config to send traces cross account
<ul>
<li>make sure the IAM permissions are correct - the agent will assume the role</li>
<li>this allows to have a central account for all your application tracing</li>
</ul>
</li>
</ul>
<h3 id="x-ray-sampling-rules"><a class="markdownIt-Anchor" href="#x-ray-sampling-rules"></a> X-Ray sampling rules</h3>
<ul>
<li>with sampling rules, you control the amount of data that you record</li>
<li>you can modify sampling rules without changing your code</li>
<li>by default, the X-Ray SDK records the first request each second, and five percent of any additional requests</li>
<li>one request per  second is the reservior, which requests that at least one trace is recorded each second as long the service is serving requests</li>
<li>Five percent is the rate, at which additional requests beyond the reservior size are sampled</li>
</ul>
<h2 id="x-ray-with-beanstalk"><a class="markdownIt-Anchor" href="#x-ray-with-beanstalk"></a> X-Ray with Beanstalk</h2>
<ul>
<li>Elastic Beanstalk platforms include the X-Ray daemon</li>
<li>you can run the daemon by setting an option in the Elastic Beanstalk console or with a configuration file (in .ebextension/xray-daemon.config)</li>
<li>make sure to give your instance profile the correct IAM permissions so that the X-Ray daemon can function correctly</li>
<li>then make sure your application code is intrumentated with the X-Ray SDK</li>
<li>note: the X-Ray daemon is not provided for multicontainer Docker</li>
</ul>
<h2 id="cloudtrail"><a class="markdownIt-Anchor" href="#cloudtrail"></a> CloudTrail</h2>
<ul>
<li>provides governance, compliance, and audit for your AWS account</li>
<li>CloudTrail is enabled by default</li>
<li>get an history of events / API calls made within your AWS accounts by
<ul>
<li>console</li>
<li>SDK</li>
<li>CLI</li>
<li>AWS services</li>
</ul>
</li>
<li>can put logs from CloudTrail into CLoudWatch logs or S3</li>
<li>a trail can be applied to All regions (default), or a single region</li>
<li>if a resource is deleted in AWS, investigate CloudTrail first</li>
</ul>
<h3 id="cloudtrail-events"><a class="markdownIt-Anchor" href="#cloudtrail-events"></a> CloudTrail events</h3>
<ul>
<li>management events
<ul>
<li>operations that are performed on resources in you account</li>
<li>examples
<ul>
<li>configuring security</li>
<li>configuring rules for routing data</li>
<li>setting up logging</li>
</ul>
</li>
<li>by default, trails are configured to log management events</li>
<li>can separate read events (that don’t modify resources) and write events (that may modify resources)</li>
</ul>
</li>
<li>data events
<ul>
<li>by default, data events are not logged (because high volume operations)</li>
<li>S3 object-level activity</li>
<li>can separate read and write events</li>
<li>lambda function execution activity</li>
</ul>
</li>
</ul>
<h3 id="cloudtrail-insights"><a class="markdownIt-Anchor" href="#cloudtrail-insights"></a> CloudTrail insights</h3>
<ul>
<li>enable CloudTrail insights to detect unusual activity in your account
<ul>
<li>inaccurate resource provisioning</li>
<li>hitting service limits</li>
<li>bursts of IAM actions</li>
<li>gaps in periodic maintenance activity</li>
</ul>
</li>
<li>CloudTrail insights analyzes normal management events to create a baseline</li>
<li>and then continuously analyzes write events to detect usuaual patterns
<ul>
<li>anomalies appear in the CloudTrail console</li>
<li>event is sent to S3</li>
<li>eventBridge is generated</li>
</ul>
</li>
</ul>
<h3 id="cloudtrail-events-retention"><a class="markdownIt-Anchor" href="#cloudtrail-events-retention"></a> CloudTrail events retention</h3>
<ul>
<li>events are stored for 90 days in CloudTrail</li>
<li>to keep events beyond this period, log them to S3 and use Athena</li>
</ul>
<h2 id="cloudtrail-vs-cloudwatch-vs-x-ray"><a class="markdownIt-Anchor" href="#cloudtrail-vs-cloudwatch-vs-x-ray"></a> CloudTrail vs CloudWatch vs X-Ray</h2>
<ul>
<li>CloudTrail
<ul>
<li>audit API calls made by users / services / AWS console</li>
<li>useful to detect unauthorized calls or root cause of changes</li>
</ul>
</li>
<li>CloudWatch
<ul>
<li>metrics over time for monitoring</li>
<li>logs for storing application log</li>
<li>alarms to send notifications in case of unexpected metrics</li>
</ul>
</li>
<li>X-Ray
<ul>
<li>automated trace analysis and central service map visualization</li>
<li>latency, errors and fault analysis</li>
<li>request tracking across distributed systems</li>
</ul>
</li>
</ul>
<h1 id="sqs"><a class="markdownIt-Anchor" href="#sqs"></a> SQS</h1>
<h2 id="communications-between-applications"><a class="markdownIt-Anchor" href="#communications-between-applications"></a> Communications between applications</h2>
<ul>
<li>Synchronous
<ul>
<li>synchronous between applications can be problematic if there are sudden spikes of traffic</li>
<li>what if you need to suddenly encode 1000 videos but usually it is 10?</li>
</ul>
</li>
<li>asynchronous
<ul>
<li>it is better to decouple your applications</li>
<li>SQS: queue model</li>
<li>SNS: pub/sub model</li>
<li>Kinesis: real time streaming model</li>
<li>these services can scale independently from our application</li>
</ul>
</li>
</ul>
<h2 id="sqs-standard-queue"><a class="markdownIt-Anchor" href="#sqs-standard-queue"></a> SQS - standard queue</h2>
<ul>
<li>fully managed service, used to decouple applications</li>
<li>attributes
<ul>
<li>unlimited throughput, unlimited number of messages in queue</li>
<li>default retention of messages: 4 to 14 days</li>
<li>law latency</li>
<li>limitation of 256 KB per message sent</li>
</ul>
</li>
<li>can have duplicate messages (at least once delivery, occasionally)</li>
<li>can have out of order messages (best effort ordering)</li>
</ul>
<h2 id="producing-messages"><a class="markdownIt-Anchor" href="#producing-messages"></a> Producing messages</h2>
<ul>
<li>produced to SQS using the SDK (SendMessage API)</li>
<li>the message is persisted in SQS until a consumer deletes it</li>
</ul>
<h2 id="comsuming-messages"><a class="markdownIt-Anchor" href="#comsuming-messages"></a> comsuming messages</h2>
<ul>
<li>consumers (running on EC2 instances, servers, or lambda)</li>
<li>poll SQS for messages (receive up to 10 messages at a time)</li>
<li>process the messages (example: insert the message into an RDS database)</li>
<li>delete the messages using the DeleteMessage API</li>
</ul>
<h2 id="multiple-ec2-instances-consumers"><a class="markdownIt-Anchor" href="#multiple-ec2-instances-consumers"></a> multiple EC2 instances consumers</h2>
<ul>
<li>consumers receive and process messages in parallel</li>
<li>at least once delivery</li>
<li>best effort message ordering</li>
<li>consumers delete messages after processing them</li>
<li>we can scale consumers horizontally to improve throughput of processing (using ASG)</li>
</ul>
<h2 id="security-3"><a class="markdownIt-Anchor" href="#security-3"></a> security</h2>
<ul>
<li>encryption
<ul>
<li>in flight encryption using HTTPS API</li>
<li>at rest encryption using KMS keys</li>
<li>client side encryption if the client wants to perform encryption / decryption itself</li>
</ul>
</li>
<li>access controls: IAM policies to regulate access to SQS API</li>
<li>SQS access policies: (similar to S3 bucket policies)
<ul>
<li>useful for cross account access to SQS queues</li>
<li>useful for allowing other services (SNS, S3…) to write to an SQS queue</li>
</ul>
</li>
</ul>
<h2 id="message-visibility-timeout"><a class="markdownIt-Anchor" href="#message-visibility-timeout"></a> message visibility timeout</h2>
<ul>
<li>
<p>after a message is polled by a consumer, it becomes invisible to other consumers</p>
</li>
<li>
<p>by default, the message visibility timeout is 30 seconds</p>
</li>
<li>
<p>that means the message has 30 seconds to be processed</p>
</li>
<li>
<p>after the message visibility timeout is over, the message is visible again in SQS</p>
</li>
<li>
<p>if a message is not processed within the visibility timeout, it will be received by consumer again so it will be processed twice</p>
</li>
<li>
<p>a consumer could call the ChangeMessageVisibility API to get more time</p>
</li>
<li>
<p>if visibility timeout is high, and consumer crashes, it will take longer time for the message to become visible in the queue and being consumed by others</p>
</li>
<li>
<p>if the visibility timeout is low, we may get duplicates</p>
</li>
</ul>
<h2 id="dead-letter-queue"><a class="markdownIt-Anchor" href="#dead-letter-queue"></a> Dead letter queue</h2>
<ul>
<li>if a consumer fails to process a message within the visibility timeout, the message goes back to the queue</li>
<li>we can set a threshold of how many times a message can go back to the queue</li>
<li>after the MaximumRecevies threshold is exceeded, the message goes into a dead letter queue</li>
<li>useful for debugging</li>
<li>make sure to process the messages in the DLQ before they expire
<ul>
<li>good to set a retention of 14 days in the DLQ</li>
</ul>
</li>
</ul>
<h2 id="delay-queue"><a class="markdownIt-Anchor" href="#delay-queue"></a> delay queue</h2>
<ul>
<li>delay a message (consumers don’t see it immediately) up to 15 minutes</li>
<li>default is 0 seconds (message is available right away)</li>
<li>can set a default at queue level</li>
<li>can override the default on send using the DelaySeconds parameter</li>
</ul>
<h2 id="long-polling"><a class="markdownIt-Anchor" href="#long-polling"></a> long polling</h2>
<ul>
<li>when a consumer requests messages from the queue, it can optionally wait for messages to arrive if there are none in the queue</li>
<li>this is called long polling</li>
<li>long polling decreases the number of API calls made to SQS while increasing the efficiency and latency of your application</li>
<li>the wait time can be between 1 to 20 seconds</li>
<li>long polling is preferable to short polling</li>
<li>long polling can be enabled at the queue level or at the API level using WaitTimeSeconds</li>
</ul>
<h2 id="sqs-extended-client"><a class="markdownIt-Anchor" href="#sqs-extended-client"></a> SQS extended client</h2>
<ul>
<li>message size limit is 256 KB, how to send large messages?</li>
<li>using the SQS extended client (Java Library)</li>
<li>it can be implemented using any language, it first uploads the large object to S3</li>
<li>then send the metadata of that object to SQS, once the consumer received the metadata, it will fetch the real object from S3.</li>
</ul>
<h2 id="fifo-queue"><a class="markdownIt-Anchor" href="#fifo-queue"></a> FIFO queue</h2>
<ul>
<li>First in first out</li>
<li>limited throughput: 300 messages / second, without batching, 3000 m/s with batching</li>
<li>exactly once send capability (by removing duplicates)</li>
<li>messages are processed in order by the consumer</li>
</ul>
<h3 id="fifo-deduplication"><a class="markdownIt-Anchor" href="#fifo-deduplication"></a> FIFO deduplication</h3>
<ul>
<li>deduplication interval is 5 minutes</li>
<li>two deduplication methods
<ul>
<li>content based deduplication: will do a SHA-256 hash of the message body</li>
<li>explicitly provide a message deduplication ID</li>
</ul>
</li>
<li>if the queue receives messages with the same hash key or the same deduplication ID, it will refuse to receive the message</li>
</ul>
<h3 id="message-grouping"><a class="markdownIt-Anchor" href="#message-grouping"></a> message grouping</h3>
<ul>
<li>if you specify the same value of MessageGroupID in an SQS FIFO queue, you can only have one consumer, and all the messages are in order</li>
<li>to get ordering at the level of a subset of messages, specify different values for MessageGroupID
<ul>
<li>messages that share a common message group ID will be in order within the group</li>
<li>each group ID can have a different consumer (parallel processing)</li>
<li>ordering across groups is not guaranteed</li>
</ul>
</li>
</ul>
<h1 id="sns"><a class="markdownIt-Anchor" href="#sns"></a> SNS</h1>
<ul>
<li>
<p>what if you want to send one message to many receivers?</p>
</li>
<li>
<p>the event producer only sends message to one SNS topic</p>
</li>
<li>
<p>as many event receivers as we want to listen to the SNS topic notifications</p>
</li>
<li>
<p>each subscriber to the topic will get all the messages (note: new feature to filter messages)</p>
</li>
<li>
<p>up to 10 million subscriptions per topic</p>
</li>
<li>
<p>100k topics limit</p>
</li>
<li>
<p>subscribers can be</p>
<ul>
<li>SQS</li>
<li>HTTP / HTTPS</li>
<li>lambda</li>
<li>emails</li>
<li>SMS messages</li>
<li>mobile notifications</li>
</ul>
</li>
<li>
<p>SNS integrates with a lot of AWS services</p>
<ul>
<li>many AWS services can send data directly to SNS for notifications</li>
<li>CloudWatch alarms</li>
<li>ASG notifications</li>
<li>S3</li>
<li>CloudFormation (upon state changes =&gt; failed to build etc…)</li>
</ul>
</li>
</ul>
<h2 id="how-to-publish"><a class="markdownIt-Anchor" href="#how-to-publish"></a> How to publish</h2>
<ul>
<li>topic publish (using the SDK)
<ul>
<li>create a topic</li>
<li>create a subscription</li>
<li>publish to the topic</li>
</ul>
</li>
<li>direct publish (for mobile apps SDK)
<ul>
<li>create a platform application</li>
<li>create a platform endpoint</li>
<li>publish to the platform endpoint</li>
<li>works with Google GCM, Apple APNS, Amazon ADM…</li>
</ul>
</li>
</ul>
<h2 id="security-4"><a class="markdownIt-Anchor" href="#security-4"></a> security</h2>
<ul>
<li>encryption
<ul>
<li>in flight encryption using HTTPS API</li>
<li>at rest encryption using KMS keys</li>
<li>client side encryption if the client wants to perform encryption / decryption itself</li>
</ul>
</li>
<li>access controls: IAM policies to regulate access to the SNS API</li>
<li>SNS access policies (similar to S3 bucket policies)
<ul>
<li>useful for cross account to SNS topic</li>
<li>useful for allowing other services to write to an SNS topic</li>
</ul>
</li>
</ul>
<h2 id="sns-sqs-fan-out"><a class="markdownIt-Anchor" href="#sns-sqs-fan-out"></a> SNS + SQS: Fan out</h2>
<ul>
<li>push once in SNS, receive in all SQS queues that are subscribers</li>
<li>fully decoupled, no data loss</li>
<li>SQS allows for: data persistence, delayed processing and retries of work</li>
<li>ability to add more SQS subscribers over time</li>
<li>make sure your SQS queue access policy allows for SNS to write</li>
</ul>
<h2 id="s3-events-to-multiple-queues"><a class="markdownIt-Anchor" href="#s3-events-to-multiple-queues"></a> S3 events to multiple queues</h2>
<ul>
<li>for the same combination of: event type and prefix, you can only have one S3 event rule</li>
<li>if you want to send the same S3 event to many SQS queues, use fanout (SNS + SQS)</li>
</ul>
<h2 id="sns-fifo"><a class="markdownIt-Anchor" href="#sns-fifo"></a> SNS - FIFO</h2>
<ul>
<li>similar features as SQS FIFO
<ul>
<li>ordering by message group ID</li>
<li>deduplication using a deduplication ID or Content based deduplication</li>
</ul>
</li>
<li>can only have SQS FIFO queues as subscribers</li>
<li>limited throughput (same throughput as SQS FIFO)</li>
</ul>
<h2 id="message-filtering"><a class="markdownIt-Anchor" href="#message-filtering"></a> message filtering</h2>
<ul>
<li>JSON policy used to filter messages sent to SNS topic’s subscriptions</li>
<li>if a subscription doesn’t have a filter policy, it receives every message</li>
</ul>
<h1 id="kinesis"><a class="markdownIt-Anchor" href="#kinesis"></a> Kinesis</h1>
<h2 id="kinesis-data-streams"><a class="markdownIt-Anchor" href="#kinesis-data-streams"></a> Kinesis data streams</h2>
<ul>
<li>billing is per shard provisioned, can have as many shards as you want</li>
<li>retention between 1 to 365 days</li>
<li>ability to reprocess data (because data will not be deleted by consumer, it stays in Kinesis data streams until retention period is over)</li>
<li>once data is inserted in Kinesis, it can’t be deleted (immutability)</li>
<li>data that shares the same partition goes to the same shard (shard level ordering)</li>
<li>producers: AWS SDK, Kinesis Producer Library (KPL), Kinesis agent</li>
<li>consumers
<ul>
<li>write your own: Kinesis Client Library (KCL), AWS SDK</li>
<li>managed: AWS lambda, Kinesis data firehose, Kinesis data analytics</li>
</ul>
</li>
</ul>
<h3 id="kinesis-data-streams-security"><a class="markdownIt-Anchor" href="#kinesis-data-streams-security"></a> Kinesis data streams security</h3>
<ul>
<li>control access / authorization using IAM policies</li>
<li>encryption in flight using HTTPS</li>
<li>encryption at rest using KMS</li>
<li>you can implement encryption / decryption of data on client side</li>
<li>VPC endpoints available for Kinesis to access within VPC (e.g. EC2 instance in private subnet access Kinesis data stream using VPC endpoint)</li>
<li>monitor API calls using CloudTrail</li>
</ul>
<h2 id="kinesis-consumers"><a class="markdownIt-Anchor" href="#kinesis-consumers"></a> Kinesis consumers</h2>
<h3 id="kinesis-consumer-types"><a class="markdownIt-Anchor" href="#kinesis-consumer-types"></a> Kinesis consumer types</h3>
<table>
<thead>
<tr>
<th>Shared fanout consumer - pull</th>
<th>enhanced fanout consumer - push</th>
</tr>
</thead>
<tbody>
<tr>
<td>low number of consuming applications</td>
<td>multiple consuming applications for the same stream</td>
</tr>
<tr>
<td>read throughput 2MB/ second per shard across all consumers</td>
<td>2 MB / second per consumer per shard</td>
</tr>
<tr>
<td>max 5 GetRecords API calls / sec</td>
<td>-</td>
</tr>
<tr>
<td>latency ~200ms</td>
<td>latency ~ 70ms</td>
</tr>
<tr>
<td>minimize cost</td>
<td>higher cost</td>
</tr>
<tr>
<td>consumers poll data from Kinesis using GetRecords API call</td>
<td>Kinesis push data to consumers over HTTP</td>
</tr>
<tr>
<td>returns up to 10MB or up to 10000 records</td>
<td>soft limit of 5 consumer applications per data stream</td>
</tr>
</tbody>
</table>
<h2 id="kinesis-client-library-kcl"><a class="markdownIt-Anchor" href="#kinesis-client-library-kcl"></a> Kinesis Client library (KCL)</h2>
<ul>
<li>a Java library that helps read record from a Kinesis Data Stream with distributed applications sharing the read workload</li>
<li>each shard is to be read by only one KCL instance
<ul>
<li>e.g. 4 shards =&gt; max 4 KCL instances</li>
</ul>
</li>
<li>progress is checkpointed into DynamoDB (needs IAM access from KCL instance to DynamoDB), this means if one KCL instance is down, DynamoDB will save the checkpoint and knows where to resume when KCL instance goes backup</li>
<li>track other workers and share the work amongst shards using DynamoDB</li>
<li>KCL can run on EC2, elastic Beanstalk and on premises</li>
<li>records are read in order at the shard level</li>
<li>versions
<ul>
<li>KCL 1.x (supports shared consumer)</li>
<li>KCL 2.x (supports shared and enhanced fanout consumer)</li>
</ul>
</li>
</ul>
<h2 id="kinesis-operations"><a class="markdownIt-Anchor" href="#kinesis-operations"></a> Kinesis operations</h2>
<h3 id="shard-splitting"><a class="markdownIt-Anchor" href="#shard-splitting"></a> Shard splitting</h3>
<ul>
<li>used to increase the Stream capacity</li>
<li>used to divide a hot shard</li>
<li>the old shard is closed and will be deleted once the data is expired (until the retention period is over)</li>
<li>no automatic scaling (manually increase / decrease capacity)</li>
<li>can’t split into more than two shards in a single operation</li>
</ul>
<h3 id="merging-shards"><a class="markdownIt-Anchor" href="#merging-shards"></a> merging shards</h3>
<ul>
<li>decrease the Stream capacity and save costs</li>
<li>can be used to group two shards with low traffic</li>
<li>old shards are closed and will be deleted once the data is expired</li>
<li>can’t merge more than two shards in a single operation</li>
</ul>
<h2 id="kinesis-data-firehose"><a class="markdownIt-Anchor" href="#kinesis-data-firehose"></a> Kinesis data firehose</h2>
<ul>
<li>fully managed service, no administration, automatic scaling, serverless
<ul>
<li>target: redshift, S3, ElasticSearch</li>
<li>third party</li>
<li>custom HTTP endpoint</li>
</ul>
</li>
<li>pay for data going through firehose</li>
<li>near real time
<ul>
<li>60 seconds latency minimum for non full batches</li>
<li>or minimum 32 MB of data at a time</li>
<li>it is not real time because it will batch the data into 60 seconds of data or 32MB of data</li>
</ul>
</li>
<li>supports many data formats, conversions, transformations, compression</li>
<li>supports custom data transformations using AWS lambda</li>
<li>can send failed or all data to a backup S3 bucket</li>
</ul>
<h3 id="kinesis-data-streams-vs-firehose"><a class="markdownIt-Anchor" href="#kinesis-data-streams-vs-firehose"></a> Kinesis data streams vs Firehose</h3>
<table>
<thead>
<tr>
<th>Kinesis data streams</th>
<th>Kinesis data firehose</th>
</tr>
</thead>
<tbody>
<tr>
<td>streaming service for ingest at scale</td>
<td>load streaming data into S3 / redshift / ElasticSearch / Thrid party / custom HTTP</td>
</tr>
<tr>
<td>write custom code (producer / consumer)</td>
<td>fully managed</td>
</tr>
<tr>
<td>real time (~200ms)</td>
<td>near real time (60 seconds or 32MB)</td>
</tr>
<tr>
<td>manage scaling (shard spliting / shard merging)</td>
<td>automatic scaling</td>
</tr>
<tr>
<td>data storage for 1 to 365 days</td>
<td>no data storage</td>
</tr>
<tr>
<td>supports replay capability</td>
<td>doesn’t support replay capability</td>
</tr>
</tbody>
</table>
<h2 id="kinesis-data-analytics-sql-application"><a class="markdownIt-Anchor" href="#kinesis-data-analytics-sql-application"></a> Kinesis data analytics (SQL application)</h2>
<ul>
<li>perform real time analytics on Kinesis streams using SQL</li>
<li>fully managed, no server to provision</li>
<li>automatic scaling</li>
<li>real time analytics</li>
<li>pay for actual consumption rate</li>
<li>can create streams out of the real time queries</li>
<li>use cases
<ul>
<li>time series analytics</li>
<li>real time dashboards</li>
<li>real time metrics</li>
</ul>
</li>
</ul>
<h2 id="sqs-vs-sns-vs-kinesis"><a class="markdownIt-Anchor" href="#sqs-vs-sns-vs-kinesis"></a> SQS vs SNS vs Kinesis</h2>
<h3 id="sqs-2"><a class="markdownIt-Anchor" href="#sqs-2"></a> SQS</h3>
<ul>
<li>consumer pull data</li>
<li>data is deleted after being consumed</li>
<li>can have as many as workers as we want</li>
<li>no need to provision throughput</li>
<li>ordering guarantees only on FIFO queues</li>
<li>individual message delay capability</li>
</ul>
<h3 id="sns-2"><a class="markdownIt-Anchor" href="#sns-2"></a> SNS</h3>
<ul>
<li>push data to many subscribers</li>
<li>data is not persisted (lost if not delivered)</li>
<li>pub/sub</li>
<li>no need to provision throughput</li>
<li>integrates with SQS for fanout architecture pattern</li>
<li>FIFO capability for SQS FIFO</li>
</ul>
<h3 id="kinesis-2"><a class="markdownIt-Anchor" href="#kinesis-2"></a> Kinesis</h3>
<ul>
<li>standard: pull data, 2 MB per shard</li>
<li>enhanced fanout: push data, 2 MB per shard per consumer</li>
<li>possibility to replay data</li>
<li>meant for real time big data, analytics and ETL</li>
<li>ordering at the shard level</li>
<li>data expires after X days</li>
<li>must provision throughput</li>
</ul>
<h2 id="kinesis-vs-sqs-ordering"><a class="markdownIt-Anchor" href="#kinesis-vs-sqs-ordering"></a> Kinesis vs SQS ordering</h2>
<ul>
<li>let’s assume 100 trucks, 5 kinesis shards, 1 SQS FIFO</li>
<li>Kinesis data streams
<ul>
<li>on average you will have 20 trucks per shard</li>
<li>trucks will have their data ordered within each shard</li>
<li>the maximum amount of consumer in parallel we can have is 5</li>
</ul>
</li>
<li>SQS FIFO
<ul>
<li>you only have one SQS FIFO queue</li>
<li>you will have 100 group ID</li>
<li>you can have up to 100 consumers (due to the 100 group ID)</li>
<li>you have up to 300 message per second (or 3000 if using batching, because one GetRecords API call can receive up to 10 messages)</li>
</ul>
</li>
</ul>
<h1 id="lambda"><a class="markdownIt-Anchor" href="#lambda"></a> Lambda</h1>
<h2 id="what-is-serverless"><a class="markdownIt-Anchor" href="#what-is-serverless"></a> what is serverless</h2>
<ul>
<li>serverless is a new paradigm in which the developers don’t have to manage servers anymore</li>
<li>they just deploy code</li>
<li>serverless was pioneered by AWS lambda but now also includes anything that is managed: databases, messaging, storage, etc…</li>
<li>serverless does not mean there are no servers, it means you just don’t manage / provision / see them</li>
</ul>
<h3 id="serverless-in-aws"><a class="markdownIt-Anchor" href="#serverless-in-aws"></a> serverless in AWS</h3>
<ul>
<li>lambda</li>
<li>DynamoDB</li>
<li>Cognito</li>
<li>API Gateway</li>
<li>S3</li>
<li>SNS and SQS</li>
<li>Kinesis data firehose</li>
<li>Aurora serverless</li>
<li>Step functions</li>
<li>Fargate</li>
</ul>
<h2 id="lambda-synchronous-invocations"><a class="markdownIt-Anchor" href="#lambda-synchronous-invocations"></a> Lambda synchronous invocations</h2>
<ul>
<li>synchronous: CLI, SDK, API Gateway, ALB
<ul>
<li>results is returned right away</li>
<li>error handling must happen client side</li>
</ul>
</li>
</ul>
<h2 id="lambda-integration-with-alb"><a class="markdownIt-Anchor" href="#lambda-integration-with-alb"></a> lambda integration with ALB</h2>
<ul>
<li>to expose a lambda function as an HTTP endpoint</li>
<li>you can use the ALB or an API gateway</li>
<li>the lambda function must be registered in a target group</li>
<li>ALB will convert the request HTTP to JSON and convert the response JSON to HTTP</li>
</ul>
<h3 id="alb-multi-healer-values"><a class="markdownIt-Anchor" href="#alb-multi-healer-values"></a> ALB multi healer values</h3>
<ul>
<li>ALB can support multi header values</li>
<li>when you enable multi value headers, HTTP headers and query string parametersthat are sent with multiple values are shown as arrays within the AWS lambda event and response objects</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">HTTP</span><br><span class="line">http:&#x2F;&#x2F;example.com&#x2F;path?name&#x3D;foo&amp;name&#x3D;bar</span><br><span class="line"></span><br><span class="line">JSON</span><br><span class="line">&quot;queryStringParameters&quot;:&#123;&quot;name&quot;:[&quot;foo&quot;, &quot;bar&quot;]&#125;</span><br></pre></td></tr></table></figure>
<h2 id="lambdaedge"><a class="markdownIt-Anchor" href="#lambdaedge"></a> lambda@Edge</h2>
<ul>
<li>
<p>you have deployed a CDN using CloudFront</p>
</li>
<li>
<p>what if you wanted to run a global lambda alongside?</p>
</li>
<li>
<p>or how to implement request filtering before reaching your application?</p>
</li>
<li>
<p>for this, you can use Lambda@edge, deploy lambda functions alongside your CloudFront CDN</p>
<ul>
<li>build more responsive applications</li>
<li>you don’t manage servers, lambda is deployed globally</li>
<li>customize the CDN content</li>
<li>pay only for what you use</li>
</ul>
</li>
<li>
<p>you can use lambda to change CloudFront requests and responses</p>
<ul>
<li>after CloudFront receives a request from a viewer</li>
<li>before CloudFront forwards the request to the origin</li>
<li>after CloudFront receives the response from the origin</li>
<li>before CloudFront forwards the response to the viewer</li>
</ul>
</li>
<li>
<p>you can also generate responses to viewers without ever sending the request to the origin</p>
</li>
</ul>
<h2 id="lambda-asynchronous-invocations"><a class="markdownIt-Anchor" href="#lambda-asynchronous-invocations"></a> lambda - asynchronous invocations</h2>
<ul>
<li>S3, SNS, CloudWatch events</li>
<li>the events are placed in an event queue</li>
<li>lambda attempts to retry on errors
<ul>
<li>3 tries total</li>
<li>1 minute after first, then 2 minutes wait</li>
</ul>
</li>
<li>make sure the processing is idempotent (result is the same after retry)</li>
<li>if the function is retried, you will see duplicate logs entries in CloudWatch logs</li>
<li>can define a DLQ - SNS or SQS - for failed processing (need correct IAM permissions for lambda to write to SQS)</li>
<li>asynchronous invocations allow you to speed up the processing if you don’t need to wait for the result</li>
</ul>
<h2 id="lambda-event-source-mapping"><a class="markdownIt-Anchor" href="#lambda-event-source-mapping"></a> lambda event source mapping</h2>
<ul>
<li>Kinesis data Streams and DynamoDB Streams</li>
<li>SQS and SQS FIFO queue</li>
<li>common denominator: records need to be pulled from the source</li>
<li>your lambda function is invoked synchronously</li>
</ul>
<h3 id="streams-and-lambda-kinesis-and-dynamodb"><a class="markdownIt-Anchor" href="#streams-and-lambda-kinesis-and-dynamodb"></a> Streams and lambda (Kinesis and DynamoDB)</h3>
<ul>
<li>an event source mapping creates an iterator for each shard, processes items in order</li>
<li>start with new items, from the beginning or from timestamp</li>
<li>processed items aren’t removed from the stream (other consumers can read them again)</li>
<li>if traffic is low, we can use batch window to accumulate records before processing</li>
<li>you can process multiple batches in parallel
<ul>
<li>up to 10 batches per shard</li>
<li>in order processing is still guaranteed for each partition key</li>
</ul>
</li>
</ul>
<h3 id="streams-and-lambda-error-handling"><a class="markdownIt-Anchor" href="#streams-and-lambda-error-handling"></a> Streams and lambda - error handling</h3>
<ul>
<li>by default, if your function returns an error, the entire batch is reprocessed until the function succeeds, or the items in the batch expire</li>
<li>to ensure in order processing, processing for the affected shard is paused until the error is resolved</li>
<li>you can configure the event source mapping to
<ul>
<li>discard old events</li>
<li>restrict the number of retries</li>
<li>split the batch on error (to work around lambda timeout issue, maybe there is not enough time to process the whole batch, so we split the batch to make it small and faster to process)</li>
</ul>
</li>
<li>discarded events can go to a Destination</li>
</ul>
<h3 id="sqs-and-sqs-fifo-with-lambda"><a class="markdownIt-Anchor" href="#sqs-and-sqs-fifo-with-lambda"></a> SQS and SQS FIFO with lambda</h3>
<ul>
<li>
<p>event source mapping will pull SQS (long polling)</p>
</li>
<li>
<p>specify batch size (1 to 10 messages)</p>
</li>
<li>
<p>recommended: set the queue visibility timeout to 6x the timeout of your lambda function</p>
</li>
<li>
<p>to use a DLQ:</p>
<ul>
<li>setup on the SQS queue, not lambda (DLQ for lambda is only for async invocations)</li>
<li>or use a lambda Destination for failures</li>
</ul>
</li>
<li>
<p>lambda also supports in order processing for FIFO queues, scaling up to the number of active message groups</p>
</li>
<li>
<p>for standard queues, items aren’t necessarily processed in order</p>
</li>
<li>
<p>lambda scales up to process a standard queue as quickly as possible</p>
</li>
<li>
<p>when an error occurs, batches are returned to the queue as individual items and might be processed in a different grouping than the original batch</p>
</li>
<li>
<p>occasionally, the event source mapping receive the same item from the queue twice, even if no function error occurred</p>
</li>
<li>
<p>lambda deletes items from the queue after they are processed successfully</p>
</li>
<li>
<p>you can configure the source queue to send items to a DLQ if they can’t be processed</p>
</li>
</ul>
<h3 id="lambda-event-mapper-scaling"><a class="markdownIt-Anchor" href="#lambda-event-mapper-scaling"></a> lambda event mapper scaling</h3>
<ul>
<li>Kinesis data streams and DynamoDB streams
<ul>
<li>one lambda invocation per stream shard</li>
<li>if you use parallelization, up to 10 batches processed per shard simultaneously</li>
</ul>
</li>
<li>SQS standard
<ul>
<li>lambda adds 60 more instances per minute to scale up</li>
<li>up to 1000 batches of messages processed simultaneously</li>
</ul>
</li>
<li>SQS FIFO
<ul>
<li>messages with the same group ID will be processed in order</li>
<li>the lambda function scales to the number of active message groups</li>
</ul>
</li>
</ul>
<h2 id="lambda-destinations"><a class="markdownIt-Anchor" href="#lambda-destinations"></a> lambda - Destinations</h2>
<ul>
<li>for asynchronous invocations, we can define destinations for successful and failed event
<ul>
<li>SQS</li>
<li>SNS</li>
<li>lambda</li>
<li>EventBridge bus</li>
</ul>
</li>
<li>note: AWS recommends you use Destinations instead of DLQ now (but both can be used at the same time)</li>
</ul>
<h2 id="lambda-permissions-iam-roles-and-resource-policies"><a class="markdownIt-Anchor" href="#lambda-permissions-iam-roles-and-resource-policies"></a> lambda permissions - IAM roles and resource policies</h2>
<ul>
<li>lambda execution role
<ul>
<li>grants the lambda function permissions to AWS services / resources</li>
<li>when you use an event source mapping to invoke your function, lambda uses the execution role to read event data (e.g. lambda need permission to pull messages from SQS)</li>
</ul>
</li>
<li>lambda resource based policies
<ul>
<li>use resource based policies to give other accounts and AWS services permission to use your lambda resources</li>
<li>similar to S3 bucket policies for S3 bucket</li>
<li>an IAM principal can access lambda
<ul>
<li>if the IAM policy attached to the principal authorizes it (user access)</li>
<li>or if the resource based policy authorizes (service access)</li>
</ul>
</li>
<li>when an AWS service like S3 calls your lambda function, the resource based policy gives it access</li>
</ul>
</li>
</ul>
<h2 id="lambda-environment-variables"><a class="markdownIt-Anchor" href="#lambda-environment-variables"></a> lambda environment variables</h2>
<ul>
<li>environment variable = key / value pair in string form</li>
<li>adjust the function behavior without updating code</li>
<li>the environment variable are available to your code</li>
<li>lambda service adds its own system environment variables as well</li>
<li>helpful to store secrets (encrypted by KMS)</li>
<li>secrets can be encrypted by the lambda service key, or your own CMK</li>
</ul>
<h2 id="lambda-logging-and-monitoring"><a class="markdownIt-Anchor" href="#lambda-logging-and-monitoring"></a> lambda logging and monitoring</h2>
<ul>
<li>CLoudWatch logs
<ul>
<li>lambda execution logs are stored in AWS CloudWatch logs</li>
<li>make sure your AWS lambda function has an execution role with an IAM policy that authorizes writes to CloudWatch logs</li>
</ul>
</li>
<li>CLoudWatch metrics
<ul>
<li>lambda metrics are displayed in AWS CloudWatch metrics</li>
<li>invocations, Durations, concurrent executions</li>
<li>error count, success rates, throttles</li>
<li>async delivery failures</li>
<li>iterator age (lagging for Kinesis and DynamoDB streams)</li>
</ul>
</li>
</ul>
<h3 id="lambda-tracing-with-x-ray"><a class="markdownIt-Anchor" href="#lambda-tracing-with-x-ray"></a> lambda tracing with X-Ray</h3>
<ul>
<li>enable in lambda configuration (active tracing)</li>
<li>runs the X-Ray daemon for you</li>
<li>use AWS X-Ray SDK in code</li>
<li>ensure lambda function has a correct IAM execution role to write to X-Ray
<ul>
<li>the managed policy is called: <code>AWSXRayDaemonWriteAccess</code></li>
</ul>
</li>
</ul>
<h2 id="lambda-in-vpc"><a class="markdownIt-Anchor" href="#lambda-in-vpc"></a> lambda in VPC</h2>
<h3 id="lambda-by-default"><a class="markdownIt-Anchor" href="#lambda-by-default"></a> lambda by default</h3>
<ul>
<li>by default, your lambda function is launched outside your own VPC (in an AWS owned VPC)</li>
<li>therefore it cannot access resources in your VPC</li>
</ul>
<h3 id="lambda-in-vpc-2"><a class="markdownIt-Anchor" href="#lambda-in-vpc-2"></a> lambda in VPC</h3>
<ul>
<li>you must define the VPC ID, the subnets and the security groups</li>
<li>lambda will create an ENI in your subnets</li>
<li>lambda needs <code>AWSLambdaVPCAccessExecutionRole</code></li>
</ul>
<h3 id="internet-access"><a class="markdownIt-Anchor" href="#internet-access"></a> internet access</h3>
<ul>
<li>a lambda function in your VPC does not have internet access</li>
<li>deploying a lambda function in a public subnet does not give it internet access or a public IP</li>
<li>deploying a lambda function in a private subnet gives it internet access if you have a NAT gateway / NAT instance</li>
<li>you can use VPC endpoints to privately access AWS services without a NAT</li>
</ul>
<h2 id="lambda-function-performance"><a class="markdownIt-Anchor" href="#lambda-function-performance"></a> lambda function performance</h2>
<h3 id="configuration"><a class="markdownIt-Anchor" href="#configuration"></a> configuration</h3>
<ul>
<li>RAM
<ul>
<li>from 128MB to 3008MB in 64MB increments</li>
<li>the more RAM you add, the more vCPU credits you get</li>
<li>at 1792MB, a function has the equivalent of one full vCPU</li>
<li>after 1792MB, you get more than one CPU, and need to use multi threading in your code to benefit from it</li>
</ul>
</li>
<li>if your application is CPU-bound (computation heavy), increase RAM</li>
<li>timeout: default 3 seconds, maximum is 900 seconds</li>
</ul>
<h3 id="lambda-execution-context"><a class="markdownIt-Anchor" href="#lambda-execution-context"></a> lambda execution context</h3>
<ul>
<li>the execution context is a temporary runtime environment that initialize any external dependencies of your lambda code</li>
<li>great for database connections, HTTP clients, SDK clients…</li>
<li>the execution context is maintained for some time in anticipation of another lambda function invocation</li>
<li>the next function invocation can reuse the context to execution time and save time in initializing connections objects (e.g. establish database connection outside of function handler)</li>
<li>the execution context includes the <code>/tmp</code> directory</li>
</ul>
<h3 id="lambda-function-tmp-space"><a class="markdownIt-Anchor" href="#lambda-function-tmp-space"></a> lambda function <code>/tmp</code> space</h3>
<ul>
<li>if your lambda function needs to download a big file to work</li>
<li>if your lambda function needs disk space to perform operations</li>
<li>you can use the <code>/tmp</code> directory</li>
<li>max size is 512 MB</li>
<li>the directory content remains when the execution context is frozen, providing transient cache that can be used for multiple invocations (helpful to checkpoint your work)</li>
<li>for permanent persistence of object, use S3</li>
</ul>
<h2 id="lambda-concurrency"><a class="markdownIt-Anchor" href="#lambda-concurrency"></a> lambda concurrency</h2>
<ul>
<li>concurrency limit: up to 1000 concurrent executions across entire account, so if one of your lambda function takes up all the concurrencies (if you didn’t setup reserved concurrency limit), the other lambda functions will be throttled.</li>
<li>can set a reserved concurrency at the function level</li>
<li>each invocation over the concurrency limit will trigger a throttle</li>
<li>throttle behavior</li>
<li>if synchronous invocation = return throttle error 429</li>
<li>if asynchronous invocation = retry automatically and then go to DLQ</li>
<li>if you need a higher limit, open a support ticket</li>
</ul>
<h3 id="lambda-concurrency-and-asynchronous-invocations"><a class="markdownIt-Anchor" href="#lambda-concurrency-and-asynchronous-invocations"></a> lambda concurrency and asynchronous invocations</h3>
<ul>
<li>if the function doesn’t have enough concurrency available to process all events, additional requests are throttled</li>
<li>for throttling errors and system errors, lambda returns the event to the queue and attempts to run the funtion again for up to 6 hours</li>
<li>the retry interval increases exponentially from 1 second after the first attempt to a maximum of 5 minutes</li>
</ul>
<h3 id="cold-start-and-provisioned-concurrency"><a class="markdownIt-Anchor" href="#cold-start-and-provisioned-concurrency"></a> Cold start and provisioned concurrency</h3>
<ul>
<li>cold start
<ul>
<li>new instance =&gt; code is loaded and code outside the handler run (init)</li>
<li>if the init is large, this process can take some time</li>
<li>first request served by new instances has higher latency than the rest</li>
</ul>
</li>
<li>provisioned concurrency
<ul>
<li>concurrency is allocated before the function is invoked (in advance)</li>
<li>so the cold start never happens and all invocations have low latency</li>
<li>application auto scaling can manage concurrency</li>
</ul>
</li>
</ul>
<h2 id="lambda-external-dependencies"><a class="markdownIt-Anchor" href="#lambda-external-dependencies"></a> lambda external dependencies</h2>
<ul>
<li>if your lambda function depends on external libraries
<ul>
<li>for example AWS X-Ray SDK, database client, etc…</li>
</ul>
</li>
<li>you need to install the packages alongside your code and zip it together</li>
<li>upload the zip straight to lambda if less than 50MB, else to S3 first and reference from S3</li>
<li>native libraries work: they need to be complied on Amazon Linux</li>
<li>AWS SDK comes by default with every lambda function</li>
</ul>
<h2 id="lambda-and-cloudformation"><a class="markdownIt-Anchor" href="#lambda-and-cloudformation"></a> lambda and CloudFormation</h2>
<h3 id="inline"><a class="markdownIt-Anchor" href="#inline"></a> inline</h3>
<ul>
<li>inline functions are very simple</li>
<li>use the code.zipfile property</li>
<li>you cannot include function dependencies with inline functions</li>
</ul>
<h3 id="through-s3"><a class="markdownIt-Anchor" href="#through-s3"></a> through S3</h3>
<ul>
<li>you must store the lambda zip in S3</li>
<li>you must refer the S3 zip location in the CloudFormation code
<ul>
<li>S3 bucket</li>
<li>S3 key: full path to zip</li>
<li>S3 object version: if versioned bucket</li>
</ul>
</li>
<li>if you update the code in S3, but don’t update S3 bucket, S3 key or S3 object version, CloudFormation won’t update your function because it will not detect the change</li>
</ul>
<h2 id="lambda-layers"><a class="markdownIt-Anchor" href="#lambda-layers"></a> lambda layers</h2>
<ul>
<li>externalize dependencies to re use them</li>
</ul>
<h2 id="lambda-container-images"><a class="markdownIt-Anchor" href="#lambda-container-images"></a> lambda container images</h2>
<ul>
<li>deploy lambda function as container images of up to 10GB from ECR</li>
<li>pack complex dependencies, large dependencies in a container</li>
<li>base images are available</li>
<li>can create your own image as long as it implements the lambda runtime API</li>
<li>test the containers locally using the lambda runtime interface emulator</li>
<li>unified workflow to build apps</li>
</ul>
<h2 id="lambda-versions-and-aliases"><a class="markdownIt-Anchor" href="#lambda-versions-and-aliases"></a> lambda versions and aliases</h2>
<h3 id="lambda-versions"><a class="markdownIt-Anchor" href="#lambda-versions"></a> lambda versions</h3>
<ul>
<li>when you work on a lambda function, we work on <code>$LATEST</code>, which is an unpublished mutable version</li>
<li>when we are ready to publish a lambda function, we create a version</li>
<li>versions are immutable</li>
<li>versions have increasing version numbers</li>
<li>versions get their own ARN</li>
<li>version = code + configuration</li>
<li>each version of the lambda function can be accessed</li>
</ul>
<h3 id="lambda-aliases"><a class="markdownIt-Anchor" href="#lambda-aliases"></a> lambda aliases</h3>
<ul>
<li>aliases are pointers to lambda function versions</li>
<li>we can define a dev, test, prod aliases and have them point at different lambda versions</li>
<li>aliases are mutable</li>
<li>aliases enable Blue / Green deployment by assigning weights to lambda functions</li>
<li>aliases enable stable configuration of our event triggers / destinations</li>
<li>aliases have their own ARNs</li>
<li>aliases cannot reference other aliases</li>
</ul>
<h2 id="lambda-and-codedeploy"><a class="markdownIt-Anchor" href="#lambda-and-codedeploy"></a> lambda and CodeDeploy</h2>
<ul>
<li>CodeDeploy can help you automate traffic shift for lambda aliases</li>
<li>feature is integrated within the SAM framework</li>
<li>linear
<ul>
<li>grow traffic every N minutes until 100%</li>
</ul>
</li>
<li>canary
<ul>
<li>try X percent then 100%</li>
</ul>
</li>
<li>AllAtOnce
<ul>
<li>immediate</li>
</ul>
</li>
<li>can create pre and post traffic hooks to check the health of the lambda function</li>
</ul>
<h2 id="lambda-limits-good-to-know-per-region"><a class="markdownIt-Anchor" href="#lambda-limits-good-to-know-per-region"></a> lambda limits good to know - per region</h2>
<ul>
<li>memory allocation: 128MB - 10 GB</li>
<li>maximum execution time: 15 minutes</li>
<li>environment variables: 4KB</li>
<li>disk capacity in the function container in <code>/tmp</code>: 512 MB</li>
<li>concurrency executions: 1000</li>
<li>lambda function deployment size(zipped): 50MB</li>
<li>size of uncompressed deployment(code + dependencies): 250MB</li>
<li>can use the <code>/tmp</code> directory to load other files at startup</li>
</ul>
<h2 id="lambda-best-practices"><a class="markdownIt-Anchor" href="#lambda-best-practices"></a> lambda best practices</h2>
<ul>
<li>perform heavy duty work outside of your function handler
<ul>
<li>connect to databases</li>
<li>initilize the SDK</li>
<li>pull in dependencies</li>
</ul>
</li>
<li>use environment variables for
<ul>
<li>database connection sttrings, S3 buckets, etc…</li>
<li>passwords, sensitive values</li>
</ul>
</li>
<li>minimize your deployment package size to its runtime necessities
<ul>
<li>break down the function</li>
<li>remember lambda limits</li>
<li>use Layers where necessary</li>
</ul>
</li>
<li>aviod using recursive code, never have a lambda function call itself</li>
</ul>
<h1 id="dynamodb"><a class="markdownIt-Anchor" href="#dynamodb"></a> DynamoDB</h1>
<h2 id="nosql-database"><a class="markdownIt-Anchor" href="#nosql-database"></a> NoSQL database</h2>
<ul>
<li>non-relational databases and are distributed</li>
<li>include MongoDB, DynamoDB…</li>
<li>do not support query joins (or just limited support)</li>
<li>all the data that is needed for a query is present in one row</li>
<li>don’t perform aggregations such as SUM, AVG…</li>
<li>scale horizontally</li>
<li>there is no right or wrong for NoSQL or SQL, they just require to model the data differently and think about user queries differently</li>
</ul>
<h2 id="amazon-dynamodb"><a class="markdownIt-Anchor" href="#amazon-dynamodb"></a> Amazon DynamoDB</h2>
<ul>
<li>fully managed, highly available with replication across multiple AZ</li>
<li>NoSQL database</li>
<li>scales to massive workloads, distributed database</li>
<li>millions of requests per second, trillions of row, 100s of TB of storage</li>
<li>fast and consistent in performance (low latency on retrieval)</li>
<li>integrated with IAM for security, authorization and administration</li>
<li>enables event driven programming with DynamoDB streams</li>
<li>low cost and auto scaling capabilities</li>
</ul>
<h2 id="basics"><a class="markdownIt-Anchor" href="#basics"></a> basics</h2>
<ul>
<li>
<p>DynamoDB is made of Tables</p>
</li>
<li>
<p>each table has a Primary Key (must be decided at creation time)</p>
</li>
<li>
<p>each table can have an infinite number of items</p>
</li>
<li>
<p>each item has attributes (can be added over time - can be null)</p>
</li>
<li>
<p>maximum size of an item is 400KB</p>
</li>
<li>
<p>data types supported are:</p>
<ul>
<li>scalar types: String, Number, Binary, Boolean, Null</li>
<li>Document types: List, Map</li>
<li>Set Types: String Set, Number Set, Binary Set</li>
</ul>
</li>
<li>
<p>Primary keys</p>
<ul>
<li>Partition Key (HASH)
<ul>
<li>partition key must be unique for each item</li>
<li>partition key must be diverse so that the data is distributed</li>
</ul>
</li>
<li>Partition Key + Sort Key (HASH + RANGE)
<ul>
<li>the combination must be unique for each item</li>
<li>data is grouped by partition key</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="read-write-capacity-modes"><a class="markdownIt-Anchor" href="#read-write-capacity-modes"></a> Read / Write capacity modes</h2>
<ul>
<li>control how you manage your table’s capacity</li>
<li>provisioned mode (default)
<ul>
<li>you specify the number of reads/ writes per second</li>
<li>you need to plan capacity beforehand</li>
<li>pay for provisioned read / write capacity units</li>
</ul>
</li>
<li>on demand mode
<ul>
<li>read / writes automatically scale up / down with your workloads</li>
<li>no capacity planning needed</li>
<li>pay for what you use, more expensive</li>
</ul>
</li>
<li>you can switch between different modes once every 24 hours</li>
</ul>
<h2 id="rw-capacity-modes-provisioned"><a class="markdownIt-Anchor" href="#rw-capacity-modes-provisioned"></a> R/W capacity modes - provisioned</h2>
<ul>
<li>table must have provisioned read an dwrite capacity units</li>
<li>read capacity units (RCU)</li>
<li>write capacity units</li>
<li>option to setup auto scaling of throughput to meet demand</li>
<li>throughput can be exceeded temporarily using brust capacity</li>
<li>if burst capacity has been consumed, you will get a <code>ProvisionedThroughpuutExceededException</code></li>
<li>it is then advised to do an exponential backoff retry</li>
</ul>
<h2 id="write-capacity-units-wcu"><a class="markdownIt-Anchor" href="#write-capacity-units-wcu"></a> Write Capacity units (WCU)</h2>
<ul>
<li>one WCU represents one write per second for an item up to 1KB in size</li>
<li>if the items are larget then 1 KB, more WCUs are consumed</li>
</ul>
<h2 id="strongly-consistent-read-vs-eventually-consistent-read"><a class="markdownIt-Anchor" href="#strongly-consistent-read-vs-eventually-consistent-read"></a> Strongly consistent read vs Eventually consistent read</h2>
<ul>
<li>Eventually consistent read (default)
<ul>
<li>if we read just after a write, it is possible we will get some stale data because of replication</li>
</ul>
</li>
<li>Strongly consistent read
<ul>
<li>if we read just after a write, we will get the correct data</li>
<li>set ConsistentRead parameter to True in API calls</li>
<li>consumes twice the RCU</li>
</ul>
</li>
</ul>
<h2 id="read-capacity-units-rcu"><a class="markdownIt-Anchor" href="#read-capacity-units-rcu"></a> Read capacity units (RCU)</h2>
<ul>
<li>one RCU represents one Strongly Consistent Read per second, or two Eventually consistent reads per second, for an item up to 4KB</li>
<li>if the items are larger than 4KB, more RCUs are consumed</li>
</ul>
<h2 id="paritions-internal"><a class="markdownIt-Anchor" href="#paritions-internal"></a> Paritions Internal</h2>
<ul>
<li>data is stored in partitions</li>
<li>partition keys go through a hashing algorithm to know to which partition they go to</li>
<li>WCUs and RCUs are spread evenly across partitions</li>
</ul>
<h2 id="throttling"><a class="markdownIt-Anchor" href="#throttling"></a> Throttling</h2>
<ul>
<li>if we exceed provisioned RCUs or WCUs, we get <code>ProvisionedThroughputExceededException</code></li>
<li>reasons
<ul>
<li>hot keys: one partition key is being read too many times (popular item)</li>
<li>hot partitions</li>
<li>very large items, remember RCU and WCU depends on size of items</li>
</ul>
</li>
<li>solutions
<ul>
<li>exponential backoff when exception is encountered</li>
<li>distribute partition keys as much as possible</li>
<li>if RCU issue, we can use DynamoDB Accelerator (DAX)</li>
</ul>
</li>
</ul>
<h2 id="on-demand"><a class="markdownIt-Anchor" href="#on-demand"></a> on demand</h2>
<ul>
<li>Read and writes automatically scale up and down with your workloads</li>
<li>no capacity planning needed</li>
<li>unlimited WCU and RCU, no throttle, more expensive</li>
<li>you are charged for reads and writes that you use in terms of RRU and WRU</li>
<li>read request units (RRU) - throughput for reads (same as RCU)</li>
<li>write request units (WRU) - throughput for writes (same as WCU)</li>
<li>2.5x more expensive than provisioned capacity</li>
<li>use cases: unknown workloads, unpredictable application traffic…</li>
</ul>
<h2 id="writing-data"><a class="markdownIt-Anchor" href="#writing-data"></a> writing data</h2>
<ul>
<li>PutItem
<ul>
<li>creates a new item or fully replace an old item</li>
<li>consumers WCUs</li>
</ul>
</li>
<li>UpdateItem
<ul>
<li>edits an existing item’s attributes or adds a new item if it doesn’t exist</li>
<li>can be used to implement Atomic Counters - a numeric attribute that is unconditionally incremented</li>
</ul>
</li>
<li>conditional writes
<ul>
<li>accept a write / update / delete only if conditions are met, otherwise returns an error</li>
<li>helps with concurrent access to items</li>
<li>no performance impact</li>
</ul>
</li>
</ul>
<h2 id="reading-data"><a class="markdownIt-Anchor" href="#reading-data"></a> reading data</h2>
<ul>
<li>GetItem
<ul>
<li>read based on primary key</li>
<li>primary key can be HASH or HASH + RANGE</li>
<li>eventually consistent read</li>
<li>option to use strongly consistent reads (more RCU - might take longer)</li>
<li>ProjectionExpression can be specified to retrieve only certain attributes</li>
</ul>
</li>
</ul>
<h2 id="reading-data-query"><a class="markdownIt-Anchor" href="#reading-data-query"></a> reading data - query</h2>
<ul>
<li>query returns items based on
<ul>
<li>KeyConditionExpression
<ul>
<li>partition key value - required</li>
<li>sort key value = optional</li>
</ul>
</li>
<li>FilterExpression
<ul>
<li>additional filtering after the query operation (before data returned to you)</li>
<li>use only with non key attributes</li>
</ul>
</li>
</ul>
</li>
<li>returns
<ul>
<li>the number of items specified in limit</li>
<li>or up to 1 MB of data</li>
</ul>
</li>
<li>ability to do pagination on the results</li>
<li>can query table, a local secondary index, or a global secondary index</li>
</ul>
<h2 id="reading-data-scan"><a class="markdownIt-Anchor" href="#reading-data-scan"></a> reading data - scan</h2>
<ul>
<li>scan the entire table and then filter out data (inefficient)</li>
<li>returns up to 1 MB of data - use pagination to keep on reading</li>
<li>consumes a lot of RCU</li>
<li>limit impact using Limit or reduce the size of the result and pause</li>
<li>for faster performance, use parallel scan
<ul>
<li>multiple workers scan multiple data segments at the same time</li>
<li>increases the throughput and RCU consumed</li>
<li>limit the impact of parallel scans just like you would for Scans</li>
</ul>
</li>
<li>can use ProjectionExpression and FilterExpression</li>
<li>filtering will be done at the client side (e.g. in the browser)</li>
</ul>
<h2 id="deleting-data"><a class="markdownIt-Anchor" href="#deleting-data"></a> deleting data</h2>
<ul>
<li>DeleteItem
<ul>
<li>delete an individual item</li>
<li>ability to perform a conditional delete</li>
</ul>
</li>
<li>DeleteTable
<ul>
<li>delete a whole table and all its items</li>
<li>much quicker deletion than calling DeleteItem on all items</li>
</ul>
</li>
</ul>
<h2 id="batch-operations"><a class="markdownIt-Anchor" href="#batch-operations"></a> batch operations</h2>
<ul>
<li>allows you to save in latency by reducing the number of API calls</li>
<li>operations are done in parallel for better efficiency</li>
<li>part of a batch can fail, in which case we need to try again for the failed items</li>
<li>BatchWriteItem
<ul>
<li>up to 25 PutItem and DeleteItem in one call</li>
<li>up to 16 MB of data written, up to 400KB of data per item</li>
<li>can’t update items</li>
</ul>
</li>
<li>BatchGetItem
<ul>
<li>return items from one or more tables</li>
<li>up to 100 items, up to 16 MB of data</li>
<li>items are retrieved in parallel to minimize latency</li>
</ul>
</li>
</ul>
<h2 id="local-secondary-index-lsi"><a class="markdownIt-Anchor" href="#local-secondary-index-lsi"></a> Local Secondary Index (LSI)</h2>
<ul>
<li>alternative sort key for your table (use the same partition key)</li>
<li>the sort key consists of one scalar attribute</li>
<li>up to 5 local secondary indexes per table</li>
<li>must be defined at table creation time</li>
<li>attribute projections - can contain some or all the attributes of the base table</li>
</ul>
<h2 id="global-secondary-index-gsi"><a class="markdownIt-Anchor" href="#global-secondary-index-gsi"></a> Global secondary index (GSI)</h2>
<ul>
<li>alternative Primary key (HASH + HASH + RANGE) from the base table</li>
<li>speed up queries on non key attributes</li>
<li>the index key consists of scalar attributes</li>
<li>attribute projections - some or all the attributes of the base table</li>
<li>must provision RCUs and WCUs for the index</li>
<li>can be added / modified after table creation</li>
</ul>
<h2 id="indexes-and-throttling"><a class="markdownIt-Anchor" href="#indexes-and-throttling"></a> indexes and throttling</h2>
<ul>
<li>GSI
<ul>
<li>if the writes are throttled on the GSI, then the main table will be throttled</li>
<li>even if the WCU on the main tables are fine</li>
<li>choose your GSI partition key carefully</li>
<li>assign your WCU capacity carefully</li>
</ul>
</li>
<li>LSI
<ul>
<li>uses the WCUs and RCUs of the main table</li>
<li>no special throttling considerations</li>
</ul>
</li>
</ul>
<h2 id="optimistic-locking"><a class="markdownIt-Anchor" href="#optimistic-locking"></a> Optimistic locking</h2>
<ul>
<li>DynamoDB has a feature called Conditional Writes</li>
<li>a strategy to ensure an item hasn’t changed before you update / delete it</li>
<li>each item has an attribute that acts as a version number, and each update / delete request will change the value of the item, and also update the version number</li>
<li>if two request send at the same time, only one will succeed because the second request will not try to change the item because the version is different already.</li>
</ul>
<h2 id="dynamodb-dax"><a class="markdownIt-Anchor" href="#dynamodb-dax"></a> DynamoDB DAX</h2>
<ul>
<li>fully managed, highly available, seamless in memory cache for DynamoDB</li>
<li>microseconds latency for cached reads and queries</li>
<li>doesn’t require application logic modification</li>
<li>solves the hot key problem (too many reads)</li>
<li>5 minutes TTL for cache (default)</li>
<li>up to 10 nodes in the cluster</li>
<li>multi AZ</li>
<li>secure</li>
</ul>
<h3 id="dax-vs-elasticache"><a class="markdownIt-Anchor" href="#dax-vs-elasticache"></a> DAX vs ElastiCache</h3>
<ul>
<li>DAX is for individual object cache and simple query and scan</li>
<li>ElastiCache can store aggregation result and complex intermediate results</li>
</ul>
<h2 id="dynamodb-streams"><a class="markdownIt-Anchor" href="#dynamodb-streams"></a> DynamoDB Streams</h2>
<ul>
<li>
<p>ordered stream of item level modifications in a table</p>
</li>
<li>
<p>stream records can be</p>
<ul>
<li>sent to Kinesis Data Streams</li>
<li>read by AWS lambda</li>
<li>read by Kinesis Client Linrary applications</li>
</ul>
</li>
<li>
<p>data retention for up to 24 hours</p>
</li>
<li>
<p>use case</p>
<ul>
<li>react to changes in real time</li>
<li>analytics</li>
<li>insert into derivative tables</li>
<li>insert into ElasticSearch</li>
<li>implement cross region replication</li>
</ul>
</li>
<li>
<p>ability to choose the information that will be written to the stream</p>
<ul>
<li>KEYS_ONLY - only the key attributes of the modified item</li>
<li>NEW_IMAGE - the entire item, as it appears after it was modified</li>
<li>OLD_IMGAE - the entire item, as it appeared before it was modified</li>
<li>NEW_AND_OLD_IMAGES - both the new and old images of the item</li>
</ul>
</li>
<li>
<p>DynamoDB streams are made of shards, just like Kinesis Data Streams, so Kinesis KCL can be the consumer for DynamoDB Streams</p>
</li>
<li>
<p>you don’t need to provision shards, this is automated by AWS</p>
</li>
<li>
<p>records are not retroactively populated in a stream after enabling it</p>
</li>
</ul>
<h3 id="streams-and-lambda"><a class="markdownIt-Anchor" href="#streams-and-lambda"></a> Streams and lambda</h3>
<ul>
<li>you need to define an Event Source Mapping to read from DynamoDB streams</li>
<li>you need to ensure the lambda function has the appropriate permissions</li>
<li>your lambda function is invoked synchronously</li>
</ul>
<h2 id="dynamodb-ttl"><a class="markdownIt-Anchor" href="#dynamodb-ttl"></a> DynamoDB TTL</h2>
<ul>
<li>automatically delete items after an expiry timestamp</li>
<li>doesn’t consume any WCUs</li>
<li>the TTL attribute must be a number data type with Unix Epoch timestamp value</li>
<li>expired items deleted within 48 hours of expiration</li>
<li>expired items that haven’t been deleted, appears in reads/queries/scans (if you don’t want them, filter them out)</li>
<li>expired items are deleted from both LSIs and GSIs</li>
<li>a delete operation for each expired item enters the DynamoDB streams (can help recover expired items)</li>
<li>use cases: reduce stored data by keeping only current items, adhere to regulatory obligations, user sessions…</li>
</ul>
<h2 id="dynamodb-cli"><a class="markdownIt-Anchor" href="#dynamodb-cli"></a> DynamoDB CLI</h2>
<ul>
<li><code>--projection-expression</code>: one or more attributes to retrieve</li>
<li><code>--filter-expression</code>: filter items before returned to you</li>
<li>general CLI pagination options
<ul>
<li><code>--page-size</code>: specify that CLI retrieves the full list of items but with a larger number of API calls instead of one API call</li>
<li><code>--max-items</code>: max number of items to show in the CLI (returns NextToken)</li>
<li><code>--starting-token</code>: specify the last NextToken to retrieve the next set of items</li>
</ul>
</li>
</ul>
<h2 id="dynamodb-transactions"><a class="markdownIt-Anchor" href="#dynamodb-transactions"></a> DynamoDB transactions</h2>
<ul>
<li>coordinated, all or nothing opeartions to multiple items across one or more tables</li>
<li>provides Atomicity, Consistency, Isolation, and Durability (ACID)</li>
<li>read modes - Eventual consistency, strong consistency, transactional</li>
<li>write modes - standard, transactional</li>
<li>consumers 2x WCUs and 2x RCUs</li>
<li>two operations
<ul>
<li>TransactGetItems - one or more GetItem operations</li>
<li>TransactWriteItems - one or more PutItem, UpdateItem, DeleteItem operations</li>
</ul>
</li>
<li>use cases: financial transactions, managing orders, multi player games…</li>
</ul>
<h2 id="dynamodb-session-state-cache"><a class="markdownIt-Anchor" href="#dynamodb-session-state-cache"></a> DynamoDB Session State Cache</h2>
<ul>
<li>it is common to use DynamoDB to store session state</li>
<li>vs ElastiCache
<ul>
<li>ElastiCache is in memory, but DynamoDB is serverless with auto scaling</li>
<li>both are key value pairs</li>
</ul>
</li>
<li>vs EFS
<ul>
<li>EFS must be attached to EC2 instances as a network drive</li>
</ul>
</li>
<li>vs EBS and Instance store
<ul>
<li>EBS and Instance store can only be used for local caching, not shared caching</li>
</ul>
</li>
<li>vs S3
<ul>
<li>S3 is higher latency, and not meant for small objects</li>
</ul>
</li>
</ul>
<h2 id="dynamodb-security-and-other-features"><a class="markdownIt-Anchor" href="#dynamodb-security-and-other-features"></a> DynamoDB Security and other features</h2>
<ul>
<li>security
<ul>
<li>VPC endpoints available to access DynamoDB without using the internet</li>
<li>access fully controled by IAM</li>
<li>encryption at rest using KMS and in transit using SSL/TLS</li>
</ul>
</li>
<li>backup and restore feature available
<ul>
<li>point in time recovery (PITR) like RDS</li>
<li>no performance impact</li>
</ul>
</li>
<li>global tables
<ul>
<li>multi region, multi active, fully replicated, high performance, need to enable DynamoDB streams first</li>
</ul>
</li>
<li>DynamoDB local
<ul>
<li>develop and test apps locally without accessing the DynamoDB web service (without internet)</li>
</ul>
</li>
<li>AWS database migration service can be used to migrate to DynamoDB</li>
</ul>
<h3 id="fine-grained-access-control"><a class="markdownIt-Anchor" href="#fine-grained-access-control"></a> Fine-Grained access control</h3>
<ul>
<li>using web identity federation or cognito identity pools, each user gets AWS credentials</li>
<li>you can assign an IAM role to these users with a condition to limit their API access to DynamoDB</li>
<li>Leading Keys - limit row level access for users on the primary key</li>
<li>Attributes - limit specific attributes the user can see</li>
</ul>
<h1 id="api-gateway"><a class="markdownIt-Anchor" href="#api-gateway"></a> API Gateway</h1>
<h2 id="integrations-high-level"><a class="markdownIt-Anchor" href="#integrations-high-level"></a> Integrations high level</h2>
<ul>
<li>lambda function
<ul>
<li>invoke lambda function</li>
<li>easy way to expose REST API backed by lambda</li>
</ul>
</li>
<li>HTTP
<ul>
<li>expose HTTP endpoints in the backend</li>
<li>why? add rate limiting, caching, user authentications, API keys, etc…</li>
</ul>
</li>
<li>AWS service
<ul>
<li>expose any API through the API Gateway</li>
<li>example: Step function workflow, post a message to SQS</li>
<li>why? add authentication, deploy publicly, rate control…</li>
</ul>
</li>
</ul>
<h2 id="endpoint-types"><a class="markdownIt-Anchor" href="#endpoint-types"></a> endpoint types</h2>
<ul>
<li>Edge-Optimized (default): for global clients
<ul>
<li>requests are routed through the CloudFront Edge locations</li>
<li>the API Gateway still lives in only one region</li>
</ul>
</li>
<li>regional
<ul>
<li>for clients within the same region</li>
<li>could manually combine with CloudFront (more control over the caching strategies and the distribution)</li>
</ul>
</li>
<li>private
<ul>
<li>can only be accessed from your VPC using an interface VPC endpoint (ENI)</li>
<li>use a resource policy to define access</li>
</ul>
</li>
</ul>
<h2 id="deployment-stages"><a class="markdownIt-Anchor" href="#deployment-stages"></a> Deployment stages</h2>
<ul>
<li>making changes in the API Gateway does not mean they are effective</li>
<li>you need to make a deployment for them to be in effect</li>
<li>changes are deployed to Stages (as many as you want)</li>
<li>use the naming you like for stages (dev, test, prod)</li>
<li>each stage has its own configuration parameters</li>
<li>stages can be rolled back as a history of deployments is kept</li>
</ul>
<h3 id="stage-variables"><a class="markdownIt-Anchor" href="#stage-variables"></a> stage variables</h3>
<ul>
<li>stage variables are like environment variables for API Gateway</li>
<li>use them to change often changing configuration values</li>
<li>they can be used in
<ul>
<li>lambda function ARN</li>
<li>HTTP endpoint</li>
<li>parameter mapping templates</li>
</ul>
</li>
<li>use cases:
<ul>
<li>configure HTTP endpoints your stages talk to</li>
<li>pass configuration parameters to lambda through mapping templates</li>
</ul>
</li>
<li>stage variables are passed to the context object in lambda</li>
</ul>
<h3 id="stage-variables-with-lambda-aliases"><a class="markdownIt-Anchor" href="#stage-variables-with-lambda-aliases"></a> stage variables with lambda aliases</h3>
<ul>
<li>we can create a stage variable to indicate the corresponding lambda alias</li>
<li>our API gateway will automatically invoke the right lambda function</li>
</ul>
<h2 id="canary-deployment"><a class="markdownIt-Anchor" href="#canary-deployment"></a> canary deployment</h2>
<ul>
<li>possibility to enable canary deployments for any stage</li>
<li>choose the percentage of traffic the canary channel receives</li>
<li>metrics and logs are separate (for better monitoring)</li>
<li>possiblity to override stage variables for canary</li>
<li>this is Blue / Green deployment with lambda and API gateway</li>
</ul>
<h2 id="api-gateway-integration-types"><a class="markdownIt-Anchor" href="#api-gateway-integration-types"></a> API Gateway - Integration types</h2>
<ul>
<li>MOCK
<ul>
<li>API Gateway returns a response without sending the request to the backend (for testing and dev purpose)</li>
</ul>
</li>
<li>HTTP / AWS
<ul>
<li>you must configure both the integration request and integration response</li>
<li>setup data mapping using mapping templates for the request and response</li>
</ul>
</li>
<li>AWS_PROXY (lambda proxy)
<ul>
<li>incoming request from the client is the input to lambda</li>
<li>the function is responsible for the logic of request / response</li>
<li>no mapping template, headers, query string parameters</li>
</ul>
</li>
<li>HTTP_PROXY
<ul>
<li>no mapping template</li>
<li>the HTTP request is passed to the backend</li>
<li>the HTTP response from the backend is forwarded by API gateway</li>
</ul>
</li>
</ul>
<h3 id="mapping-template"><a class="markdownIt-Anchor" href="#mapping-template"></a> Mapping template</h3>
<ul>
<li>mapping templates can be used to modify request / response</li>
<li>rename and modify query string parameters</li>
<li>modify body content</li>
<li>add headers</li>
<li>uses Velocity template language</li>
<li>filter output results</li>
</ul>
<h3 id="mapping-template-json-to-xml-with-soap"><a class="markdownIt-Anchor" href="#mapping-template-json-to-xml-with-soap"></a> Mapping template: JSON to XML with SOAP</h3>
<ul>
<li>SOAP API are XML based, whereas REST API are JSON based</li>
<li>in this case, API gateway should
<ul>
<li>extract data from the request: either path, payload or header</li>
<li>build SOAP message based on request data (mapping template)</li>
<li>call SOAP service and receive XML response</li>
<li>transform XML response to desired format and respond to the user</li>
</ul>
</li>
</ul>
<h2 id="api-gateway-swagger-open-api-spec"><a class="markdownIt-Anchor" href="#api-gateway-swagger-open-api-spec"></a> API Gateway Swagger / Open API spec</h2>
<ul>
<li>common way of defining REST APIs, using API defintion as code</li>
<li>import existing Swagger / OpenAPI 3.0 spec to API Gateway
<ul>
<li>method</li>
<li>method request</li>
<li>integration request</li>
<li>method response</li>
<li>extensions for API Gateway and setup every single option</li>
</ul>
</li>
<li>can export current API as Swagger / OpenAPI spec</li>
<li>swagger can be written in YAML or JSON</li>
</ul>
<h2 id="caching-api-response"><a class="markdownIt-Anchor" href="#caching-api-response"></a> Caching API response</h2>
<ul>
<li>caching reduces the number of calls made to the backend</li>
<li>default TTL is 300 seconds</li>
<li>caches are defined per stage</li>
<li>possible to override cache settings per method</li>
<li>cache encryption option</li>
<li>cache capacity between 0.5 to 237 GB</li>
<li>cache is expensive, makes sense in production, may not make sense in dev and test</li>
</ul>
<h3 id="api-gateway-cache-invalidation"><a class="markdownIt-Anchor" href="#api-gateway-cache-invalidation"></a> API Gateway cache invalidation</h3>
<ul>
<li>able to flush the entire cache immediately</li>
<li>clients can invalidate the cache with header: <code>Cache-Control: max-age=0</code> (with proper IAM authorization)</li>
<li>if you don’t impose an InvalidateCache policy or choose the require authorization check box in the console, any client can invalidate the API cache, which is not good.</li>
</ul>
<h2 id="usage-plan-and-api-keys"><a class="markdownIt-Anchor" href="#usage-plan-and-api-keys"></a> Usage plan and API keys</h2>
<ul>
<li>if you want to make an API available as an offering to your customers</li>
<li>usage plan
<ul>
<li>who can access one or more deployed API stages and methods</li>
<li>how much and how fast they can access them</li>
<li>uses API keys to identify API clients and meter access</li>
<li>configure throttling limits and quota limits that are enforced on individual client</li>
</ul>
</li>
<li>API keys
<ul>
<li>alphanumberic string values to distribute to your customers</li>
<li>can use with usage plans to control access</li>
<li>throttling limits are applied to API keys</li>
<li>quotas limits is the overall number of maximum requests</li>
</ul>
</li>
</ul>
<h2 id="logging-and-tracing"><a class="markdownIt-Anchor" href="#logging-and-tracing"></a> logging and tracing</h2>
<ul>
<li>CloudWatch logs
<ul>
<li>enable CloudWatch logging at the stage level</li>
<li>can override settings on a per API basis</li>
<li>log contains information about request / response body</li>
</ul>
</li>
<li>X-Ray
<ul>
<li>enable tracing to get extra information about requests in API gateway</li>
<li>X-Ray API Gateway + Lambda gives you the full picture</li>
</ul>
</li>
</ul>
<h2 id="cloudwatch-metrics-2"><a class="markdownIt-Anchor" href="#cloudwatch-metrics-2"></a> CloudWatch metrics</h2>
<ul>
<li>metrics are by stage, possiblity to enable detailed metrics</li>
<li>CacheHitCount and CacheMissCount: efficiency of the cache</li>
<li>Count: the total number of API requests in a given period</li>
<li>IntegrationLatency: the time between when API Gateway relays a request to the backend and when receives a response from the backend</li>
<li>Latency: the time between when API gateway receives a request from a client and when it returns a response to the client, the latency includes the integration latency and other API gateway overhead</li>
<li>4xx Error (client side) and 5xx error (server side)</li>
</ul>
<h2 id="throttling-2"><a class="markdownIt-Anchor" href="#throttling-2"></a> throttling</h2>
<ul>
<li>account limit
<ul>
<li>API gateway throttles requests at 10000 rps across all API</li>
<li>soft limit that can be increased upon request</li>
</ul>
</li>
<li>in case of throttling = 429 too many requests</li>
<li>can set stage limit and method limits to improve performance</li>
<li>or you can define usage plans to throttle per customer</li>
<li>just like lambda concurrency, one API that is overloaded, if not limited, can cause the other APIs to be throttled too.</li>
</ul>
<h2 id="cors-2"><a class="markdownIt-Anchor" href="#cors-2"></a> CORS</h2>
<ul>
<li>CORS must be enabled when you receive API calls from another domain</li>
<li>the OPTIONS pre flight request must contain the following headers
<ul>
<li>Access-Control-Allow-Methods</li>
<li>Access-Control-Allow-Headers</li>
<li>Access-Control-Allow-Origin</li>
</ul>
</li>
<li>CORS can be enabled through the console</li>
</ul>
<h2 id="authentication-and-authorization"><a class="markdownIt-Anchor" href="#authentication-and-authorization"></a> Authentication and Authorization</h2>
<ul>
<li>IAM
<ul>
<li>great for users already within your AWS accounts + resource policy for cross account</li>
</ul>
</li>
<li>Custom Authorizer
<ul>
<li>great for third party tokens</li>
<li>very flexible in terms of what IAM policy is returned</li>
</ul>
</li>
<li>Cognito User Pool
<ul>
<li>you manage your own user pool</li>
<li>no need to write any custom code</li>
<li>must implement authorization in the backend</li>
</ul>
</li>
</ul>
<h2 id="websocket-api"><a class="markdownIt-Anchor" href="#websocket-api"></a> WebSocket API</h2>
<ul>
<li>what is WebSocket
<ul>
<li>two way interactive communication between a user’s browser and a server</li>
<li>server can push information to the client</li>
<li>this enables stateful application use cases</li>
</ul>
</li>
<li>WebSocket APIs are often used in real time applications such as chat applications, collaboration platforms, multiplayer games, and financial trading platforms</li>
<li>works with AWS services (lambda, DynamoDB) or HTTP endpoints</li>
</ul>
<h3 id="routing"><a class="markdownIt-Anchor" href="#routing"></a> Routing</h3>
<ul>
<li>incoming JSON messages are routed to different backend</li>
<li>if no routes =&gt; send to default</li>
<li>you request a route selection expression to select the field on JSON to route from</li>
<li>the result is evaluated against the route keys available in your API gateway</li>
<li>the route is then connceted to the backend you have setup through API gateway</li>
</ul>
<h2 id="architecture"><a class="markdownIt-Anchor" href="#architecture"></a> Architecture</h2>
<ul>
<li>create a single interface for all the microservices in your company</li>
<li>use API endpoints with various resources</li>
<li>apply a simple domain name and SSL certificates</li>
<li>can apply forwarding and transformation rules at the API gateway level</li>
</ul>
<h1 id="sam-serverless-application-model"><a class="markdownIt-Anchor" href="#sam-serverless-application-model"></a> SAM (serverless application model)</h1>
<ul>
<li>framework for developing and deploying serverless applications</li>
<li>all the configurations is YAML code</li>
<li>generate complex CloudFormation from simple SAM YAML file</li>
<li>supports anything from CLoudFormation</li>
<li>only two commmands to deploy to AWS</li>
<li>SAM can use CodeDeploy to deploy lambda functions</li>
<li>SAM can help you to run lambda, API gateway, DynamoDB locally</li>
</ul>
<h2 id="recipe"><a class="markdownIt-Anchor" href="#recipe"></a> Recipe</h2>
<ul>
<li>transform header indicates its SAM template
<ul>
<li><code>Transform:</code></li>
</ul>
</li>
<li>write code
<ul>
<li>AWS::Serverless::Function</li>
<li>AWS::Serverless::Api</li>
<li>AWS::Serverless::SimpleTable</li>
</ul>
</li>
<li>package and deploy
<ul>
<li>aws cloudformation package / sam package</li>
<li>aws cloudformation deploy / sam deploy</li>
</ul>
</li>
</ul>
<h2 id="sam-policy-templates"><a class="markdownIt-Anchor" href="#sam-policy-templates"></a> SAM policy templates</h2>
<ul>
<li>list of templates to apply permissions to your lambda functions</li>
<li>important examples
<ul>
<li>S3ReadPolicy: give read only permissions to objects in S3</li>
<li>SQSPollerPolicy: allows to poll an SQS queue</li>
<li>DynamoDBCrudPolicy: CRUD = create read update delete</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">MyFunction:</span><br><span class="line">  Type: &#39;AWS::Serverless::Function&#39;</span><br><span class="line">  Properties:</span><br><span class="line">    CodeUri: xxxxx</span><br><span class="line">    Handler: xxxxxx</span><br><span class="line">    Runtime: xxxxxx</span><br><span class="line">    Policies:</span><br><span class="line">      - SQSPollerPolicy:</span><br><span class="line">        QueueName:</span><br><span class="line">          !GetAtt MyQueue.QueueName</span><br></pre></td></tr></table></figure>
<h2 id="sam-sumary"><a class="markdownIt-Anchor" href="#sam-sumary"></a> SAM Sumary</h2>
<ul>
<li>SAM is built on CloudFormation</li>
<li>SAM requires the Transform and Resources sections</li>
<li>commands to know
<ul>
<li>sam build: fetch dependencies and create local deployment artifacts</li>
<li>sam package: package and upload to Amazon S3, generate CloudFormation template</li>
<li>sam deploy: deploy to CloudFormation</li>
</ul>
</li>
<li>SAM policy templates for easy IAM policy definition</li>
<li>SAM is integrated with CodeDeploy to do deploy to lambda aliases</li>
</ul>
<h2 id="serverless-application-repository-sar"><a class="markdownIt-Anchor" href="#serverless-application-repository-sar"></a> Serverless Application Repository (SAR)</h2>
<ul>
<li>managed repository for serverless applications</li>
<li>the applications are packaged using SAM</li>
<li>build and publish applications that can be re used by organizations
<ul>
<li>can share publicly</li>
<li>can share with specific accounts</li>
</ul>
</li>
<li>this prevents duplicate work, and just go straight to publishing</li>
<li>application settings and behavior can be customized using Environment variables</li>
</ul>
<h1 id="cloud-development-kit-cdk"><a class="markdownIt-Anchor" href="#cloud-development-kit-cdk"></a> Cloud Development Kit (CDK)</h1>
<ul>
<li>define your cloud infrastructure using a familiar language</li>
<li>contains high level components called <code>constructs</code></li>
<li>the code is complied into a CloudFormation template (YAML / JSON)</li>
<li>you can therefore deploy infrastructure and application runtime code togther
<ul>
<li>great for lambda functions</li>
<li>great for Docker Containers in ECS / EKS</li>
</ul>
</li>
</ul>
<h2 id="cdk-vs-sam"><a class="markdownIt-Anchor" href="#cdk-vs-sam"></a> CDK vs SAM</h2>
<ul>
<li>SAM
<ul>
<li>serverless focused</li>
<li>write your template declaratively in JSON or YAML</li>
<li>great for quickly getting started with lambda</li>
<li>leverages CloudFormation</li>
</ul>
</li>
<li>CDK
<ul>
<li>all aws services</li>
<li>write infra in a programming language</li>
<li>leverages CloudFormation</li>
</ul>
</li>
</ul>
<h1 id="cognito"><a class="markdownIt-Anchor" href="#cognito"></a> Cognito</h1>
<ul>
<li>we want to give our users an identity so that they can interact with our application</li>
<li>Cognito user pools
<ul>
<li>sign in functionality for app users</li>
<li>integrate with API gateway and ALB</li>
</ul>
</li>
<li>Cognito Identity Pool (federated identity)
<ul>
<li>provide AWS credentials to users so they can access AWS resources directly</li>
<li>integrate with Cognito user pools as an identity provider</li>
</ul>
</li>
<li>Cognito Sync
<ul>
<li>Synchronize data from device to Cognito</li>
<li>is deprecated and replaced by AppSync</li>
</ul>
</li>
</ul>
<h2 id="cognito-user-pools"><a class="markdownIt-Anchor" href="#cognito-user-pools"></a> Cognito User Pools</h2>
<ul>
<li>
<p>create a serverless database of user for your web and mobile apps</p>
</li>
<li>
<p>simple login: username and password combination</p>
</li>
<li>
<p>password reset</p>
</li>
<li>
<p>email and phone number verification</p>
</li>
<li>
<p>federated identities: users from Facebook, Google, SAML…</p>
</li>
<li>
<p>feature: block users if their credentials are compromised elsewhere</p>
</li>
<li>
<p>login send back a JSON web token (JWT)</p>
</li>
<li>
<p>Cognito has a hosted authentication UI that you can add to your app to handle signup and signin workflows</p>
</li>
<li>
<p>using the hosted UI, you have a foundation for integration with social logins, OIDC or SAML</p>
</li>
<li>
<p>can customize with a custom logo and custom CSS</p>
</li>
</ul>
<h2 id="cognito-identity-pools"><a class="markdownIt-Anchor" href="#cognito-identity-pools"></a> Cognito Identity Pools</h2>
<ul>
<li>get identities for users so they obtain temporary AWS credentials</li>
<li>your identity pool can include
<ul>
<li>public providers (login with Amazon, Facebook, Google, Apple)</li>
<li>users in an Amazon Cognito user pool</li>
<li>OpenID Connect Providers and SAML identity providers</li>
<li>developer authenticated identities</li>
<li>Cognito identity pools allow for unauthenticated (guest) access</li>
</ul>
</li>
<li>users can then access AWS service directly or through API gateway
<ul>
<li>the IAM policies applied to the credentials are defined in Cognito</li>
<li>they can be customized based on the user_id for fine grained control</li>
</ul>
</li>
</ul>
<h3 id="iam-roles"><a class="markdownIt-Anchor" href="#iam-roles"></a> IAM roles</h3>
<ul>
<li>default IAM roles for authenticated and guest users</li>
<li>define rules to choose the role for each user based on the user’s ID</li>
<li>you can partition your users’ access using policy variables</li>
<li>IAM credentials are obtained by Cognito identity pools through STS</li>
<li>the roles must have a trust policy of Cognito identity pools</li>
</ul>
<h2 id="cognito-user-pools-vs-cognito-identity-pools"><a class="markdownIt-Anchor" href="#cognito-user-pools-vs-cognito-identity-pools"></a> Cognito User Pools vs Cognito Identity Pools</h2>
<ul>
<li>Cognito User Pool
<ul>
<li>database of users for your web and mobile application</li>
<li>allows to federate logins through public social identity provider, OIDC, SAML…</li>
<li>can customize the hosted UI for authentication</li>
<li>has triggers with AWS lamdba during the authentication flow</li>
</ul>
</li>
<li>Cognito identity pools
<ul>
<li>obtain AWS credentials for your users</li>
<li>users can login through public social, OIDC, SAML and Cognito User Pools</li>
<li>users can be unauthenticated</li>
<li>users are mapped to IAM roles and policies, can leverage policy variables</li>
</ul>
</li>
<li>CUP + CIP = manage users / password + access AWS services</li>
</ul>
<h2 id="cognito-sync"><a class="markdownIt-Anchor" href="#cognito-sync"></a> Cognito Sync</h2>
<ul>
<li>Deprecated - use AWS AppSync now</li>
<li>store preferences, configuration, state of app</li>
<li>cross device synchronization</li>
<li>offline capability</li>
<li>store data in datasets</li>
<li>push sync: silently notify across all devices when identity data changes</li>
<li>Cognito Stream: stream data from Cognito into Kinesis</li>
<li>Cognito Events: execute lambda functions in response to events</li>
</ul>
<h1 id="step-functions"><a class="markdownIt-Anchor" href="#step-functions"></a> Step Functions</h1>
<ul>
<li>model your workflows as state machines (one per workflow)
<ul>
<li>order fulfillment, data processing</li>
<li>web applications, any workflow</li>
</ul>
</li>
<li>written in JSON</li>
<li>visualization of the workflow and the execution of the workflow, as well as history</li>
<li>start workflow with SDK call, API gateway, eventbridge</li>
</ul>
<h2 id="task-states"><a class="markdownIt-Anchor" href="#task-states"></a> task states</h2>
<ul>
<li>do some work in your state machine</li>
<li>invoke one service
<ul>
<li>can invoke a lambda function</li>
<li>run an batch job</li>
<li>run an ECS task and wait for it to complete</li>
<li>insert an item from DynamoDB</li>
<li>publish message to SNS, SQS</li>
<li>launch another step function workflow</li>
</ul>
</li>
<li>run an activity
<ul>
<li>EC2, Amazon ECS, on premises</li>
<li>activities poll the step functions for work</li>
<li>activities send result back to step functions</li>
</ul>
</li>
</ul>
<h2 id="states"><a class="markdownIt-Anchor" href="#states"></a> states</h2>
<ul>
<li>choice state: test for a condition to send to a branch</li>
<li>fail or succeed state: stop execution with failure or success</li>
<li>pass state: simply pass its input to its output or inject some fixed data, without performing work</li>
<li>wait state: provide a delay for a certain amount of time or until a specified time/date</li>
<li>Map state: dynamically iterate steps</li>
<li>parallel state: begin parallel branches of execution</li>
</ul>
<h2 id="error-handling"><a class="markdownIt-Anchor" href="#error-handling"></a> Error handling</h2>
<ul>
<li>any state can encounter runtime errors for various reasons
<ul>
<li>state machine definition issues</li>
<li>task failtures</li>
<li>transient issues</li>
</ul>
</li>
<li>use <code>retry</code> and <code>catch</code> in the state machine to handle the errors instead of inside the application code</li>
<li>the state may report its own errors</li>
</ul>
<h3 id="retry"><a class="markdownIt-Anchor" href="#retry"></a> Retry</h3>
<ul>
<li>evaluated from top to bottom</li>
<li>ErrorEquals: match a specific kind of error</li>
<li>IntervalSeconds: initial delay before retrying</li>
<li>BackOffRate: multiple the delay after each retry</li>
<li>MaxAttempts: default to 3, set to 0 for never retried</li>
<li>When max attempts are reached, the <code>catch</code> kicks in</li>
</ul>
<h3 id="catch"><a class="markdownIt-Anchor" href="#catch"></a> Catch</h3>
<ul>
<li>evaluated from top to bottom</li>
<li>ErrorEquals: match a specific kind of error</li>
<li>Next: state to send to</li>
<li>ResultPath: a path that determines what input is sent to the state specified in the Next field</li>
</ul>
<h3 id="resultpath"><a class="markdownIt-Anchor" href="#resultpath"></a> ResultPath</h3>
<ul>
<li>include the error in the input</li>
</ul>
<h1 id="appsync"><a class="markdownIt-Anchor" href="#appsync"></a> AppSync</h1>
<ul>
<li>AppSync is a managed service that uses GraphQL</li>
<li>GraphQL makes it easy for applications to get exactly the data they needed</li>
<li>this includes combining data from one or more sources</li>
<li>retrieve data in real time with WebSocket or MQTT on WebSocket</li>
<li>for mobile apps: local data access and data Synchronization</li>
<li>it all starts with uploading one GraphQL schema</li>
</ul>
<h2 id="security-5"><a class="markdownIt-Anchor" href="#security-5"></a> Security</h2>
<ul>
<li>there are four ways you can authorize applications to interact with your AppSync GraphQL API
<ul>
<li>API KEY</li>
<li>IAM</li>
<li>OPENID_CONNECT</li>
<li>COGNITO USER POOLS</li>
</ul>
</li>
<li>for custom domain and HTTPS, use CloudFront in front of AppSync</li>
</ul>
<h1 id="sts-security-token-service"><a class="markdownIt-Anchor" href="#sts-security-token-service"></a> STS (security Token service)</h1>
<ul>
<li>Allows to grant limited and temporary access to AWS resources</li>
<li>AssumeRole: assume roles within your account or cross account</li>
<li>AssumeRoleWithSAML: return credentials for users logged in with SAML</li>
<li>AssumeRoleWithWebIdentity
<ul>
<li>return credentials for users logged with an IDP</li>
<li>AWS recommends against using this, and using Cognito User Pools instead</li>
</ul>
</li>
<li>GetSessionToken: For MFA, from a user or account root user</li>
<li>GetFederationToken: obtain temporary credentials for a federated user</li>
<li>GetCallerIdentity: return details about the IAM user or role used in the API call</li>
<li>DecodeAuthorizationMessage: decode error message when an AWS API is called</li>
</ul>
<h2 id="using-sts-to-assume-a-role"><a class="markdownIt-Anchor" href="#using-sts-to-assume-a-role"></a> using STS to assume a role</h2>
<ul>
<li>define an IAM role within your account or cross account</li>
<li>define which principals can access this IAM role</li>
<li>user STS to retrieve credentials and impersonate the IAM role you have access to</li>
<li>temporary credentials can be valid between 15 minutes to 1 hour</li>
</ul>
<h2 id="sts-with-mfa"><a class="markdownIt-Anchor" href="#sts-with-mfa"></a> STS with MFA</h2>
<ul>
<li>use GetSessionToken from STS</li>
<li>appropriate IAM policy using IAM conditions</li>
<li><code>aws:MultiFactorAuthPresent:true</code></li>
<li>GetSessionToken returns
<ul>
<li>access ID</li>
<li>secret key</li>
<li>session token</li>
<li>expiration date</li>
</ul>
</li>
</ul>
<h1 id="advanced-iam"><a class="markdownIt-Anchor" href="#advanced-iam"></a> Advanced IAM</h1>
<h2 id="iam-policies-and-s3-bucket-policies"><a class="markdownIt-Anchor" href="#iam-policies-and-s3-bucket-policies"></a> IAM policies and S3 Bucket policies</h2>
<ul>
<li>IAM policies are attached to users, roles and groups</li>
<li>S3 bucket policies are attached to buckets</li>
<li>when evaluating if an IAM principal can perform an operation X on a bucket, the <code>union</code> of its assigned IAM policies and S3 bucket policies will be evaluated at the same time.</li>
</ul>
<h2 id="dynamic-policies-with-iam"><a class="markdownIt-Anchor" href="#dynamic-policies-with-iam"></a> Dynamic policies with IAM</h2>
<ul>
<li>how do you assign each user access to their own foler in S3 bucket?</li>
<li>create one dynamic policy with IAM</li>
<li>leverage the special policy variable <code>$&#123;aws:username&#125;</code></li>
</ul>
<h2 id="inline-vs-managed-policies"><a class="markdownIt-Anchor" href="#inline-vs-managed-policies"></a> inline vs managed policies</h2>
<ul>
<li>AWS managed policy
<ul>
<li>maintained by AWS</li>
<li>good for power users and administrators</li>
<li>updated in case of new services and new APIs</li>
</ul>
</li>
<li>customer managed policy
<ul>
<li>best practice, re usable, can be applied to many principals</li>
<li>version controlled + rollback, central change management</li>
</ul>
</li>
<li>inline
<ul>
<li>strict one to one relationship between policy and principal</li>
<li>policy is deleted if you delete the IAM principal</li>
</ul>
</li>
</ul>
<h2 id="granting-a-user-permissions-to-pass-a-role-to-an-aws-service"><a class="markdownIt-Anchor" href="#granting-a-user-permissions-to-pass-a-role-to-an-aws-service"></a> granting a user permissions to pass a role to an AWS service</h2>
<ul>
<li>to configure many services, you must pass an IAM role to the service</li>
<li>the service will later assume the role and perform actions</li>
<li>for this, you need the IAM permission <code>iam:PassRole</code></li>
<li>it often comes with <code>iam:GetRole</code> to view the role being passed</li>
</ul>
<h3 id="can-a-role-be-passed-to-any-service"><a class="markdownIt-Anchor" href="#can-a-role-be-passed-to-any-service"></a> can a role be passed to any service?</h3>
<ul>
<li>no: roles can only be passed to what their trust allows</li>
<li>a trust policy for the role that allows the service to assume the role</li>
</ul>
<h2 id="directory-service-overview"><a class="markdownIt-Anchor" href="#directory-service-overview"></a> Directory service - overview</h2>
<ul>
<li>AWS managed Microsoft AD
<ul>
<li>create your own AD in AWS, manage users locally, supports MFA</li>
<li>establish trust connections with your on permise AD</li>
</ul>
</li>
<li>AD connector
<ul>
<li>directory gateway to redirect to on premises AD</li>
<li>users are managed on the on premises AD only</li>
</ul>
</li>
<li>Simple AD
<ul>
<li>AD compatible managed directory on AWS</li>
<li>cannot be joined with on premises AD</li>
</ul>
</li>
</ul>
<h1 id="kms"><a class="markdownIt-Anchor" href="#kms"></a> KMS</h1>
<h2 id="encryption"><a class="markdownIt-Anchor" href="#encryption"></a> Encryption</h2>
<h3 id="encryption-in-flight"><a class="markdownIt-Anchor" href="#encryption-in-flight"></a> Encryption in flight</h3>
<ul>
<li>data is encrypted before sending and decrypted after receiving</li>
<li>SSL certificate help with encryption</li>
<li>encryption in flight ensures no MITM can happen</li>
</ul>
<h3 id="server-side-encryption-at-rest"><a class="markdownIt-Anchor" href="#server-side-encryption-at-rest"></a> server side encryption at rest</h3>
<ul>
<li>data is encrypted after being received by the server</li>
<li>data is decrypted before being sent</li>
<li>it is stored in an encrypted form thanks to a key</li>
<li>the encryption / decryption keys must be managed somewhere and the server must have access to it</li>
</ul>
<h3 id="client-side-encryption-2"><a class="markdownIt-Anchor" href="#client-side-encryption-2"></a> Client side encryption</h3>
<ul>
<li>data is encrypted by the client and never decrypted by the server</li>
<li>data will be decrypted by a receiving client</li>
<li>the server should not be able to decrypt the data</li>
<li>could leverage Envelop encryption</li>
</ul>
<h2 id="aws-kms"><a class="markdownIt-Anchor" href="#aws-kms"></a> AWS KMS</h2>
<ul>
<li>fully integrated with IAM for authorization</li>
<li>seamlessly integrated into
<ul>
<li>EBS</li>
<li>S3</li>
<li>RedShift</li>
<li>RDS</li>
<li>SSM</li>
</ul>
</li>
<li>but you can also use CLI / SDK</li>
<li>the value in KMS is the CMK used to encrypt data can never be retrieved by user, and the CMK can be rotated for extra security</li>
<li>KMS can only help in encryping up to 4KB of data per call, if data &gt; 4KB, we need to use Envelope encryption</li>
<li>to give access to KMS to someone
<ul>
<li>make sure the key policy allows the user</li>
<li>make sure the IAM policy allows the API calls</li>
</ul>
</li>
</ul>
<h2 id="cmk-types"><a class="markdownIt-Anchor" href="#cmk-types"></a> CMK Types</h2>
<ul>
<li>Symmetric
<ul>
<li>first offering of KMS, single encryption key that is used to encrypt and decrypt</li>
<li>AWS services that are integrated with KMS use Symmetric CMKs</li>
<li>necessary for envelope encryption</li>
<li>you never get access to the key uncrypted (must call KMS API to use)</li>
</ul>
</li>
<li>Asymmetric
<ul>
<li>public and private key pair</li>
<li>used for encrypt and decrypt</li>
<li>the public key is downloadable, but you can’t access the private key unencrypted</li>
<li>use case: encryption outside of AWS by users who can’t call the KMS API</li>
</ul>
</li>
</ul>
<h2 id="kms-key-policies"><a class="markdownIt-Anchor" href="#kms-key-policies"></a> KMS key policies</h2>
<ul>
<li>control access to KMS keys, similar to S3 bucket policies</li>
<li>difference: you cannot control access without them</li>
<li>default KMS key policy
<ul>
<li>created if you don’t provide a specific key policy</li>
<li>compelete access to the key to the root user, which means all IAM users can access the key</li>
<li>gives access to the IAM policies to the KMS key</li>
</ul>
</li>
<li>custom KMS key policy
<ul>
<li>define users, roles that can access the KMS key</li>
<li>define who can administer the key</li>
<li>helpful for cross account access of your KMS key</li>
</ul>
</li>
</ul>
<h3 id="copying-snapshots-across-accounts"><a class="markdownIt-Anchor" href="#copying-snapshots-across-accounts"></a> copying snapshots across accounts</h3>
<ul>
<li>create a snapshot, encrypted with your own CMK</li>
<li>attach a KMS key policy to authorize cross account access</li>
<li>share the encrypted snapshot</li>
<li>create a copy of the snapshot, encrypt it with a KMS key in your account</li>
<li>create a volume from the snapshot</li>
</ul>
<h2 id="envelope-encryption"><a class="markdownIt-Anchor" href="#envelope-encryption"></a> Envelope encryption</h2>
<ul>
<li>KMS encrypt API call has limit of 4kb</li>
<li>if you want to encrypt &gt; 4KB, we need to user envelope encryption</li>
<li>the main API that will help us is the <code>GenerateDataKey</code> API</li>
<li>steps
<ul>
<li>Encryption
<ol>
<li>call GenerateDataKey API to get the plaintext date key and encrypted data key (encrypted using your CMK)</li>
<li>encrypt the big file using the plaintext data key on your local machine (client side)</li>
<li>create an envelope includes the encrypted date key and the encrypted big file</li>
</ol>
</li>
<li>decryption
<ol>
<li>call Decrypt API, send the encrypted data key to KMS to decrypt using your own CMK</li>
<li>plaintext data key will be returned</li>
<li>use the plaintext data key to decrypt your encrypted big file.</li>
</ol>
</li>
</ul>
</li>
</ul>
<h3 id="encryption-sdk"><a class="markdownIt-Anchor" href="#encryption-sdk"></a> Encryption SDK</h3>
<ul>
<li>the Encryption SDK implemented envelope encryption for us</li>
<li>the encryption SDK also exists as a CLI tool we can install</li>
<li>feature - data key caching
<ul>
<li>re use data keys instead of creating new data keys for each encryption</li>
<li>helps with reducing the number of API calls to KMS with a security trade off</li>
</ul>
</li>
</ul>
<h2 id="kms-symmetric-api-summary"><a class="markdownIt-Anchor" href="#kms-symmetric-api-summary"></a> KMS symmetric - API summary</h2>
<ul>
<li>encrypt: up to 4KB</li>
<li>GenerateDataKey: generates a unique symmetric data key
<ul>
<li>returns a plaintext copy of the data key</li>
<li>and a copy that is encrypted under the CMK that you specify</li>
</ul>
</li>
<li>decrypt: decrypt up to 4KB of data (including data encryption keys)</li>
<li>GenerateRamdom: returns a random byte string</li>
</ul>
<h2 id="quota-limits"><a class="markdownIt-Anchor" href="#quota-limits"></a> Quota limits</h2>
<ul>
<li>when you exceed a request quota, you get a <code>ThrottlingException</code></li>
<li>to respond, use exponential backoff</li>
<li>for crytographic operations, they share the same quota</li>
<li>this includes requests made by AWS on your behalf</li>
<li>for GenerateDataKey, consider using DEK caching from the encryption SDK</li>
<li>you can also request quotas increase through AWS support</li>
</ul>
<h2 id="sse-kms-deep-dive"><a class="markdownIt-Anchor" href="#sse-kms-deep-dive"></a> SSE-KMS deep dive</h2>
<ul>
<li>SSE-KMS leverages the GenerateDataKey and Decrypt KMS API calls</li>
<li>these KMS API calls will show up in CloudTrail, helpful for logging</li>
<li>to perform SSE-KMS, you need
<ul>
<li>a KMS key policy that authorize the user / role (so we could use the key)</li>
<li>an IAM policy that authorizes access to KMS (so we could access the AWS KMS service)</li>
<li>otherwise you will get an access denied error</li>
</ul>
</li>
<li>S3 calls to KMS for SSE-KMS count against your KMS limits
<ul>
<li>if throttling, try exponential backoff</li>
<li>or request an increase in KMS limits</li>
</ul>
</li>
</ul>
<h3 id="s3-bucket-policies-force-ssl"><a class="markdownIt-Anchor" href="#s3-bucket-policies-force-ssl"></a> S3 bucket policies - force SSL</h3>
<ul>
<li>to force SSL, create an S3 bucket policy with a DENY on the condition <code>aws:SecureTransport=false</code></li>
</ul>
<h3 id="s3-bucket-policy-force-encryption-of-sse-kms"><a class="markdownIt-Anchor" href="#s3-bucket-policy-force-encryption-of-sse-kms"></a> S3 bucket policy - force encryption of SSE-KMS</h3>
<ol>
<li>deny incorrect encryption header: make sure it includes <code>aws:kms</code></li>
<li>deny no encryption header to ensure objects are not uploaded un encrypted</li>
</ol>
<ul>
<li>we could also use S3 default encryption of SSE-KMS, in this case, we don’t need the second policy.</li>
</ul>
<h2 id="s3-bucket-key-for-sse-kms-encryption"><a class="markdownIt-Anchor" href="#s3-bucket-key-for-sse-kms-encryption"></a> S3 bucket key for SSE-KMS encryption</h2>
<ul>
<li>we could enable S3 bucket key to reduce the API calls to KMS directly</li>
<li>the key is used to encrypt kMS objects with new data keys using envelope encryption</li>
<li>you will see less KMS cloudtrail events</li>
</ul>
<h1 id="ssm-parameter-store"><a class="markdownIt-Anchor" href="#ssm-parameter-store"></a> SSM Parameter Store</h1>
<ul>
<li>secure storage for configuration and secrets</li>
<li>optional seamless encryption using KMS</li>
<li>serverless, scalable, durable, easy sdk</li>
<li>version tracking of configurations / secrets</li>
<li>configuration management using path and IAM</li>
<li>notifications with CloudWatch events</li>
<li>integration with CloudFormation</li>
</ul>
<h2 id="parameter-policies"><a class="markdownIt-Anchor" href="#parameter-policies"></a> Parameter policies</h2>
<ul>
<li>allow to assign a TTL to a parameter to force updating or deleting sensitive data</li>
<li>can assign multiple policies at a time</li>
</ul>
<h1 id="secrets-manager"><a class="markdownIt-Anchor" href="#secrets-manager"></a> Secrets Manager</h1>
<ul>
<li>Newer service, meant for storing secrets</li>
<li>capability to force rotation of secrets every X days</li>
<li>automate generation of secrets on rotation using lambda function</li>
<li>integration with RDS</li>
<li>secrets are encrypted using KMS</li>
<li>mostly meant for RDS integration</li>
</ul>
<h2 id="ssm-parameter-store-vs-secrets-manager"><a class="markdownIt-Anchor" href="#ssm-parameter-store-vs-secrets-manager"></a> SSM Parameter store vs secrets manager</h2>
<ul>
<li>secrets manager
<ul>
<li>automatic rotation of secrets with lambda</li>
<li>lambda function is provided for RDS, Redshift…</li>
<li>KMS encryption is mandatory</li>
</ul>
</li>
<li>SSM parameter store
<ul>
<li>simple API</li>
<li>no secret rotation (can be implemented using CloudWatch events and lambda)</li>
<li>KMS encryption is optional</li>
<li>can pull a secrets manager secrets using the SSM parameter Store API</li>
</ul>
</li>
</ul>
<h2 id="cloudwatch-logs-encryption"><a class="markdownIt-Anchor" href="#cloudwatch-logs-encryption"></a> CloudWatch logs - encryption</h2>
<ul>
<li>you can encrypt CloudWatch logs with KMS keys</li>
<li>encryption is enabled at the log group level, by associating a CMK with a log group, either when you create the log group or after it exists</li>
<li>you cannot associate a CMK with a log group using the CloudWatch console, have to use CLI</li>
<li>you must use the CloudWatch logs API
<ul>
<li><code>associate-kms-key</code>: if the log group already exists</li>
<li><code>create-log-group</code>: if the log group doesn’t exist yet</li>
</ul>
</li>
</ul>
<h1 id="acm-aws-certificate-manager"><a class="markdownIt-Anchor" href="#acm-aws-certificate-manager"></a> ACM (AWS certificate manager)</h1>
<ul>
<li>provision, manage, and deploy SSL / TLS certificates</li>
<li>used to provide in flight encryption for websites</li>
<li>supports both public and private TLS certificates</li>
<li>free of charge for public TLS certificates</li>
<li>automatic TLS certificate renewal</li>
<li>integration with
<ul>
<li>ELB</li>
<li>CloudFront</li>
<li>APIs on API Gateway</li>
</ul>
</li>
</ul>

      
    </div>
    <div class="article-footer">
      <blockquote class="mt-2x">
  <ul class="post-copyright list-unstyled">
    
    <li class="post-copyright-link hidden-xs">
      <strong>Link：</strong>
      <a href="http://hellcy.github.io/2021/09/12/AWS-DVA-review/" title="AWS DVA review" target="_blank" rel="external">http://hellcy.github.io/2021/09/12/AWS-DVA-review/</a>
    </li>
    
    <li class="post-copyright-license">
      <strong>Copyright： </strong> This article is using <a href="http://creativecommons.org/licenses/by/4.0" target="_blank" rel="external">CC BY 4.0 </a> license.
    </li>
  </ul>
</blockquote>


<div class="panel panel-default panel-badger">
  <div class="panel-body">
    <figure class="media">
      <div class="media-left">
        <a href="https://github.com/hellcy" target="_blank" class="img-burn thumb-sm visible-lg">
          <img src="/images/avatar.jpg" class="img-rounded w-full" alt="">
        </a>
      </div>
      <div class="media-body">
        <h3 class="media-heading"><a href="https://github.com/hellcy" target="_blank"><span class="text-dark">Yuan Cheng</span><small class="ml-1x">Software Engineer</small></a></h3>
        <div>Wait and see</div>
      </div>
    </figure>
  </div>
</div>


    </div>
  </article>
  
    
  <section id="comments">
  	
           
    
  </section>


  
</div>

  <nav class="bar bar-footer clearfix" data-stick-bottom>
  <div class="bar-inner">
  
  <ul class="pager pull-left">
    
    <li class="prev">
      <a href="/2021/10/14/Wishlist-2022/" title="Wishlist 2022"><i class="icon icon-angle-left" aria-hidden="true"></i><span>&nbsp;&nbsp;Newer</span></a>
    </li>
    
    
    <li class="next">
      <a href="/2021/08/09/AWS-SAA-Review/" title="AWS SAA Review"><span>Older&nbsp;&nbsp;</span><i class="icon icon-angle-right" aria-hidden="true"></i></a>
    </li>
    
    
    <li class="toggle-toc">
      <a class="toggle-btn collapsed" data-toggle="collapse" href="#collapseToc" aria-expanded="false" title="Catalogue" role="button">
        <span>[&nbsp;</span><span>Catalogue</span>
        <i class="text-collapsed icon icon-anchor"></i>
        <i class="text-in icon icon-close"></i>
        <span>]</span>
      </a>
    </li>
    
  </ul>
  
  
  <!-- Button trigger modal -->
  <button type="button" class="btn btn-fancy btn-donate pop-onhover bg-gradient-warning" data-toggle="modal" data-target="#donateModal"><span>$</span></button>
  <!-- <div class="wave-icon wave-icon-danger btn-donate" data-toggle="modal" data-target="#donateModal">
    <div class="wave-circle"><span class="icon"><i class="icon icon-bill"></i></span></div>
  </div> -->
  
  
  <div class="bar-right">
    
    <div class="share-component" data-sites="weibo,qq,wechat,facebook,twitter" data-mobile-sites="weibo,qq,qzone"></div>
    
  </div>
  </div>
</nav>
  
<!-- Modal -->
<div class="modal modal-center modal-small modal-xs-full fade" id="donateModal" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content donate">
      <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
      <div class="modal-body">
        <div class="donate-box">
          <div class="donate-head">
            <p>Maybe you could buy me a cup of coffee.</p>
          </div>
          <div class="tab-content">
            <div role="tabpanel" class="tab-pane fade active in" id="alipay">
              <div class="donate-payimg">
                <img src="/images/donate/alipayimg.png" alt="Scan Qrcode" title="Scan" />
              </div>
              <p class="text-muted mv">Scan this qrcode</p>
              <p class="text-grey">Open alipay app scan this qrcode, buy me a coffee!</p>
            </div>
            <div role="tabpanel" class="tab-pane fade" id="wechatpay">
              <div class="donate-payimg">
                <img src="/images/donate/wechatpayimg.png" alt="Scan Qrcode" title="Scan" />
              </div>
              <p class="text-muted mv">Scan this qrcode</p>
              <p class="text-grey">Open wechat app scan this qrcode, buy me a coffee!</p>
            </div>
          </div>
          <div class="donate-footer">
            <ul class="nav nav-tabs nav-justified" role="tablist">
              <li role="presentation" class="active">
                <a href="#alipay" id="alipay-tab" role="tab" data-toggle="tab" aria-controls="alipay" aria-expanded="true"><i class="icon icon-alipay"></i> alipay</a>
              </li>
              <li role="presentation" class="">
                <a href="#wechatpay" role="tab" id="wechatpay-tab" data-toggle="tab" aria-controls="wechatpay" aria-expanded="false"><i class="icon icon-wepay"></i> wechat payment</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>



</main>

  <footer class="footer" itemscope itemtype="http://schema.org/WPFooter">
	
	
    <ul class="social-links">
    	
        <li><a href="https://github.com/hellcy" target="_blank" title="Github" data-toggle=tooltip data-placement=top><i class="icon icon-github"></i></a></li>
        
        <li><a href="/atom.xml" target="_blank" title="Rss" data-toggle=tooltip data-placement=top><i class="icon icon-rss"></i></a></li>
        
    </ul>

    <div class="copyright">
    	
        <div class="publishby">
        	Theme by <a href="https://github.com/cofess" target="_blank"> cofess </a>base on <a href="https://github.com/cofess/hexo-theme-pure" target="_blank">pure</a>.
        </div>
    </div>
</footer>
  <script src="//cdn.jsdelivr.net/npm/jquery@1.12.4/dist/jquery.min.js"></script>
<script>
window.jQuery || document.write('<script src="js/jquery.min.js"><\/script>')
</script>

<script src="/js/plugin.min.js"></script>


<script src="/js/application.js"></script>


    <script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>

<script src="/js/insight.js"></script>






   




   
    
  <!-- <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css"> -->
  <script src="//cdn.jsdelivr.net/npm/gitalk@1.4.0/dist/gitalk.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script>
  <script type="text/javascript">
  var gitalk = new Gitalk({
    clientID: '974c65d45d0a581171ca',
    clientSecret: '57b8696778eef1373bd27067f78b50b9a5d4fc0c',
    repo: 'blog-comments',
    owner: 'hellcy',
    admin: ['hellcy'],
    id: md5(location.pathname),
    distractionFreeMode: true,
    proxy: 'https://netnr-proxy.cloudno.de/https://github.com/login/oauth/access_token'
  })
  gitalk.render('comments')
  </script>

      



  <script src="//cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.3.5/dist/jquery.fancybox.min.js"></script>
  <script>
  //利用 FancyBox 实现点击图片放大
  $(document).ready(function() {
    $('article img').not('[hidden]').not('.panel-body img').each(function() {
      var $image = $(this);
      var imageCaption = $image.attr('alt');
      var $imageWrapLink = $image.parent('a');
      if ($imageWrapLink.length < 1) {
        var src = this.getAttribute('src');
        var idx = src.lastIndexOf('?');
        if (idx != -1) {
          src = src.substring(0, idx);
        }
        $imageWrapLink = $image.wrap('<a href="' + src + '"></a>').parent('a');
      }
      $imageWrapLink.attr('data-fancybox', 'images');
      if (imageCaption) {
        $imageWrapLink.attr('data-caption', imageCaption);
      }
    });
    $().fancybox({
      selector: '[data-fancybox="images"]',
      hash: false,
      loop: false,
    });
  });
  </script>





</body>
</html>